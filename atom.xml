<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ç‹å¿—é¹</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://zhipenwang.github.io/"/>
  <updated>2019-07-13T04:30:20.601Z</updated>
  <id>https://zhipenwang.github.io/</id>
  
  <author>
    <name>ç‹å¿—é¹</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>PHPä½¿ç”¨KAFKA</title>
    <link href="https://zhipenwang.github.io/2019/06/15/2019_06_15/"/>
    <id>https://zhipenwang.github.io/2019/06/15/2019_06_15/</id>
    <published>2019-06-14T16:00:00.000Z</published>
    <updated>2019-07-13T04:30:20.601Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç¯å¢ƒéƒ¨ç½²ï¼ˆPHP-RdKafkaæ‰©å±•ï¼‰"><a href="#ç¯å¢ƒéƒ¨ç½²ï¼ˆPHP-RdKafkaæ‰©å±•ï¼‰" class="headerlink" title="ç¯å¢ƒéƒ¨ç½²ï¼ˆPHP-RdKafkaæ‰©å±•ï¼‰"></a>ç¯å¢ƒéƒ¨ç½²ï¼ˆPHP-RdKafkaæ‰©å±•ï¼‰</h3><p><em>ä¸Šä¸€èŠ‚è¯´äº†KAFKAçš„å•èŠ‚ç‚¹éƒ¨ç½²ï¼Œæœ¬èŠ‚å°±ä¸å†ç»†è¿°äº†ã€‚</em><br>ä¸ºäº†å…è®¸KAFKAè¢«PHPè¿œç¨‹è°ƒç”¨ï¼Œéœ€è¦ä¿®æ”¹KAFKAé…ç½®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åœ¨kafkaçš„server.propertiesä¸­ä¿®æ”¹å¦‚ä¸‹kafkaé…ç½®é¡¹ï¼š</span><br><span class="line">    advertised.listeners=PLAINTEXT://ip:port</span><br><span class="line">é»˜è®¤è¯¥é¡¹é…ç½®æ˜¯æ³¨é‡Šæ‰çš„ï¼Œå¦‚æœä¸ä¿®æ”¹çš„è¯ï¼Œkafkaé»˜è®¤ä½¿ç”¨listenersé…ç½®é¡¹æˆ–è€…localhost+portæ¥ç”Ÿäº§æˆ–è€…æ¶ˆè´¹æ¶ˆæ¯</span><br><span class="line">é‡å¯KAFKA</span><br></pre></td></tr></table></figure></p><p>å®‰è£…libåº“<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/edenhill/librdkafka.git</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure></p><p>å®‰è£…php-kafkaæ‰©å±•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/arnaud-lb/php-rdkafka.git</span><br><span class="line">cd php-rdkafka</span><br><span class="line">phpize</span><br><span class="line">./configure --with-php-config=/usr/local/bin/php-config</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">åœ¨php.iniä¸­åŠ å…¥ï¼š</span><br><span class="line">extension=rdkafka.so</span><br><span class="line">é‡å¯php-fpm</span><br></pre></td></tr></table></figure></p><h3 id="PHP-RdKAFKAä½¿ç”¨"><a href="#PHP-RdKAFKAä½¿ç”¨" class="headerlink" title="PHP-RdKAFKAä½¿ç”¨"></a>PHP-RdKAFKAä½¿ç”¨</h3><p>PHP-ç”Ÿäº§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">try &#123;</span><br><span class="line">$rcf = new RdKafka\Conf();</span><br><span class="line">$rcf-&gt;set(&apos;group.id&apos;, &apos;test&apos;);</span><br><span class="line">$cf = new RdKafka\TopicConf();</span><br><span class="line">$cf-&gt;set(&apos;offset.store.method&apos;, &apos;broker&apos;);</span><br><span class="line">$cf-&gt;set(&apos;auto.offset.reset&apos;, &apos;smallest&apos;);</span><br><span class="line"></span><br><span class="line">$rk = new RdKafka\Producer($rcf);</span><br><span class="line">$rk-&gt;setLogLevel(LOG_DEBUG);</span><br><span class="line">$rk-&gt;addBrokers(&quot;127.0.0.1:9092&quot;);</span><br><span class="line">$topic = $rk-&gt;newTopic(&quot;test&quot;, $cf);</span><br><span class="line"></span><br><span class="line">for($i = 0; $i &lt; 10; $i++) &#123;</span><br><span class="line">$topic-&gt;produce(0,0,&apos;test&apos; . $i);</span><br><span class="line">&#125; </span><br><span class="line">&#125;catch (Exception $e) &#123;</span><br><span class="line">echo $e-&gt;getMessage();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>PHP-æ¶ˆè´¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">try &#123;</span><br><span class="line">    $rcf = new RdKafka\Conf();</span><br><span class="line">    $rcf-&gt;set(&apos;group.id&apos;, &apos;test&apos;);</span><br><span class="line">$cf = new RdKafka\TopicConf();</span><br><span class="line">    $cf-&gt;set(&apos;auto.offset.reset&apos;, &apos;smallest&apos;);</span><br><span class="line">    $cf-&gt;set(&apos;auto.commit.enable&apos;, true);</span><br><span class="line"> </span><br><span class="line">    $rk = new RdKafka\Consumer($rcf);</span><br><span class="line">    $rk-&gt;setLogLevel(LOG_DEBUG);</span><br><span class="line">    $rk-&gt;addBrokers(&quot;127.0.0.1:9092&quot;);</span><br><span class="line">    $topic = $rk-&gt;newTopic(&quot;test&quot;, $cf);</span><br><span class="line">    while (true) &#123;</span><br><span class="line">        $topic-&gt;consumeStart(0, RD_KAFKA_OFFSET_STORED);</span><br><span class="line">        $msg = $topic-&gt;consume(0, 1000);</span><br><span class="line">        var_dump($msg);</span><br><span class="line">        if (isset($msg-&gt;err) &amp;&amp; $msg-&gt;err) &#123;</span><br><span class="line">            echo $msg-&gt;errstr(), &quot;\n&quot;;</span><br><span class="line">        &#125; elseif(isset($msg-&gt;payload)) &#123;</span><br><span class="line">            echo $msg-&gt;payload, &quot;\n&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        $topic-&gt;consumeStop(0);</span><br><span class="line">        sleep(1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; catch (Exception $e) &#123;</span><br><span class="line">    echo $e-&gt;getMessage();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h3><p>PHP-RdKAKFAæ¶ˆè´¹KAFKAçš„æ—¶å€™ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä½çº§æ–¹å¼ä¸é«˜çº§æ–¹å¼ï¼Œåœ¨ä¸‹èŠ‚ä¼šå±•å¼€è®¨è®ºã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;ç¯å¢ƒéƒ¨ç½²ï¼ˆPHP-RdKafkaæ‰©å±•ï¼‰&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒéƒ¨ç½²ï¼ˆPHP-RdKafkaæ‰©å±•ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒéƒ¨ç½²ï¼ˆPHP-RdKafkaæ‰©å±•ï¼‰&quot;&gt;&lt;/a&gt;ç¯å¢ƒéƒ¨ç½²ï¼ˆPHP-RdKafkaæ‰©å±•ï¼‰&lt;/h3&gt;&lt;p&gt;&lt;e
      
    
    </summary>
    
      <category term="KAFKA" scheme="https://zhipenwang.github.io/categories/KAFKA/"/>
    
    
      <category term="PHP" scheme="https://zhipenwang.github.io/tags/PHP/"/>
    
      <category term="KAFKA" scheme="https://zhipenwang.github.io/tags/KAFKA/"/>
    
  </entry>
  
  <entry>
    <title>KAFKAå•æœºå™¨å•èŠ‚ç‚¹éƒ¨ç½²</title>
    <link href="https://zhipenwang.github.io/2019/06/05/2019_06_05/"/>
    <id>https://zhipenwang.github.io/2019/06/05/2019_06_05/</id>
    <published>2019-06-04T16:00:00.000Z</published>
    <updated>2019-07-13T04:18:16.376Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><blockquote><p>Kafkaæ˜¯æœ€åˆç”±Linkedinå…¬å¸å¼€å‘ï¼Œæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€åˆ†åŒºçš„ã€å¤šå‰¯æœ¬çš„ã€å¤šè®¢é˜…è€…ï¼ŒåŸºäºzookeeperåè°ƒçš„åˆ†å¸ƒå¼æ—¥å¿—ç³»ç»Ÿï¼ˆä¹Ÿå¯ä»¥å½“åšMQç³»ç»Ÿï¼‰ï¼Œå¸¸è§å¯ä»¥ç”¨äºweb/nginxæ—¥å¿—ã€è®¿é—®æ—¥å¿—ï¼Œæ¶ˆæ¯æœåŠ¡ç­‰ç­‰ï¼ŒLinkedinäº2010å¹´è´¡çŒ®ç»™äº†ApacheåŸºé‡‘ä¼šå¹¶æˆä¸ºé¡¶çº§å¼€æºé¡¹ç›®ã€‚</p></blockquote><blockquote><p>ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ï¼šæ—¥å¿—æ”¶é›†ç³»ç»Ÿå’Œæ¶ˆæ¯ç³»ç»Ÿã€‚</p></blockquote><p>Kafkaä¸»è¦è®¾è®¡ç›®æ ‡å¦‚ä¸‹ï¼š</p><ol><li>ä»¥æ—¶é—´å¤æ‚åº¦ä¸ºO(1)çš„æ–¹å¼æä¾›æ¶ˆæ¯æŒä¹…åŒ–èƒ½åŠ›ï¼Œå³ä½¿å¯¹TBçº§ä»¥ä¸Šæ•°æ®ä¹Ÿèƒ½ä¿è¯å¸¸æ•°æ—¶é—´çš„è®¿é—®æ€§èƒ½ã€‚</li><li>é«˜ååç‡ã€‚å³ä½¿åœ¨éå¸¸å»‰ä»·çš„å•†ç”¨æœºå™¨ä¸Šä¹Ÿèƒ½åšåˆ°å•æœºæ”¯æŒæ¯ç§’100Kæ¡æ¶ˆæ¯çš„ä¼ è¾“ã€‚</li><li>æ”¯æŒKafka Serveré—´çš„æ¶ˆæ¯åˆ†åŒºï¼ŒåŠåˆ†å¸ƒå¼æ¶ˆè´¹ï¼ŒåŒæ—¶ä¿è¯æ¯ä¸ªpartitionå†…çš„æ¶ˆæ¯é¡ºåºä¼ è¾“ã€‚</li><li>åŒæ—¶æ”¯æŒç¦»çº¿æ•°æ®å¤„ç†å’Œå®æ—¶æ•°æ®å¤„ç†ã€‚</li><li>Scale out:æ”¯æŒåœ¨çº¿æ°´å¹³æ‰©å±•</li></ol><h3 id="ä¸‹è½½å®‰è£…"><a href="#ä¸‹è½½å®‰è£…" class="headerlink" title="ä¸‹è½½å®‰è£…"></a>ä¸‹è½½å®‰è£…</h3><p>ä¸‹è½½åœ°å€ï¼š<a href="http://kafka.apache.org/downloads.html" target="_blank" rel="noopener">http://kafka.apache.org/downloads.html</a><br>ç›´æ¥ä¸‹è½½è§£å‹å³å¯</p><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p>å¯åŠ¨zookeeper<br><em>å‰æï¼šå¦‚æœå®‰è£…äº†zookeeperåˆ™éœ€è¦å¯åŠ¨zookeeperï¼Œè¿™æ ·å°±ä¸éœ€è¦å¯åŠ¨KAFKAè‡ªå¸¦çš„zookeeperäº†</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh bin/zookeeper-server-start.sh config/zookeeper.properties &amp;</span><br></pre></td></tr></table></figure></p><p>å¯åŠ¨KAFKA<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kafkaé…ç½®æ–‡ä»¶ï¼š/config/zookeeper.propertiesä¸­åŒ…å«äº†zookeeperçš„ç›‘å¬åœ°å€ï¼š</span><br><span class="line">    zookeeper.connect=127.0.0.1:2181</span><br><span class="line">é…ç½®ä¸­å…¶ä»–ä¸»è¦ä¿¡æ¯ï¼š</span><br><span class="line">    broker.id=0</span><br><span class="line">    listeners=PLAINTEXT://:9092</span><br><span class="line"></span><br><span class="line">sh bin/kafka-server-start.sh config/server.properties</span><br><span class="line">å®ˆæŠ¤è¿›ç¨‹åå°å¯åŠ¨ï¼š</span><br><span class="line">sh bin/kafka-server-start.sh config/server.properties 1&gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure></p><p>å¯åŠ¨ç”Ÿäº§è€…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test</span><br></pre></td></tr></table></figure></p><p>å¯åŠ¨æ¶ˆè´¹è€…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0.90ç‰ˆæœ¬ä¹‹å‰å¯åŠ¨æ–¹å¼ï¼š</span><br><span class="line">sh bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic test --from-beginning</span><br><span class="line">0.90ç‰ˆæœ¬ä¹‹åå¯åŠ¨æ–¹å¼ï¼š</span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning</span><br></pre></td></tr></table></figure></p><blockquote><p>ç”Ÿäº§è€…çª—å£å‘é€æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…çª—å£æ¥æ”¶æ¶ˆæ¯</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;Kafkaæ˜¯æœ€åˆç”±Linkedinå…¬å¸å¼€å‘ï¼Œæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€åˆ†åŒºçš„ã€å¤šå‰¯æœ¬çš„ã€å¤šè®¢é˜…è€…ï¼ŒåŸºäºzookeeperåè°ƒçš„
      
    
    </summary>
    
      <category term="KAFKA" scheme="https://zhipenwang.github.io/categories/KAFKA/"/>
    
    
      <category term="KAFKA" scheme="https://zhipenwang.github.io/tags/KAFKA/"/>
    
  </entry>
  
  <entry>
    <title>nginxæ”¯æŒå¤šåŸŸå</title>
    <link href="https://zhipenwang.github.io/2019/05/30/2019_05_30/"/>
    <id>https://zhipenwang.github.io/2019/05/30/2019_05_30/</id>
    <published>2019-05-29T16:00:00.000Z</published>
    <updated>2019-07-13T04:14:45.861Z</updated>
    
    <content type="html"><![CDATA[<h3 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h3><blockquote><p>æŸä¸ªåŸŸåæ”¯æŒhttpå’Œhttpsè®¿é—®<br>æŸä¸ªåŸŸååªæ”¯æŒhttpsè®¿é—®<br>è¿™ç§æƒ…å†µæ— æ³•æ”¯æŒï¼Œå› ä¸ºåŠ è½½çš„é…ç½®æ–‡ä»¶ä¸­ï¼ŒåŒ…å«äº†listen 80æ”¯æŒhttp<br>æ‰€ä»¥å¦å¤–ä¸€ä¸ªåŸŸåä¹Ÿä¸€æ ·æ”¯æŒhttp<br>å»ºè®®ï¼š<br>å°†80çš„é‡å®šå‘åˆ°httpsï¼Œè¿™æ ·æ‰€æœ‰çš„httpè®¿é—®éƒ½ä¼šé‡å®šå‘çš„å®šä¹‰çš„é‡å®šå‘httpsåŸŸå</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">å¦‚ï¼šæ‰€æœ‰çš„httpï¼Œä¸ç®¡ä»€ä¹ˆåŸŸå,è®¿é—®80ç«¯å£éƒ½ä¼šé‡å®šå‘åˆ°https://www.test.com</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name  www.test.com;</span><br><span class="line">rewrite ^(.*)$ https://$&#123;server_name&#125;$1 permanent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test1.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name www.test1.com</span><br><span class="line">    </span><br><span class="line">    #ssl on; è¿™é‡Œè¦æ³¨é‡Šæ‰</span><br><span class="line">    ssl_certificate /usr/local/nginx/conf/ssl/www_test1_com.crt;</span><br><span class="line">    ssl_certificate_key /usr/local/nginx/conf/ssl/www_test1_com.key;</span><br><span class="line"></span><br><span class="line">    #ä»¥ä¸‹é…ç½®çœç•¥...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test2.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name www.test2.com</span><br><span class="line">    </span><br><span class="line">    #ssl on; è¿™é‡Œè¦æ³¨é‡Šæ‰</span><br><span class="line">    ssl_certificate /usr/local/nginx/conf/ssl/www_test2_com.crt;</span><br><span class="line">    ssl_certificate_key /usr/local/nginx/conf/ssl/www_test2_com.key;</span><br><span class="line"></span><br><span class="line">    #ä»¥ä¸‹é…ç½®çœç•¥...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;åœºæ™¯&quot;&gt;&lt;a href=&quot;#åœºæ™¯&quot; class=&quot;headerlink&quot; title=&quot;åœºæ™¯&quot;&gt;&lt;/a&gt;åœºæ™¯&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;æŸä¸ªåŸŸåæ”¯æŒhttpå’Œhttpsè®¿é—®&lt;br&gt;æŸä¸ªåŸŸååªæ”¯æŒhttpsè®¿é—®&lt;br&gt;è¿™ç§æƒ…å†µæ— æ³•æ”¯æŒï¼Œå› ä¸ºåŠ è½½çš„é…ç½®æ–‡
      
    
    </summary>
    
      <category term="Nginx" scheme="https://zhipenwang.github.io/categories/Nginx/"/>
    
    
      <category term="Nginx" scheme="https://zhipenwang.github.io/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>Nginxé…ç½®80ã€443ç«¯å£</title>
    <link href="https://zhipenwang.github.io/2019/05/24/2019_05_24/"/>
    <id>https://zhipenwang.github.io/2019/05/24/2019_05_24/</id>
    <published>2019-05-23T16:00:00.000Z</published>
    <updated>2019-05-26T04:04:35.117Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>nginx server ä¸Š 80ã€443ç«¯å£ï¼Œhttpä¸httpså…±å­˜<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name www.test.com</span><br><span class="line">    </span><br><span class="line">    #ssl on; è¿™é‡Œè¦æ³¨é‡Šæ‰</span><br><span class="line">    ssl_certificate /usr/local/nginx/conf/ssl/www_iamle_com.crt;</span><br><span class="line">    ssl_certificate_key /usr/local/nginx/conf/ssl/www_iamle_com.key;</span><br><span class="line"></span><br><span class="line">    #ä»¥ä¸‹é…ç½®çœç•¥...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>nginx 80ç«¯å£é‡å®šå‘åˆ°443ç«¯å£<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name www.test.com;</span><br><span class="line">    rewrite ^(.*)$ https://$&#123;server_name&#125;$1 permanent; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443;</span><br><span class="line">    server_name www.test.com;</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate   /etc/pki/CA/certs/214321311540956.pem;</span><br><span class="line">    ssl_certificate_key  /etc/pki/CA/certs/214321311540956.key;</span><br><span class="line">    ssl_session_timeout 5m;</span><br><span class="line">    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">    ssl_prefer_server_ciphers on;   </span><br><span class="line">    index index.php index.htm index.html;</span><br><span class="line">    error_page 404 /404.html;</span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line"></span><br><span class="line">    location ~ \.php &#123;</span><br><span class="line">    root /alidata/www/html;</span><br><span class="line">    fastcgi_pass unix:/tmp/php-cgi.sock;</span><br><span class="line">    fastcgi_index index.php;</span><br><span class="line">    include   fastcgi.conf;</span><br><span class="line"></span><br><span class="line">    set $path_info &quot;&quot;;</span><br><span class="line">    set $fastcgi_script_name_new $fastcgi_script_name;</span><br><span class="line"></span><br><span class="line">        if ($fastcgi_script_name ~*   &quot;^(.+\.php)(/.+)$&quot;  ) &#123;</span><br><span class="line">            set $fastcgi_script_name_new $1;</span><br><span class="line">        set $path_info $2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fastcgi_param   SCRIPT_FILENAME   $document_root$fastcgi_script_name_new;</span><br><span class="line">    fastcgi_param   SCRIPT_NAME   $fastcgi_script_name_new;                    </span><br><span class="line">    fastcgi_param   PATH_INFO $path_info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">    root /alidata/www/html;</span><br><span class="line">    index index.php index.html index.htm;</span><br><span class="line">    if (!-e  $request_filename)&#123;</span><br><span class="line">        rewrite ^(.*)$ /index.php$1 last;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;nginx server ä¸Š 80ã€443ç«¯å£ï¼Œhttpä¸httpså…±å­˜&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line
      
    
    </summary>
    
      <category term="Nginx" scheme="https://zhipenwang.github.io/categories/Nginx/"/>
    
    
      <category term="Nginx" scheme="https://zhipenwang.github.io/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>redisçš„ä¸¤ç§é«˜å¯ç”¨æ–¹æ¡ˆï¼šä¸»ä»å¤åˆ¶ä¸å“¨å…µæœºåˆ¶</title>
    <link href="https://zhipenwang.github.io/2019/05/16/2019_05_16/"/>
    <id>https://zhipenwang.github.io/2019/05/16/2019_05_16/</id>
    <published>2019-05-15T16:00:00.000Z</published>
    <updated>2019-05-14T07:25:38.390Z</updated>
    
    <content type="html"><![CDATA[<h3 id="redisæ•°æ®ä¸»ä»å¤åˆ¶"><a href="#redisæ•°æ®ä¸»ä»å¤åˆ¶" class="headerlink" title="redisæ•°æ®ä¸»ä»å¤åˆ¶"></a>redisæ•°æ®ä¸»ä»å¤åˆ¶</h3><h4 id="æ—§ç‰ˆæœ¬â€“å…¨é‡å¤åˆ¶"><a href="#æ—§ç‰ˆæœ¬â€“å…¨é‡å¤åˆ¶" class="headerlink" title="æ—§ç‰ˆæœ¬â€“å…¨é‡å¤åˆ¶"></a>æ—§ç‰ˆæœ¬â€“å…¨é‡å¤åˆ¶</h4><blockquote><p>å‘½ä»¤ï¼šsync  </p><p>æµç¨‹ï¼š  </p><ul><li>ä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘é€syncå‘½ä»¤  </li><li>ä¸»æœåŠ¡å™¨æ”¶åˆ°syncå‘½ä»¤åï¼Œè°ƒç”¨bgsaveå‘½ä»¤ç”Ÿæˆæœ€æ–°çš„rdbæ–‡ä»¶ï¼Œå°†è¿™ä¸ªæ–‡ä»¶åŒæ­¥ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨è½½å…¥rdbæ–‡ä»¶åï¼ŒçŠ¶æ€å°±è·Ÿä¸»æœåŠ¡å™¨æ‰§è¡Œbgsaveå‘½ä»¤æ—¶çš„çŠ¶æ€ä¸€è‡´äº†ã€‚  </li><li>ä¸»æœåŠ¡å™¨å°†ä¿å­˜åœ¨å‘½ä»¤ç¼“å†²åŒºçš„å†™å‘½ä»¤åŒæ­¥ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨æ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œè¿™æ ·ä»æœåŠ¡å™¨çš„çŠ¶æ€å°±è·Ÿä¸»æœåŠ¡å™¨å½“å‰çŠ¶æ€ä¸€è‡´äº†</li></ul></blockquote><p><img src="/img/redis_1.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç¼ºç‚¹ï¼š</span><br><span class="line">æœ€å¤§çš„é—®é¢˜åœ¨äºä»æœåŠ¡å™¨æ–­å¼€é‡è¿çš„æ—¶å€™ï¼Œå³ä½¿ä»æœåŠ¡å™¨å·²ç»å¤åˆ¶äº†ä¸€éƒ¨åˆ†æ•°æ®äº†ï¼Œï¼Œä¹Ÿéœ€è¦å…¨é‡å¤åˆ¶æ‰€æœ‰æ•°æ®ï¼Œè¿™æ ·çš„æ•ˆç‡å¾ˆä½ï¼Œäºæ˜¯æ–°ç‰ˆæœ¬çš„Redisåšäº†æ”¹è¿›</span><br></pre></td></tr></table></figure><h4 id="æ–°ç‰ˆæœ¬â€“å…¨é‡å¤åˆ¶"><a href="#æ–°ç‰ˆæœ¬â€“å…¨é‡å¤åˆ¶" class="headerlink" title="æ–°ç‰ˆæœ¬â€“å…¨é‡å¤åˆ¶"></a>æ–°ç‰ˆæœ¬â€“å…¨é‡å¤åˆ¶</h4><blockquote><p>å‘½ä»¤ï¼špsync<br>æ—¢å¯å®ç°å®Œæ•´å…¨åŒæ­¥ï¼Œä¹Ÿå¯å®ç°éƒ¨åˆ†åŒæ­¥  </p></blockquote><h5 id="å¤åˆ¶åç§»é‡ï¼šæ‰§è¡Œå¤åˆ¶çš„åŒæ–¹ï¼Œä¸»ä»æœåŠ¡å™¨ï¼Œåˆ†åˆ«ä¼šç»´æŠ¤ä¸€ä¸ªå¤åˆ¶åç§»é‡ï¼š"><a href="#å¤åˆ¶åç§»é‡ï¼šæ‰§è¡Œå¤åˆ¶çš„åŒæ–¹ï¼Œä¸»ä»æœåŠ¡å™¨ï¼Œåˆ†åˆ«ä¼šç»´æŠ¤ä¸€ä¸ªå¤åˆ¶åç§»é‡ï¼š" class="headerlink" title="å¤åˆ¶åç§»é‡ï¼šæ‰§è¡Œå¤åˆ¶çš„åŒæ–¹ï¼Œä¸»ä»æœåŠ¡å™¨ï¼Œåˆ†åˆ«ä¼šç»´æŠ¤ä¸€ä¸ªå¤åˆ¶åç§»é‡ï¼š"></a>å¤åˆ¶åç§»é‡ï¼šæ‰§è¡Œå¤åˆ¶çš„åŒæ–¹ï¼Œä¸»ä»æœåŠ¡å™¨ï¼Œåˆ†åˆ«ä¼šç»´æŠ¤ä¸€ä¸ªå¤åˆ¶åç§»é‡ï¼š</h5><ul><li>ä¸»æœåŠ¡å™¨æ¯æ¬¡å‘ä»æœåŠ¡å™¨åŒæ­¥äº†Nå­—èŠ‚æ•°æ®åï¼Œå°†ä¿®æ”¹è‡ªå·±çš„å¤åˆ¶åç§»é‡+N  </li><li>ä»æœåŠ¡å™¨æ¯æ¬¡ä»ä¸»æœåŠ¡å™¨åŒæ­¥äº†Nå­—èŠ‚æ•°æ®åï¼Œå°†ä¿®æ”¹è‡ªå·±çš„å¤åˆ¶åç§»é‡+N  </li></ul><h5 id="å¤åˆ¶ç§¯å‹ç¼“å†²åŒº"><a href="#å¤åˆ¶ç§¯å‹ç¼“å†²åŒº" class="headerlink" title="å¤åˆ¶ç§¯å‹ç¼“å†²åŒº"></a>å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</h5><blockquote><p>ä¸»æœåŠ¡å™¨å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ä½œä¸ºå¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œå…¶é»˜è®¤å¤§å°ä¸º1MB<br>åœ¨ä¸»æœåŠ¡å™¨è¿›è¡Œå‘½ä»¤ä¼ æ’­æ—¶ï¼Œä¸ä»…ä¼šå°†å†™å‘½ä»¤åŒæ­¥åˆ°ä»æœåŠ¡å™¨ï¼Œè¿˜ä¼šå°†å†™å‘½ä»¤å†™å…¥å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</p></blockquote><p><img src="/img/redis_2.png" alt=""></p><h5 id="æœåŠ¡å™¨è¿è¡ŒID"><a href="#æœåŠ¡å™¨è¿è¡ŒID" class="headerlink" title="æœåŠ¡å™¨è¿è¡ŒID"></a>æœåŠ¡å™¨è¿è¡ŒID</h5><p>æ¯ä¸ªRedisæœåŠ¡å™¨ï¼Œéƒ½æœ‰å…¶è¿è¡ŒIDï¼Œè¿è¡ŒIDç”±æœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œä¸»æœåŠ¡å™¨ä¼šå°†è‡ªå·±çš„è¿è¡ŒIDå‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨ä¼šå°†ä¸»æœåŠ¡å™¨çš„è¿è¡ŒIDå­˜èµ·æ¥ã€‚<br>ä»æœåŠ¡å™¨Redisæ–­å¼€é‡è¿çš„æ—¶å€™ï¼Œå°±æ˜¯æ ¹æ®è¿è¡ŒIDæ¥åˆ¤æ–­åŒæ­¥çš„è¿›åº¦ï¼š  </p><ul><li>å¦‚æœä»æœåŠ¡å™¨ä¸Šä¿å­˜çš„ä¸»æœåŠ¡å™¨è¿è¡ŒIDä¸å½“å‰ä¸»æœåŠ¡å™¨è¿è¡ŒIDä¸€è‡´ï¼Œåˆ™è¡¨ç¤ºæ­¤æ¬¡æ–­å¼€é‡è¿çš„æ˜¯ä¹‹å‰å¤åˆ¶çš„ä¸»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨å¯ä»¥ç»§ç»­å°è¯•éƒ¨åˆ†åŒæ­¥æ“ä½œ  </li><li>å¦åˆ™ï¼Œå¦‚æœå‰åä¸¤æ¬¡çš„ä¸»æœåŠ¡å™¨è¿è¡ŒIDä¸ç›¸åŒï¼Œåˆ™è®¤ä¸ºæ˜¯å®Œæˆå…¨åŒæ­¥æµç¨‹</li></ul><h5 id="psyncå‘½ä»¤æµç¨‹"><a href="#psyncå‘½ä»¤æµç¨‹" class="headerlink" title="psyncå‘½ä»¤æµç¨‹"></a>psyncå‘½ä»¤æµç¨‹</h5><p>psyncå‘½ä»¤çš„å¤§ä½“æµç¨‹å¦‚ä¸‹ï¼š   </p><ul><li>å¦‚æœä»æœåŠ¡å™¨ä¹‹å‰æ²¡æœ‰å¤åˆ¶è¿‡ä»»ä½•ä¸»æœåŠ¡å™¨ï¼Œæˆ–è€…ä¹‹å‰æ‰§è¡Œè¿‡slaveof no oneå‘½ä»¤ï¼Œä»æœåŠ¡å™¨å°±ä¼šå‘ä¸»æœåŠ¡å™¨å‘é€psync ? -1å‘½ä»¤ï¼Œè¯·æ±‚ä¸»æœåŠ¡å™¨è¿›è¡Œæ•°æ®çš„å…¨é‡åŒæ­¥  </li><li>å¦åˆ™ï¼Œå¦‚æœå‰é¢ä»æœåŠ¡å™¨å·²ç»åŒæ­¥è¿‡éƒ¨åˆ†æ•°æ®ï¼Œæ­¤æ—¶ä»æœåŠ¡å™¨å°±ä¼šå‘é€psync {runid} {offset}å‘½ä»¤ç»™ä¸»æœåŠ¡å™¨ï¼Œå…¶ä¸­runidæ˜¯ä¸Šä¸€æ¬¡ä¸»æœåŠ¡å™¨çš„è¿è¡ŒIDï¼Œoffsetæ˜¯å½“å‰ä»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡</li></ul><p>ä¸»æœåŠ¡å™¨æ”¶åˆ°psyncå‘½ä»¤åï¼Œä¼šå‡ºç°ä»¥ä¸‹ä¸‰ç§å¯èƒ½ï¼š</p><ul><li>ä¸»æœåŠ¡å™¨è¿”å› fullresync {runid} {offset}å›å¤ï¼Œè¡¨ç¤ºä¸»æœåŠ¡å™¨è¦æ±‚ä¸ä»æœåŠ¡å™¨è¿›è¡Œæ•°æ®çš„å®Œæ•´å…¨é‡å¤åˆ¶ï¼Œå…¶ä¸­runidè¡¨ç¤ºä¸»æœåŠ¡å™¨çš„è¿è¡ŒIDï¼Œoffsetè¡¨ç¤ºå½“å‰ä¸»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡</li><li>å¦‚æœä¸»æœåŠ¡å™¨è¿”å› +continueï¼Œè¡¨ç¤ºä¸»æœåŠ¡å™¨ä¸ä»æœåŠ¡å™¨ä¼šè¿›è¡Œéƒ¨åˆ†æ•°æ®çš„åŒæ­¥æ“ä½œï¼Œå°†ä»æœåŠ¡å™¨ç¼ºå¤±çš„æ•°æ®å¤åˆ¶è¿‡æ¥å³å¯</li><li>å¦‚æœä¸»æœåŠ¡å™¨è¿”å› -errï¼Œè¡¨ç¤ºä¸»æœåŠ¡å™¨çš„Redisç‰ˆæœ¬ä½äº2.8ï¼Œæ— æ³•è¯†åˆ«psyncå‘½ä»¤ï¼Œæ­¤æ—¶ä»æœåŠ¡å™¨ä¼šå‘ä¸»æœåŠ¡å™¨å‘é€syncå‘½ä»¤ï¼Œè¿›è¡Œå®Œæ•´çš„æ•°æ®å…¨é‡å¤åˆ¶</li></ul><p><img src="/img/redis_3.png" alt=""></p><h3 id="å“¨å…µæœºåˆ¶"><a href="#å“¨å…µæœºåˆ¶" class="headerlink" title="å“¨å…µæœºåˆ¶"></a>å“¨å…µæœºåˆ¶</h3><blockquote><p>å·¥ä½œåŸç†ï¼š  </p><ul><li>redisä½¿ç”¨ä¸€ç»„å“¨å…µï¼ˆsentinelï¼‰èŠ‚ç‚¹æ¥ç›‘æ§Redisä¸»ä»æœåŠ¡çš„å¯ç”¨æ€§</li><li>ä¸€æ—¦å‘ç°Redisä¸»èŠ‚ç‚¹å¤±æ•ˆï¼Œå°±ä¼šä»ä»èŠ‚ç‚¹ä¸­é€‰å–ä¸€ä¸ªä½œä¸ºé¢†å¯¼è€…ï¼ˆleaderï¼‰</li><li>å“¨å…µé¢†å¯¼è€…å†ä»å‰©ä½™çš„Redisä»èŠ‚ç‚¹ä¸­é€‰å–ä¸€ä¸ªä½œä¸ºRedisä¸»èŠ‚ç‚¹æ¥å¯¹å¤–æœåŠ¡<br>ä»¥ä¸Šå°†RedisèŠ‚ç‚¹åˆ†ä¸ºä¸¤ç±»ï¼š  </li><li>å“¨å…µèŠ‚ç‚¹ï¼ˆsentinelï¼‰ï¼šè´Ÿè´£ç›‘æ§èŠ‚ç‚¹çš„è¿è¡Œæƒ…å†µ</li><li>æ•°æ®èŠ‚ç‚¹ï¼šå³æ­£å¸¸æœåŠ¡å®¢æˆ·ç«¯çš„redisèŠ‚ç‚¹ï¼Œæœ‰ä¸»ä»åŒºåˆ†</li></ul></blockquote><h4 id="ä¸‰ä¸ªç›‘æ§ä»»åŠ¡ï¼šå¯¹Redisæ•°æ®èŠ‚ç‚¹è¿›è¡Œç›‘æ§"><a href="#ä¸‰ä¸ªç›‘æ§ä»»åŠ¡ï¼šå¯¹Redisæ•°æ®èŠ‚ç‚¹è¿›è¡Œç›‘æ§" class="headerlink" title="ä¸‰ä¸ªç›‘æ§ä»»åŠ¡ï¼šå¯¹Redisæ•°æ®èŠ‚ç‚¹è¿›è¡Œç›‘æ§"></a>ä¸‰ä¸ªç›‘æ§ä»»åŠ¡ï¼šå¯¹Redisæ•°æ®èŠ‚ç‚¹è¿›è¡Œç›‘æ§</h4><blockquote><p>å“¨å…µèŠ‚ç‚¹é€šè¿‡ä¸‰ä¸ªå®šæ—¶ç›‘æ§ä»»åŠ¡æ¥ç›‘æ§Redisæ•°æ®èŠ‚ç‚¹çš„æœåŠ¡å¯ç”¨æ€§  </p></blockquote><h5 id="infoå‘½ä»¤"><a href="#infoå‘½ä»¤" class="headerlink" title="infoå‘½ä»¤"></a>infoå‘½ä»¤</h5><p>æ¯éš”åç§’ï¼Œæ¯ä¸ªå“¨å…µèŠ‚ç‚¹éƒ½ä¼šå‘Redisçš„ä¸»ã€ä»èŠ‚ç‚¹å‘é€infoå‘½ä»¤ï¼Œè·å–æ–°çš„æ‹“æ‰‘ç»“æ„ä¿¡æ¯ã€‚<br>Redisæ‹“æ‰‘ç»“æ„ä¿¡æ¯åŒ…å«ï¼š</p><ul><li>æœ¬èŠ‚ç‚¹è§’è‰²ï¼šä¸»æˆ–ä»</li><li>ä¸»ä»èŠ‚ç‚¹çš„åœ°å€ã€ç«¯å£ä¿¡æ¯</li></ul><blockquote><p>è¿™æ ·å“¨å…µèŠ‚ç‚¹å°±èƒ½ä»infoå‘½ä»¤ä¸­è·å–ä»èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå› æ­¤åç»­åŠ å…¥çš„ä»èŠ‚ç‚¹ä¸éœ€è¦è¿›è¡Œæ˜¾æ€§çš„é…ç½®å°±èƒ½è‡ªåŠ¨æ„ŸçŸ¥ã€‚</p></blockquote><p><img src="/img/redis_4.png" alt=""></p><h5 id="å‘sentinel-helloé¢‘é“åŒæ­¥ä¿¡æ¯"><a href="#å‘sentinel-helloé¢‘é“åŒæ­¥ä¿¡æ¯" class="headerlink" title="å‘sentinel:helloé¢‘é“åŒæ­¥ä¿¡æ¯"></a>å‘<strong>sentinel</strong>:helloé¢‘é“åŒæ­¥ä¿¡æ¯</h5><p>æ¯éš”2ç§’ï¼Œæ¯ä¸ªå“¨å…µèŠ‚ç‚¹å°†ä¼šå‘redisæ•°æ®èŠ‚ç‚¹çš„<strong>sentinel</strong>:helloé¢‘é“åŒæ­¥è‡ªèº«å¾—åˆ°çš„ä¸»èŠ‚ç‚¹ä¿¡æ¯ä»¥åŠå½“å‰å“¨å…µèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œç”±äºå…¶ä»–å“¨å…µèŠ‚ç‚¹ä¹Ÿè®¢é˜…äº†è¿™ä¸ªé¢‘é“ï¼Œå› æ­¤å®é™…ä¸Šè¿™ä¸ªæ“ä½œå¯ä»¥äº¤æ¢å“¨å…µèŠ‚ç‚¹ä¹‹é—´å…³äºä¸»èŠ‚ç‚¹ä»¥åŠå“¨å…µèŠ‚ç‚¹çš„ä¿¡æ¯ã€‚</p><p>è¿™ä¸€æ“ä½œå®é™…ä¸Šå®Œæˆäº†ä¸¤ä»¶äº‹æƒ…ï¼š </p><ul><li>å‘ç°æ–°çš„å“¨å…µèŠ‚ç‚¹ï¼šå¦‚æœæœ‰æ–°çš„å“¨å…µèŠ‚ç‚¹åŠ å…¥ï¼Œæ­¤æ—¶ä¿å­˜ä¸‹æ¥è¿™ä¸ªæ–°å“¨å…µèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œåç»­ä¸è¯¥å“¨å…µèŠ‚ç‚¹å»ºç«‹è¿æ¥ã€‚ </li><li>äº¤æ¢ä¸»èŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯ï¼Œä½œä¸ºåç»­å®¢è§‚åˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸‹çº¿çš„ä¾æ®ã€‚</li></ul><p><img src="/img/redis_5.png" alt=""></p><h5 id="å‘æ•°æ®èŠ‚ç‚¹åšå¿ƒè·³æ¢æµ‹"><a href="#å‘æ•°æ®èŠ‚ç‚¹åšå¿ƒè·³æ¢æµ‹" class="headerlink" title="å‘æ•°æ®èŠ‚ç‚¹åšå¿ƒè·³æ¢æµ‹"></a>å‘æ•°æ®èŠ‚ç‚¹åšå¿ƒè·³æ¢æµ‹</h5><p>æ¯éš”1ç§’ï¼Œæ¯ä¸ªå“¨å…µèŠ‚ç‚¹å‘ä¸»ã€ä»æ•°æ®èŠ‚ç‚¹ä»¥åŠå…¶ä»–sentinelèŠ‚ç‚¹å‘é€pingå‘½ä»¤åšå¿ƒè·³æ¢æµ‹ï¼Œè¿™ä¸ªå¿ƒè·³æ¢æµ‹æ˜¯åç»­ä¸»è§‚åˆ¤æ–­æ•°æ®èŠ‚ç‚¹ä¸‹çº¿çš„ä¾æ®ã€‚</p><p><img src="/img/redis_6.png" alt=""></p><h4 id="ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿"><a href="#ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿" class="headerlink" title="ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿"></a>ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿</h4><h5 id="ä¸»è§‚ä¸‹çº¿"><a href="#ä¸»è§‚ä¸‹çº¿" class="headerlink" title="ä¸»è§‚ä¸‹çº¿"></a>ä¸»è§‚ä¸‹çº¿</h5><p>ä¸Šé¢ä¸‰ä¸ªç›‘æ§ä»»åŠ¡ä¸­çš„ç¬¬ä¸‰ä¸ªæ¢æµ‹å¿ƒè·³ä»»åŠ¡ï¼Œå¦‚æœåœ¨é…ç½®çš„down-after-millisecondsä¹‹åæ²¡æœ‰æ”¶åˆ°æœ‰æ•ˆå›å¤ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè¯¥æ•°æ®èŠ‚ç‚¹â€œä¸»è§‚ä¸‹çº¿ï¼ˆsdownï¼‰â€ã€‚</p><p><img src="/img/redis_7.png" alt=""></p><p>ä¸ºä»€ä¹ˆç§°ä¸ºâ€œä¸»è§‚ä¸‹çº¿â€ï¼Ÿå› ä¸ºåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæœ‰å¤šä¸ªæœºå™¨åœ¨ä¸€èµ·è”åŠ¨å·¥ä½œï¼Œç½‘ç»œå¯èƒ½å‡ºç°å„ç§çŠ¶å†µï¼Œä»…å‡­ä¸€ä¸ªèŠ‚ç‚¹çš„åˆ¤æ–­è¿˜ä¸è¶³ä»¥è®¤ä¸ºä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ä¸‹çº¿äº†ï¼Œè¿™å°±éœ€è¦åé¢çš„â€œå®¢è§‚ä¸‹çº¿â€ã€‚</p><h5 id="å®¢è§‚ä¸‹çº¿"><a href="#å®¢è§‚ä¸‹çº¿" class="headerlink" title="å®¢è§‚ä¸‹çº¿"></a>å®¢è§‚ä¸‹çº¿</h5><p>å½“ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹è®¤ä¸ºä¸»èŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿æ—¶ï¼Œè¯¥å“¨å…µèŠ‚ç‚¹éœ€è¦é€šè¿‡â€sentinel is-master-down-by addrâ€å‘½ä»¤å‘å…¶ä»–å“¨å…µèŠ‚ç‚¹å’¨è¯¢è¯¥ä¸»èŠ‚ç‚¹æ˜¯å¦ä¸‹çº¿äº†ï¼Œå¦‚æœæœ‰è¶…è¿‡åŠæ•°çš„å“¨å…µèŠ‚ç‚¹éƒ½å›ç­”äº†ä¸‹çº¿ï¼Œæ­¤æ—¶è®¤ä¸ºä¸»èŠ‚ç‚¹â€œå®¢è§‚ä¸‹çº¿â€ã€‚</p><p><img src="/img/redis_8.png" alt=""></p><h4 id="é€‰ä¸¾å“¨å…µé¢†å¯¼è€…"><a href="#é€‰ä¸¾å“¨å…µé¢†å¯¼è€…" class="headerlink" title="é€‰ä¸¾å“¨å…µé¢†å¯¼è€…"></a>é€‰ä¸¾å“¨å…µé¢†å¯¼è€…</h4><p>å½“ä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿æ—¶ï¼Œéœ€è¦é€‰ä¸¾å‡ºä¸€ä¸ªå“¨å…µèŠ‚ç‚¹åšä¸ºå“¨å…µé¢†å¯¼è€…ï¼Œä»¥å®Œæˆåç»­é€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹çš„å·¥ä½œã€‚</p><p>è¿™ä¸ªé€‰ä¸¾çš„å¤§ä½“æ€è·¯æ˜¯ï¼š</p><ul><li>æ¯ä¸ªå“¨å…µèŠ‚ç‚¹é€šè¿‡å‘å…¶ä»–å“¨å…µèŠ‚ç‚¹å‘é€â€sentinel is-master-down-by addrâ€å‘½ä»¤æ¥ç”³è¯·æˆä¸ºå“¨å…µé¢†å¯¼è€…ã€‚</li><li>è€Œæ¯ä¸ªå“¨å…µèŠ‚ç‚¹åœ¨æ”¶åˆ°ä¸€ä¸ªâ€sentinel is-master-down-by addrâ€å‘½ä»¤æ—¶ï¼Œåªå…è®¸ç»™ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æŠ•ç¥¨ï¼Œå…¶ä»–èŠ‚ç‚¹çš„è¯¥å‘½ä»¤éƒ½ä¼šè¢«æ‹’ç»ã€‚</li><li>å¦‚æœä¸€ä¸ªå“¨å…µèŠ‚ç‚¹æ”¶åˆ°äº†åŠæ•°ä»¥ä¸Šçš„åŒæ„ç¥¨ï¼Œåˆ™æˆä¸ºå“¨å…µé¢†å¯¼è€…ã€‚</li><li>å¦‚æœå‰é¢ä¸‰æ­¥åœ¨ä¸€å®šæ—¶é—´å†…éƒ½æ²¡æœ‰é€‰å‡ºä¸€ä¸ªå“¨å…µé¢†å¯¼è€…ï¼Œå°†é‡æ–°å¼€å§‹ä¸‹ä¸€æ¬¡é€‰ä¸¾ã€‚  </li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªé€‰ä¸¾é¢†å¯¼è€…çš„æµç¨‹å¾ˆåƒraftä¸­é€‰ä¸¾leaderçš„æµç¨‹ã€‚</p><p><img src="/img/redis_9.png" alt=""></p><h4 id="é€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹"><a href="#é€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹" class="headerlink" title="é€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹"></a>é€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹</h4><p>åœ¨å‰©ä¸‹çš„redisä»èŠ‚ç‚¹ä¸­ï¼ŒæŒ‰ç…§ä»¥ä¸‹é¡ºåºæ¥é€‰æ‹©æ–°çš„ä¸»èŠ‚ç‚¹ï¼š</p><ul><li>è¿‡æ»¤æ‰â€œä¸å¥åº·â€çš„æ•°æ®èŠ‚ç‚¹ï¼šæ¯”å¦‚ä¸»è§‚ä¸‹çº¿ã€æ–­çº¿çš„ä»èŠ‚ç‚¹ã€äº”ç§’å†…æ²¡æœ‰å›å¤è¿‡å“¨å…µèŠ‚ç‚¹pingå‘½ä»¤çš„èŠ‚ç‚¹ã€ä¸ä¸»èŠ‚ç‚¹å¤±è”çš„ä»èŠ‚ç‚¹ã€‚</li><li>é€‰æ‹©slave-priorityï¼ˆä»èŠ‚ç‚¹ä¼˜å…ˆçº§ï¼‰æœ€é«˜çš„ä»èŠ‚ç‚¹ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›ä¸å­˜åœ¨åˆ™ç»§ç»­åé¢çš„æµç¨‹ã€‚</li><li>é€‰æ‹©å¤åˆ¶åç§»é‡æœ€å¤§çš„ä»èŠ‚ç‚¹ï¼Œè¿™æ„å‘³ç€è¿™ä¸ªä»èŠ‚ç‚¹ä¸Šé¢çš„æ•°æ®æœ€å®Œæ•´ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›ä¸å­˜åœ¨åˆ™ç»§ç»­åé¢çš„æµç¨‹ã€‚ </li><li>åˆ°äº†è¿™é‡Œï¼Œæ‰€æœ‰å‰©ä½™ä»èŠ‚ç‚¹çš„çŠ¶æ€éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé€‰æ‹©runidæœ€å°çš„ä»èŠ‚ç‚¹ã€‚</li></ul><p><img src="/img/redis_10.png" alt=""></p><h4 id="æå‡æ–°çš„ä¸»èŠ‚ç‚¹"><a href="#æå‡æ–°çš„ä¸»èŠ‚ç‚¹" class="headerlink" title="æå‡æ–°çš„ä¸»èŠ‚ç‚¹"></a>æå‡æ–°çš„ä¸»èŠ‚ç‚¹</h4><p>é€‰æ‹©äº†æ–°çš„ä¸»èŠ‚ç‚¹ä¹‹åï¼Œè¿˜éœ€è¦æœ€åçš„æµç¨‹è®©è¯¥èŠ‚ç‚¹æˆä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼š</p><ul><li>å“¨å…µé¢†å¯¼è€…å‘ä¸Šä¸€æ­¥é€‰å‡ºçš„ä»èŠ‚ç‚¹å‘å‡ºâ€œslaveof no oneâ€å‘½ä»¤ï¼Œè®©è¯¥èŠ‚ç‚¹æˆä¸ºä¸»èŠ‚ç‚¹ã€‚</li><li>å“¨å…µé¢†å¯¼è€…å‘å‰©ä½™çš„ä»èŠ‚ç‚¹å‘é€å‘½ä»¤ï¼Œè®©å®ƒä»¬æˆä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ã€‚</li><li>å“¨å…µèŠ‚ç‚¹é›†åˆä¼šå°†åŸæ¥çš„ä¸»èŠ‚ç‚¹æ›´æ–°ä¸ºä»èŠ‚ç‚¹ï¼Œå½“å…¶æ¢å¤ä¹‹åå‘½ä»¤å®ƒå»å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹çš„æ•°æ®</li></ul><p><img src="/img/redis_11.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;redisæ•°æ®ä¸»ä»å¤åˆ¶&quot;&gt;&lt;a href=&quot;#redisæ•°æ®ä¸»ä»å¤åˆ¶&quot; class=&quot;headerlink&quot; title=&quot;redisæ•°æ®ä¸»ä»å¤åˆ¶&quot;&gt;&lt;/a&gt;redisæ•°æ®ä¸»ä»å¤åˆ¶&lt;/h3&gt;&lt;h4 id=&quot;æ—§ç‰ˆæœ¬â€“å…¨é‡å¤åˆ¶&quot;&gt;&lt;a href=&quot;#æ—§ç‰ˆæœ¬â€“å…¨é‡å¤åˆ¶&quot;
      
    
    </summary>
    
      <category term="Redis" scheme="https://zhipenwang.github.io/categories/Redis/"/>
    
    
      <category term="Redis" scheme="https://zhipenwang.github.io/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>PHPé”™è¯¯åŠå¼‚å¸¸å¤„ç†</title>
    <link href="https://zhipenwang.github.io/2019/05/10/2019_05_10/"/>
    <id>https://zhipenwang.github.io/2019/05/10/2019_05_10/</id>
    <published>2019-05-09T16:00:00.000Z</published>
    <updated>2019-05-10T08:58:26.320Z</updated>
    
    <content type="html"><![CDATA[<h3 id="set-error-handler"><a href="#set-error-handler" class="headerlink" title="set_error_handler()"></a>set_error_handler()</h3><blockquote><p>æ•è·é”™è¯¯ï¼Œåªèƒ½æ•è·ç³»ç»Ÿäº§ç”Ÿçš„ä¸€äº›Warningã€Noticeçº§åˆ«é”™è¯¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ä»£ç ï¼š</span><br><span class="line">set_error_handler(&apos;func_error&apos;);</span><br><span class="line">function func_error($type, $message, $file, $line) &#123;</span><br><span class="line">var_dump(&quot;&lt;b&gt;set_error_handler: &quot; . $type . &quot;:&quot; . $message . &quot; in &quot; . $file . &quot; on &quot; . $line . &quot; line .&lt;/b&gt;&lt;br /&gt;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">echo $name;</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œç»“æœï¼šstring(108) &quot;set_error_handler: 8:Undefined variable: name in /data/code/www/test/exception.php on 10 line .&quot;</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="register-shutdown-function"><a href="#register-shutdown-function" class="headerlink" title="register_shutdown_function()"></a>register_shutdown_function()</h3><blockquote><p>PHPæ‰§è¡Œç»“æŸå‰æœ€åä¸€ä¸ªè°ƒç”¨çš„å‡½æ•°<br>åªåœ¨parse-timeå‡ºé”™æ—¶æ˜¯ä¸ä¼šè°ƒç”¨æœ¬å‡½æ•°çš„ã€‚åªæœ‰åœ¨run-timeå‡ºé”™çš„æ—¶å€™ï¼Œæ‰ä¼šè°ƒç”¨æœ¬å‡½æ•°<br>error_get_last() å¯ä»¥æ‹¿åˆ°æœ¬æ¬¡æ‰§è¡Œäº§ç”Ÿçš„æ‰€æœ‰é”™è¯¯</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ä»£ç ï¼š</span><br><span class="line">register_shutdown_function(&apos;func_shutdown&apos;);</span><br><span class="line">function func_shutdown() &#123;</span><br><span class="line">if ($error = error_get_last()) &#123;</span><br><span class="line">var_dump(&quot;&lt;b&gt;register_shutdown_function: Type:&quot; . $error[&apos;type&apos;] . &quot; Msg:&quot; . $error[&apos;message&apos;] . &quot; in &quot; . $error[&apos;file&apos;] . &quot;on line &quot; . $error[&apos;line&apos;] . &quot;&lt;/b&gt;&lt;br /&gt;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">require_once(&quot;error.php&quot;);</span><br><span class="line"></span><br><span class="line">error.php: </span><br><span class="line">echo 23++--;</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œç»“æœï¼š</span><br><span class="line">Parse error: syntax error, unexpected &apos;++&apos; (T_INC), expecting &apos;,&apos; or &apos;;&apos; in /data/code/www/test/error.php on line 2</span><br><span class="line">string(153) &quot;register_shutdown_function: Type:4 Msg:syntax error, unexpected &apos;++&apos; (T_INC), expecting &apos;,&apos; or &apos;;&apos; in /data/code/www/test/error.phpon line 2&quot;</span><br></pre></td></tr></table></figure><h3 id="set-exception-handler"><a href="#set-exception-handler" class="headerlink" title="set_exception_handler()"></a>set_exception_handler()</h3><blockquote><p>æ²¡æœ‰ç”¨try/catchå—æ¥æ•è·çš„å¼‚å¸¸æˆ–æ²¡æœ‰è¢«æ•è·çš„å¼‚å¸¸å°±ä¼šè¿›å…¥æ­¤æ–¹æ³•ï¼Œå›è°ƒå‡½æ•°æ‰§è¡Œåå¼‚å¸¸ä¼šä¸­æ­¢</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ä»£ç </span><br><span class="line">set_exception_handler(&apos;func_exception&apos;);</span><br><span class="line">function func_exception(Exception $e) &#123;</span><br><span class="line">var_dump(&quot;&lt;b&gt;set_exception_handler: Exception: &quot; . $e-&gt;getMessage() . &quot;&lt;/b&gt;&lt;br /&gt;&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">throw new Exception(&quot;Error Processing Request&quot;, 1);</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œç»“æœï¼š</span><br><span class="line">string(71) &quot;set_exception_handler: Exception: Error Processing Request&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;set-error-handler&quot;&gt;&lt;a href=&quot;#set-error-handler&quot; class=&quot;headerlink&quot; title=&quot;set_error_handler()&quot;&gt;&lt;/a&gt;set_error_handler()&lt;/h3&gt;&lt;blockquo
      
    
    </summary>
    
      <category term="PHP" scheme="https://zhipenwang.github.io/categories/PHP/"/>
    
    
      <category term="PHP" scheme="https://zhipenwang.github.io/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>URLåœ¨Nginxä¸Apacheä¸‹çš„é‡å†™è§„åˆ™</title>
    <link href="https://zhipenwang.github.io/2019/05/04/2019_05_04/"/>
    <id>https://zhipenwang.github.io/2019/05/04/2019_05_04/</id>
    <published>2019-05-03T16:00:00.000Z</published>
    <updated>2019-05-05T09:18:10.105Z</updated>
    
    <content type="html"><![CDATA[<h3 id="nginxä¸‹çš„urlé‡å†™"><a href="#nginxä¸‹çš„urlé‡å†™" class="headerlink" title="nginxä¸‹çš„urlé‡å†™"></a>nginxä¸‹çš„urlé‡å†™</h3><p>ä¿®æ”¹nginxçš„é…ç½®æ–‡ä»¶ï¼Œnginx.conf<br>ä¿®æ”¹æŸä¸ªç«™ç‚¹ç›®å½•ä¸‹çš„urlé‡å†™è§„åˆ™<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    location /zhipeng/ &#123;</span><br><span class="line">        if (!-e $request_filename)&#123;</span><br><span class="line">            rewrite  ^/zhipeng/(.*)$  /zhipeng/index.php?s=$1  last;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹æ•´ç«™çš„urlé‡å†™è§„åˆ™<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    rewrite  ^/zhipeng/(.*)$  /zhipeng/index.php?s=$1  last;</span><br><span class="line">    //rewrite è§„åˆ™ å®šå‘è·¯å¾„ é‡å†™ç±»å‹</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><blockquote><p>è§„åˆ™ï¼šå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ­£åˆ™æ¥è¡¨ç¤ºæƒ³åŒ¹é…çš„ç›®æ ‡url<br>å®šå‘è·¯å¾„ï¼šè¡¨ç¤ºåŒ¹é…åˆ°è§„åˆ™åè¦å®šå‘çš„è·¯å¾„ï¼Œå¦‚æœè§„åˆ™é‡Œæœ‰æ­£åˆ™ï¼Œåˆ™å¯ä»¥ä½¿ç”¨$indexæ¥è¡¨ç¤ºæ­£åˆ™é‡Œçš„æ•è·åˆ†ç»„<br>é‡å†™ç±»å‹ï¼š  </p><blockquote><p>last ï¼šç›¸å½“äºApacheé‡Œå¾·(L)æ ‡è®°ï¼Œè¡¨ç¤ºå®Œæˆrewriteï¼Œæµè§ˆå™¨åœ°å€æ URLåœ°å€ä¸å˜<br>    breakï¼›æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆåï¼Œç»ˆæ­¢åŒ¹é…ï¼Œä¸å†åŒ¹é…åé¢çš„è§„åˆ™ï¼Œæµè§ˆå™¨åœ°å€æ URLåœ°å€ä¸å˜<br>    redirectï¼šè¿”å›302ä¸´æ—¶é‡å®šå‘ï¼Œæµè§ˆå™¨åœ°å€ä¼šæ˜¾ç¤ºè·³è½¬åçš„URLåœ°å€<br>    permanentï¼šè¿”å›301æ°¸ä¹…é‡å®šå‘ï¼Œæµè§ˆå™¨åœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„URLåœ°å€  </p></blockquote></blockquote><h3 id="apacheä¸‹çš„urlé‡å†™"><a href="#apacheä¸‹çš„urlé‡å†™" class="headerlink" title="apacheä¸‹çš„urlé‡å†™"></a>apacheä¸‹çš„urlé‡å†™</h3><p>ä¿®æ”¹apacheçš„é…ç½®æ–‡ä»¶http.conf<br>å¼€å¯ rewriteæ¨¡å—ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LoadModule rewrite_module modules/mod_rewrite.so</span><br></pre></td></tr></table></figure></p><p>è‡ªå®šä¹‰ç«™ç‚¹ç›®å½•çš„é‡å†™è§„åˆ™<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åœ¨è¦æ”¯æŒurl rewriteçš„ç›®å½•å¯ç”¨ï¼š</span><br><span class="line"> Options FollowSymLinks å’Œ AllowOverride All</span><br></pre></td></tr></table></figure></p><p>ç«™ç‚¹ç›®å½•ä¸‹æ·»åŠ  .htaccessæ–‡ä»¶,æ·»åŠ å†…å®¹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;IfModule mod_rewrite.c&gt;</span><br><span class="line">  Options +FollowSymlinks</span><br><span class="line">  RewriteEngine On</span><br><span class="line"></span><br><span class="line">  RewriteCond %&#123;REQUEST_FILENAME&#125; !-d</span><br><span class="line">  RewriteCond %&#123;REQUEST_FILENAME&#125; !-f</span><br><span class="line">  RewriteRule ^(.*)$ index.php/$1 [QSA,PT,L]</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure></p><blockquote><p>%{REQUEST_FILENAME}è·å¾—ä¸€ä¸ªæœåŠ¡å™¨å˜é‡çš„å€¼<br>!-fæ˜¯æ­£åˆ™ï¼Œå…¶ä¸­æ„Ÿå¹å·è¡¨å¦å®šï¼Œ-fç”¨æ¥æ£€æµ‹å½“å‰å€¼æ‰€ä»£è¡¨çš„è·¯å¾„æ˜¯å¦æ˜¯ä¸€ä¸ªå¸¸è§„æ–‡ä»¶<br>$1ä»£è¡¨å¼•ç”¨RewriteRuleä¸­çš„ç¬¬ä¸€ä¸ªæ­£åˆ™(.*)ä»£è¡¨çš„å­—ç¬¦  </p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;nginxä¸‹çš„urlé‡å†™&quot;&gt;&lt;a href=&quot;#nginxä¸‹çš„urlé‡å†™&quot; class=&quot;headerlink&quot; title=&quot;nginxä¸‹çš„urlé‡å†™&quot;&gt;&lt;/a&gt;nginxä¸‹çš„urlé‡å†™&lt;/h3&gt;&lt;p&gt;ä¿®æ”¹nginxçš„é…ç½®æ–‡ä»¶ï¼Œnginx.conf&lt;br&gt;ä¿®æ”¹æŸ
      
    
    </summary>
    
      <category term="æœåŠ¡å™¨" scheme="https://zhipenwang.github.io/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
      <category term="PHP" scheme="https://zhipenwang.github.io/tags/PHP/"/>
    
      <category term="Nginx" scheme="https://zhipenwang.github.io/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>redisï¼šå†…å­˜æ»¡äº†ä½ èƒ½æ€ä¹ˆåŠ</title>
    <link href="https://zhipenwang.github.io/2019/04/23/2019_04_23/"/>
    <id>https://zhipenwang.github.io/2019/04/23/2019_04_23/</id>
    <published>2019-04-22T16:00:00.000Z</published>
    <updated>2019-04-23T08:21:51.944Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>redisæ˜¯çº¯å†…å­˜ï¼Œkey-valueçš„æ•°æ®åº“ã€‚</p></blockquote><p>è§£å†³æ–¹æ³•ï¼š</p><ol><li>å¢åŠ å†…å­˜</li><li>ä½¿ç”¨å†…å­˜æ·˜æ±°ç­–ç•¥ï¼ˆLRUï¼‰</li><li>Redisé›†ç¾¤</li></ol><p><em>ç¬¬ä¸€ç‚¹æ˜¯æœ€ç¬¨çš„æ–¹æ³•ï¼Œè€—é’±è€—èµ„æºï¼Œé€‚åˆæœ‰é’±çš„å¤§ä½¬ğŸ˜‚ï¼Œæœ¬æ–‡ä¸»è¦è®²è§£ç¬¬äºŒç‚¹è·Ÿç¬¬ä¸‰ç‚¹ã€‚</em></p><h3 id="ä½¿ç”¨å†…å­˜æ·˜æ±°ç­–ç•¥ï¼ˆLRUï¼‰"><a href="#ä½¿ç”¨å†…å­˜æ·˜æ±°ç­–ç•¥ï¼ˆLRUï¼‰" class="headerlink" title="ä½¿ç”¨å†…å­˜æ·˜æ±°ç­–ç•¥ï¼ˆLRUï¼‰"></a>ä½¿ç”¨å†…å­˜æ·˜æ±°ç­–ç•¥ï¼ˆLRUï¼‰</h3><blockquote><p>redisè®¾ç½®é…ç½®æ–‡ä»¶çš„maxmemoryå‚æ•°ï¼Œå¯ä»¥æ§åˆ¶å…¶æœ€å¤§å¯ä»¥ç”¨çš„å†…å­˜å¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€‚<br>å½“æ‰€éœ€å†…å­˜è¶…è¿‡äº†maxmemoryåï¼Œéœ€è¦å»ä¿®æ”¹é…ç½®æ–‡ä»¶çš„maxmemory-policyå‚æ•°äº†ã€‚</p></blockquote><p>maxmemory-policyï¼Œé»˜è®¤å€¼ä¸ºã€noevictionã€‘ï¼Œä¸‹åˆ—ä¸ºåˆ é™¤redisé”®å…·æœ‰çš„æ·˜æ±°è§„åˆ™ã€‚</p><blockquote><p>LRUç®—æ³•ï¼Œleast RecentlyUsedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´é»˜è®¤åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é”®ã€‚</p></blockquote><table><thead><tr><th>è§„åˆ™åç§°</th><th>è§„åˆ™è¯´æ˜</th></tr></thead><tbody><tr><td>volatile-lru</td><td>ä½¿ç”¨LRUç®—æ³•åˆ é™¤ä¸€ä¸ªé”®ï¼ˆåªå¯¹è®¾ç½®äº†ç”Ÿå­˜æ—¶é—´çš„é”®ï¼‰ï¼Œæœ€å°‘ä½¿ç”¨çš„</td></tr><tr><td>allkeys-lru</td><td>ä½¿ç”¨LRUç®—æ³•åˆ é™¤ä¸€ä¸ªé”®ï¼Œæœ€å°‘ä½¿ç”¨çš„</td></tr><tr><td>volatile-random</td><td>éšæœºåˆ é™¤ä¸€ä¸ªé”®ï¼ˆåªå¯¹è®¾ç½®äº†ç”Ÿå­˜é•¿æ—¶é—´çš„é”®ï¼‰</td></tr><tr><td>allkeys-random</td><td>éšæœºåˆ é™¤ä¸€ä¸ªé”®</td></tr><tr><td>volatile-ttl</td><td>åˆ é™¤ç”Ÿå­˜æ—¶é—´æœ€è¿‘çš„ä¸€ä¸ªé”®</td></tr><tr><td>noeviction</td><td>ä¸åˆ é™¤é”®ï¼Œåªè¿”å›é”™è¯¯</td></tr></tbody></table><blockquote><p>ä½œä¸ºå†…å­˜æ•°æ®åº“ï¼Œå‡ºäºå¯¹æ€§èƒ½å’Œå†…å­˜æ¶ˆè€—çš„è€ƒè™‘ï¼ŒRedis çš„æ·˜æ±°ç®—æ³•å®é™…å®ç°ä¸Šå¹¶éé’ˆå¯¹æ‰€æœ‰ keyï¼Œè€Œæ˜¯æŠ½æ ·ä¸€å°éƒ¨åˆ†å¹¶ä¸”ä»ä¸­é€‰å‡ºè¢«æ·˜æ±°çš„ keyã€‚</p><p>ä½¿ç”¨ Redis ç¼“å­˜æ•°æ®æ—¶ï¼Œä¸ºäº†æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼Œéœ€è¦ä¿è¯ç¼“å­˜æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ã€‚å¯ä»¥å°†å†…å­˜æœ€å¤§ä½¿ç”¨é‡è®¾ç½®ä¸ºçƒ­ç‚¹æ•°æ®å ç”¨çš„å†…å­˜é‡ï¼Œç„¶åå¯ç”¨ allkeys-lru æ·˜æ±°ç­–ç•¥ï¼Œå°†æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚</p><p>Redis 4.0 å¼•å…¥äº† volatile-lfu å’Œ allkeys-lfu æ·˜æ±°ç­–ç•¥ï¼ŒLFU ç­–ç•¥é€šè¿‡ç»Ÿè®¡è®¿é—®é¢‘ç‡ï¼Œå°†è®¿é—®é¢‘ç‡æœ€å°‘çš„é”®å€¼å¯¹æ·˜æ±°ã€‚</p></blockquote><p>ä½†æ˜¯ä¸€å®šè¦æ³¨æ„ä¸€ç‚¹ï¼redisä¸­å¹¶ä¸ä¼šå‡†ç¡®çš„åˆ é™¤æ‰€æœ‰é”®ä¸­æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é”®ï¼Œè€Œæ˜¯éšæœºæŠ½å–3ä¸ªé”®ï¼Œåˆ é™¤è¿™ä¸‰ä¸ªé”®ä¸­æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é”®ã€‚<br>é‚£ä¹ˆ3è¿™ä¸ªæ•°å­—ä¹Ÿæ˜¯å¯ä»¥è®¾ç½®çš„ï¼Œå¯¹åº”ä½ç½®æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„maxmeory-samples.</p><h3 id="Redisé›†ç¾¤"><a href="#Redisé›†ç¾¤" class="headerlink" title="Redisé›†ç¾¤"></a>Redisé›†ç¾¤</h3><p><em>Redisä»…æ”¯æŒå•å®ä¾‹ï¼Œå†…å­˜ä¸€èˆ¬æœ€å¤š10~20GBã€‚å¯¹äºå†…å­˜åŠ¨è¾„100~200GBçš„ç³»ç»Ÿï¼Œå°±éœ€è¦é€šè¿‡é›†ç¾¤æ¥æ”¯æŒäº†ã€‚</em></p><p>Redisé›†ç¾¤æœ‰ä¸‰ç§æ–¹å¼ï¼šå®¢æˆ·ç«¯åˆ†ç‰‡ã€ä»£ç†åˆ†ç‰‡ã€RedisClusterã€‚</p><h4 id="å®¢æˆ·ç«¯åˆ†ç‰‡"><a href="#å®¢æˆ·ç«¯åˆ†ç‰‡" class="headerlink" title="å®¢æˆ·ç«¯åˆ†ç‰‡"></a>å®¢æˆ·ç«¯åˆ†ç‰‡</h4><p>é€šè¿‡ä¸šåŠ¡ä»£ç è‡ªå·±å®ç°è·¯ç”±</p><blockquote><p>ä¼˜åŠ¿ï¼šå¯ä»¥è‡ªå·±æ§åˆ¶åˆ†ç‰‡ç®—æ³•ã€æ€§èƒ½æ¯”ä»£ç†çš„å¥½<br>åŠ£åŠ¿ï¼šç»´æŠ¤æˆæœ¬é«˜ã€æ‰©å®¹/ç¼©å®¹ç­‰è¿ç»´æ“ä½œéƒ½éœ€è¦è‡ªå·±ç ”å‘</p></blockquote><h4 id="ä»£ç†åˆ†ç‰‡ï¼ˆredisä¸­é—´ä»¶ï¼‰"><a href="#ä»£ç†åˆ†ç‰‡ï¼ˆredisä¸­é—´ä»¶ï¼‰" class="headerlink" title="ä»£ç†åˆ†ç‰‡ï¼ˆredisä¸­é—´ä»¶ï¼‰"></a>ä»£ç†åˆ†ç‰‡ï¼ˆredisä¸­é—´ä»¶ï¼‰</h4><p>ä»£ç†ç¨‹åºæ¥æ”¶åˆ°æ¥è‡ªä¸šåŠ¡ç¨‹åºçš„æ•°æ®è¯·æ±‚ï¼Œæ ¹æ®è·¯ç”±è§„åˆ™ï¼Œå°†è¿™äº›è¯·æ±‚åˆ†å‘ç»™æ­£ç¡®çš„Rediså®ä¾‹å¹¶è¿”å›ç»™ä¸šåŠ¡ç¨‹åºã€‚ä½¿ç”¨ç±»ä¼¼Twemproxyã€Codisç­‰ä¸­é—´ä»¶å®ç°ã€‚</p><blockquote><p>ä¼˜åŠ¿ï¼šè¿ç»´æ–¹ä¾¿ã€ç¨‹åºä¸ç”¨å…³å¿ƒå¦‚ä½•é“¾æ¥Rediså®ä¾‹<br>åŠ£åŠ¿ï¼šä¼šå¸¦æ¥æ€§èƒ½æ¶ˆè€—ï¼ˆå¤§æ¦‚20%ï¼‰ã€æ— æ³•å¹³æ»‘æ‰©å®¹/ç¼©å®¹ï¼Œéœ€è¦æ‰§è¡Œè„šæœ¬è¿ç§»æ•°æ®ï¼Œä¸æ–¹ä¾¿(Codisåœ¨TwemproxyåŸºç¡€ä¸Šä¼˜åŒ–å¹¶å®ç°äº†é¢„åˆ†ç‰‡æ¥è¾¾åˆ°Auto Rebalance)ã€‚</p></blockquote><h4 id="Redis-Cluster"><a href="#Redis-Cluster" class="headerlink" title="Redis Cluster"></a>Redis Cluster</h4><blockquote><p>ä¼˜åŠ¿ï¼šå®˜æ–¹é›†ç¾¤è§£å†³æ–¹æ¡ˆã€æ— ä¸­å¿ƒèŠ‚ç‚¹ï¼Œå’Œå®¢æˆ·ç«¯ç›´è¿ï¼Œæ€§èƒ½è¾ƒå¥½<br>åŠ£åŠ¿ï¼šæ–¹æ¡ˆå¤ªé‡ã€æ— æ³•å¹³æ»‘æ‰©å®¹/ç¼©å®¹ï¼Œéœ€è¦æ‰§è¡Œç›¸åº”çš„è„šæœ¬ï¼Œä¸æ–¹ä¾¿ã€å¤ªæ–°ï¼Œæ²¡æœ‰ç›¸åº”æˆç†Ÿçš„è§£å†³æ¡ˆä¾‹</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;redisæ˜¯çº¯å†…å­˜ï¼Œkey-valueçš„æ•°æ®åº“ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è§£å†³æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¢åŠ å†…å­˜&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å†…å­˜æ·˜æ±°ç­–ç•¥ï¼ˆLRUï¼‰&lt;/li&gt;
&lt;li&gt;Redisé›†ç¾¤&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;
      
    
    </summary>
    
      <category term="redis" scheme="https://zhipenwang.github.io/categories/redis/"/>
    
    
      <category term="redis" scheme="https://zhipenwang.github.io/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥ç†è§£cgiä¸fastcgiï¼šnginxä¸fpmçš„å·¥ä½œæœºåˆ¶</title>
    <link href="https://zhipenwang.github.io/2019/04/18/2019_04_18/"/>
    <id>https://zhipenwang.github.io/2019/04/18/2019_04_18/</id>
    <published>2019-04-17T16:00:00.000Z</published>
    <updated>2019-04-18T09:18:05.977Z</updated>
    
    <content type="html"><![CDATA[<p><em>æœ¬æ–‡ä¸»è¦æ˜¯è®¨è®ºNginxä¸FPMçš„å·¥ä½œæœºåˆ¶åŠå…¶é…ç½®èƒŒåçš„åŸç†ï¼Œä»¥æ­¤æ¥çœŸæ­£ç†è§£Nginxä¸PHPçš„ååŒå·¥ä½œæœºåˆ¶ã€‚</em></p><blockquote><p>å…ˆæ¥è°ˆè°ˆCGIã€FastCGIä¸¤ä¸ªåè®®åŠPHP-FPMã€‚</p></blockquote><h3 id="CGI"><a href="#CGI" class="headerlink" title="CGI"></a>CGI</h3><p>CGIæ˜¯Web Serverä¸åå°è¯­è¨€äº¤äº’çš„åè®®ã€‚é€šè¿‡æ­¤åè®®ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨ä»»ä½•è¯­è¨€å¤„ç†web serverå‘æ¥çš„è¯·æ±‚ï¼ŒåŠ¨æ€çš„ç”Ÿæˆå†…å®¹ã€‚  </p><p>CGIçš„å·¥ä½œåŸç†ï¼š<br>æ¯å½“å®¢æˆ·è¯·æ±‚CGIçš„æ—¶å€™ï¼ŒWEBæœåŠ¡å™¨å°±è¯·æ±‚æ“ä½œç³»ç»Ÿç”Ÿæˆä¸€ä¸ªæ–°çš„CGIè§£é‡Šå™¨è¿›ç¨‹ï¼ˆå¦‚php-cgi.exeï¼‰ï¼ŒCGIçš„ä¸€ä¸ªè¿›ç¨‹å¤„ç†å®Œä¸€ä¸ªè¯·æ±‚åå°±é€€å‡ºï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚æ¥æ—¶å†åˆ›å»ºæ–°çš„è¿›ç¨‹ã€‚</p><p>CGIçš„ç¼ºç‚¹ï¼š<br>æ¯å¤„ç†ä¸€ä¸ªè¯·æ±‚éƒ½éœ€è¦forkå‡ºä¸€ä¸ªå…¨æ–°çš„è¿›ç¨‹ï¼Œéšç€Webçš„å…´èµ·ï¼Œé«˜å¹¶å‘è¶Šæ¥è¶Šæˆä¸ºå¸¸æ€ï¼Œè¿™æ ·ä½æ•ˆçš„æ–¹å¼æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚äºæ˜¯FastCGIè¯ç”Ÿäº†ã€‚</p><h3 id="FastCGI"><a href="#FastCGI" class="headerlink" title="FastCGI"></a>FastCGI</h3><p>FastCGIï¼Œé¡¾åæ€ä¹‰ä¸ºæ›´å¿«çš„CGIï¼Œå…è®¸åœ¨ä¸€ä¸ªè¿›ç¨‹å†…å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªè¯·æ±‚å¤„ç†å®Œæ¯•å°±ç›´æ¥ç»“æŸè¿›ç¨‹ï¼Œæ€§èƒ½ä¸Šæœ‰äº†å¾ˆå¤§çš„æé«˜ã€‚<br>FastCGIï¼Œå°±åƒä¸€ä¸ªå¸¸é©»ï¼ˆlong-liveï¼‰å‹çš„CGIï¼Œå¯ä»¥ä¸€ç›´æ‰§è¡Œç€ï¼Œåªè¦æ¿€æ´»åï¼Œä¸ä¼šæ¯æ¬¡éƒ½è¦èŠ±è´¹æ—¶é—´å»forkä¸€æ¬¡è¿›ç¨‹ï¼ˆè¿™æ˜¯CGIæœ€ä¸ºäººè¯Ÿç—…çš„fork-and-executeæ¨¡å¼ï¼‰ã€‚  </p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒFastCGIçš„æ•´ä¸ªå·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š  </p><ol><li>Web Serverå¯åŠ¨æ—¶è½½å…¥FastCGIè¿›ç¨‹ç®¡ç†å™¨ï¼ˆIIS ISAPIæˆ–Apache Moduleï¼‰</li><li>FastCGIè¿›ç¨‹ç®¡ç†å™¨è‡ªèº«åˆå§‹åŒ–ã€‚å¯åŠ¨å¤šä¸ªCGIè§£é‡Šå™¨è¿›ç¨‹ï¼ˆå¯è§å¤šä¸ªphp-cgiï¼‰å¹¶ç­‰å¾…æ¥è‡ªWeb Serverçš„è¿æ¥</li><li>å½“å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾Web Serveræ—¶ï¼ŒFastCGIè¿›ç¨‹ç®¡ç†å™¨é€‰æ‹©å¹¶è¿æ¥åˆ°ä¸€ä¸ªCGIè§£é‡Šå™¨ã€‚Web Serverå°†CGIç¯å¢ƒå˜é‡å’Œæ ‡å‡†è¾“å…¥å‘é€åˆ°FastCGIå­è¿›ç¨‹php-cgi</li></ol><h3 id="PHP-FPM"><a href="#PHP-FPM" class="headerlink" title="PHP_FPM"></a>PHP_FPM</h3><p>php-fpmæ˜¯PHPå†…ç½®çš„ä¸€ä¸ªFastCGIè¿›ç¨‹ç®¡ç†å™¨ã€‚æ˜¯ä¸€ç§masterï¼ˆä¸»ï¼‰/workerï¼ˆå­ï¼‰å¤šè¿›ç¨‹æ¶æ„ï¼Œä¸nginxè®¾è®¡é£æ ¼æœ‰ç‚¹ç±»ä¼¼ã€‚<br>masterè¿›ç¨‹åªæœ‰ä¸€ä¸ªï¼Œä¸»è¦è´Ÿè´£CGIåŠPHPç¯å¢ƒåˆå§‹åŒ–ã€ç«¯å£ç›‘å¬ã€äº‹ä»¶ç›‘å¬ã€å­è¿›ç¨‹çŠ¶æ€ç­‰ç­‰ï¼Œæ¥æ”¶æ¥è‡ªWeb Serverçš„è¯·æ±‚ï¼›è€Œworkerè¿›ç¨‹åˆ™ä¸€èˆ¬æœ‰å¤šä¸ªï¼ˆå…·ä½“æ•°é‡æ ¹æ®å®é™…éœ€è¦é…ç½®ï¼‰ï¼Œæ¯ä¸ªè¿›ç¨‹å†…éƒ¨éƒ½åµŒå…¥äº†ä¸€ä¸ªPHPè§£é‡Šå™¨ï¼Œæ˜¯PHPä»£ç çœŸæ­£æ‰§è¡Œçš„åœ°æ–¹ï¼Œè´Ÿè´£å¤„ç†phpè¯·æ±‚ã€‚</p><h4 id="è¿è¡Œæ¨¡å¼"><a href="#è¿è¡Œæ¨¡å¼" class="headerlink" title="è¿è¡Œæ¨¡å¼"></a>è¿è¡Œæ¨¡å¼</h4><p>åœ¨ä»‹ç»å…è®¸åŸç†ä¹‹å‰ï¼Œå…ˆäº†è§£å®ƒçš„å‡ ç§è¿è¡Œæ¨¡å¼ã€‚<br>php-fpmæ”¯æŒä¸‰ç§è¿è¡Œæ¨¡å¼ï¼Œåˆ†åˆ«ä¸ºstaticã€ondemandã€dynamicï¼Œé»˜è®¤ä¸ºdynamicã€‚  </p><ol><li>staticï¼šé™æ€æ¨¡å¼ï¼Œå¯åŠ¨æ—¶åˆ†é…å›ºå®šçš„workerè¿›ç¨‹ï¼Œé€šè¿‡è®¾ç½®pm.max_childrenå›ºå®šçš„workerè¿›ç¨‹æ•°</li><li>ondemandï¼šæŒ‰éœ€åˆ†é…ï¼Œå½“æ”¶åˆ°ç”¨æˆ·è¯·æ±‚æ—¶fork workerè¿›ç¨‹</li><li>dynamicï¼šåŠ¨æ€æ¨¡å¼ï¼Œå¯åŠ¨æ—¶åˆ†é…å›ºå®šçš„è¿›ç¨‹ï¼Œä¼´éšç€è¯·æ±‚æ•°å¢åŠ ï¼Œåœ¨è®¾å®šçš„æµ®åŠ¨èŒƒå›´è°ƒæ•´workerè¿›ç¨‹</li></ol><h4 id="è¿è¡ŒåŸç†"><a href="#è¿è¡ŒåŸç†" class="headerlink" title="è¿è¡ŒåŸç†"></a>è¿è¡ŒåŸç†</h4><p>php-fpmé‡‡ç”¨master/workeræ¶æ„è®¾è®¡ï¼Œä¸‹é¢è¯¦ç»†è®²è§£è¿™ä¸¤ä¸ªæ¨¡å—çš„è¿è¡ŒåŸç†ã€‚</p><h5 id="masterè¿›ç¨‹"><a href="#masterè¿›ç¨‹" class="headerlink" title="masterè¿›ç¨‹"></a>masterè¿›ç¨‹</h5><p>masterè¿›ç¨‹å·¥ä½œæµç¨‹åˆ†ä¸º4ä¸ªé˜¶æ®µ  </p><ol><li>cgiåˆå§‹åŒ–é˜¶æ®µï¼šåˆ†åˆ«è°ƒç”¨fcgi_init()å’Œ sapi_startup()å‡½æ•°ï¼Œæ³¨å†Œè¿›ç¨‹ä¿¡å·ä»¥åŠåˆå§‹åŒ–sapi_globalså…¨å±€å˜é‡ã€‚ </li><li>phpç¯å¢ƒåˆå§‹åŒ–é˜¶æ®µï¼šç”±cgi_sapi_module.startup è§¦å‘ã€‚å®é™…è°ƒç”¨php_cgi_startupå‡½æ•°ï¼Œè€Œphp_cgi_startupå†…éƒ¨åˆè°ƒç”¨php_module_startupæ‰§è¡Œã€‚<br> php_module_startupä¸»è¦åŠŸèƒ½ï¼š  <ol><li>åŠ è½½å’Œè§£æphpé…ç½®ï¼›  </li><li>åŠ è½½phpæ¨¡å—å¹¶è®°å…¥å‡½æ•°ç¬¦å·è¡¨(function_table)ï¼›  </li><li>åŠ è½½zendæ‰©å±• ;   </li><li>è®¾ç½®ç¦ç”¨å‡½æ•°å’Œç±»åº“é…ç½®ï¼›  </li><li>æ³¨å†Œå›æ”¶å†…å­˜æ–¹æ³•ï¼› </li></ol></li><li>php-fpmåˆå§‹åŒ–é˜¶æ®µï¼šæ‰§è¡Œfpm_init()å‡½æ•°ã€‚è´Ÿè´£è§£æphp-fpm.confæ–‡ä»¶é…ç½®ï¼Œè·å–è¿›ç¨‹ç›¸å…³å‚æ•°ï¼ˆå…è®¸è¿›ç¨‹æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ç­‰ï¼‰,åˆå§‹åŒ–è¿›ç¨‹æ± åŠäº‹ä»¶æ¨¡å‹ç­‰æ“ä½œã€‚ </li><li>php-fpmè¿è¡Œé˜¶æ®µï¼šæ‰§è¡Œfpm_run() å‡½æ•°ï¼Œè¿è¡Œåä¸»è¿›ç¨‹å‘ç”Ÿé˜»å¡ã€‚<br> è¯¥é˜¶æ®µåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šforkå­è¿›ç¨‹ å’Œ å¾ªç¯äº‹ä»¶ã€‚<br> forkå­è¿›ç¨‹éƒ¨åˆ†äº¤ç”±fpm_children_create_initialå‡½æ•°å¤„ç†ï¼ˆ æ³¨ï¼šondemandæ¨¡å¼åœ¨fpm_pctl_on_socket_acceptå‡½æ•°åˆ›å»ºï¼‰ã€‚<br> å¾ªç¯äº‹ä»¶éƒ¨åˆ†é€šè¿‡fpm_event_loopå‡½æ•°å¤„ç†ï¼Œå…¶å†…éƒ¨æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œè´Ÿè´£äº‹ä»¶çš„æ”¶é›†å·¥ä½œã€‚</li></ol><h5 id="workerè¿›ç¨‹"><a href="#workerè¿›ç¨‹" class="headerlink" title="workerè¿›ç¨‹"></a>workerè¿›ç¨‹</h5><p>workerè¿›ç¨‹åˆ†ä¸º æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ã€å¤„ç†è¯·æ±‚ã€è¯·æ±‚ç»“æŸä¸‰ä¸ªé˜¶æ®µã€‚  </p><ol><li><p>æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼šæ‰§è¡Œfcgi_accept_requestå‡½æ•°ï¼Œå…¶å†…éƒ¨é€šè¿‡è°ƒç”¨accept å‡½æ•°è·å–å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//è¯·æ±‚é”</span><br><span class="line">FCGI_LOCK(req-&gt;listen_socket);</span><br><span class="line">req-&gt;fd = accept(listen_socket, (struct sockaddr *)&amp;sa, &amp;len);</span><br><span class="line">//é‡Šæ”¾é”</span><br><span class="line">FCGI_UNLOCK(req-&gt;listen_socket);</span><br></pre></td></tr></table></figure><p> ä»ä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥æ³¨æ„åˆ°acceptä¹‹å‰æœ‰ä¸€ä¸ªè¯·æ±‚é”çš„æ“ä½œï¼Œè¿™ä¹ˆè®¾è®¡æ˜¯ä¸ºäº†é¿å…è¯·æ±‚å‡ºç°â€œæƒŠç¾¤â€çš„ç°è±¡ã€‚å½“ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„é€‰é¡¹ï¼Œå¯ä»¥å–æ¶ˆè¯¥åŠŸèƒ½ã€‚</p></li><li>å¤„ç†è¯·æ±‚é˜¶æ®µï¼š  <ol><li>é¦–å…ˆï¼Œåˆ†åˆ«è°ƒç”¨fpm_request_infoã€php_request_startupè·å–è¯·æ±‚å†…å®¹åŠæ³¨å†Œå…¨å±€å˜é‡(GETã€_POSTã€SERVERã€_ENVã€$_FILES)ï¼›  </li><li>ç„¶åæ ¹æ®è¯·æ±‚ä¿¡æ¯è°ƒç”¨php_fopen_primary_scriptè®¿é—®è„šæœ¬æ–‡ä»¶ï¼›  </li><li>æœ€åäº¤ç»™php_execute_scriptæ‰§è¡Œã€‚php_execute_scriptå†…éƒ¨è°ƒç”¨zend_execute_scriptsæ–¹æ³•å°†è„šæœ¬äº¤ç»™zendå¼•æ“å¤„ç†ã€‚ </li></ol></li><li>è¯·æ±‚ç»“æŸé˜¶æ®µï¼šæ‰§è¡Œphp_request_shutdownå‡½æ•°ã€‚æ­¤æ—¶å›è°ƒregister_shutdown_functionæ³¨å†Œçš„å‡½æ•°åŠ__destruct()æ–¹æ³•ï¼Œå‘é€å“åº”å†…å®¹ã€é‡Šæ”¾å†…å­˜ç­‰æ“ä½œã€‚</li></ol><h4 id="æ•´ä½“æµç¨‹"><a href="#æ•´ä½“æµç¨‹" class="headerlink" title="æ•´ä½“æµç¨‹"></a>æ•´ä½“æµç¨‹</h4><p>ä»FPMæ¥æ”¶åˆ°è¯·æ±‚åˆ°å¤„ç†å®Œæ¯•ï¼Œå…¶å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>FPMçš„masterè¿›ç¨‹æ¥æ”¶åˆ°è¯·æ±‚</li><li>masterè¿›ç¨‹æ ¹æ®é…ç½®æŒ‡æ´¾ç‰¹å®šçš„workerè¿›ç¨‹è¿›è¡Œè¯·æ±‚å¤„ç†ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨è¿›ç¨‹ï¼Œè¿”å›é”™è¯¯ï¼Œè¿™ä¹Ÿæ˜¯åœ¨é…åˆNginxé‡åˆ°502é”™è¯¯æ¯”è¾ƒå¤šçš„åŸå› </li><li>workerè¿›ç¨‹å¤„ç†è¯·æ±‚ï¼Œå¦‚æœè¶…æ—¶ï¼Œè¿”å›504é”™è¯¯</li><li>è¯·æ±‚å¤„ç†ç»“æŸï¼Œè¿”å›ç»“æœ</li></ol><blockquote><p>ä¸‹é¢ä»Nginxå±‚é¢æ¥è¯´æ˜ä¸fpmçš„è¯·æ±‚å¤„ç†ã€‚</p></blockquote><h3 id="Nginxä¸fpm"><a href="#Nginxä¸fpm" class="headerlink" title="Nginxä¸fpm"></a>Nginxä¸fpm</h3><p>Nginxä¸ä»…ä»…æ˜¯ä¸€ä¸ªWebæœåŠ¡å™¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ProxyæœåŠ¡å™¨ï¼Œé™¤äº†è¿›è¡Œhttpè¯·æ±‚çš„ä»£ç†ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œè®¸å¤šå…¶ä»–åè®®è¯·æ±‚çš„ä»£ç†ï¼ŒåŒ…æ‹¬æœ¬æ–‡ä¸fpmç›¸å…³çš„fastcgiåè®®ã€‚  </p><blockquote><p>ä¸ºäº†èƒ½å¤Ÿä½¿ Nginx ç†è§£ fastcgi åè®®ï¼ŒNginx æä¾›äº† fastcgi æ¨¡å—æ¥å°† http è¯·æ±‚æ˜ å°„ä¸ºå¯¹åº”çš„ fastcgi è¯·æ±‚ã€‚</p></blockquote><h4 id="Nginxçš„fastcgi-æ¨¡å—"><a href="#Nginxçš„fastcgi-æ¨¡å—" class="headerlink" title="Nginxçš„fastcgi æ¨¡å—"></a>Nginxçš„fastcgi æ¨¡å—</h4><ol><li>æä¾›äº† fastcgi_param æŒ‡ä»¤æ¥ä¸»è¦å¤„ç†è¿™äº›æ˜ å°„å…³ç³»ï¼Œå…¶ä¸»è¦å®Œæˆçš„å·¥ä½œæ˜¯å°† Nginx ä¸­çš„å˜é‡ç¿»è¯‘æˆ PHP ä¸­èƒ½å¤Ÿç†è§£çš„å˜é‡ã€‚  </li><li>æä¾›äº† fastcgi_pass æŒ‡ä»¤ï¼Œè¿™ä¸ªæŒ‡ä»¤ç”¨äºæŒ‡å®š fpm è¿›ç¨‹ç›‘å¬çš„åœ°å€ï¼ŒNginx ä¼šæŠŠæ‰€æœ‰çš„ php è¯·æ±‚ç¿»è¯‘æˆ fastcgi è¯·æ±‚ä¹‹åå†å‘é€åˆ°è¿™ä¸ªåœ°å€</li></ol><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å¯ç”¨å·¥ä½œçš„Nginxé…ç½®æ–‡ä»¶ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    root         /data/code/www;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /data/code/www;</span><br><span class="line">        index  index.php index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        root            /data/code/www;</span><br><span class="line">        fastcgi_index   index.php;</span><br><span class="line">        fastcgi_pass    phpfpm_backend;</span><br><span class="line">        include         fastcgi_params;</span><br><span class="line">        fastcgi_param   SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">        #fastcgi_param  SCRIPT_NAME      $fastcgi_script_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><blockquote><p>åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œæ–°å»ºäº†è™šæ‹Ÿä¸»æœº:<br>ç›‘å¬80ç«¯å£,<br>Webæ ¹ç›®å½•ä¸ºï¼š/data/code/wwwï¼Œ<br>é€šè¿‡locationæŒ‡ä»¤ï¼Œå°†æ‰€æœ‰çš„ä»¥.phpç»“å°¾çš„æ–‡ä»¶éƒ½äº¤ç»™äº†fastcgiæ¨¡å—å»å¤„ç†ï¼Œä»è€Œå°†æ‰€æœ‰çš„phpæ±‚éƒ½äº¤ç»™äº†fpmå¤„ç†ï¼Œ<br>å®Œæˆäº†Nginxåˆ°fpmçš„é—­ç¯ã€‚</p></blockquote><p>å¸Œæœ›é€šè¿‡æœ¬æ–‡ï¼Œèƒ½å¤Ÿè®©å¤§å®¶å¯¹Nginxä¸FPMé€šä¿¡çš„æ•´ä¸ªæµç¨‹æ¯”è¾ƒæ¸…æ™°ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;em&gt;æœ¬æ–‡ä¸»è¦æ˜¯è®¨è®ºNginxä¸FPMçš„å·¥ä½œæœºåˆ¶åŠå…¶é…ç½®èƒŒåçš„åŸç†ï¼Œä»¥æ­¤æ¥çœŸæ­£ç†è§£Nginxä¸PHPçš„ååŒå·¥ä½œæœºåˆ¶ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å…ˆæ¥è°ˆè°ˆCGIã€FastCGIä¸¤ä¸ªåè®®åŠPHP-FPMã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 i
      
    
    </summary>
    
      <category term="PHP" scheme="https://zhipenwang.github.io/categories/PHP/"/>
    
    
      <category term="PHP" scheme="https://zhipenwang.github.io/tags/PHP/"/>
    
      <category term="Nginx" scheme="https://zhipenwang.github.io/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>abæµ‹è¯•</title>
    <link href="https://zhipenwang.github.io/2019/04/14/2019_04_14/"/>
    <id>https://zhipenwang.github.io/2019/04/14/2019_04_14/</id>
    <published>2019-04-13T16:00:00.000Z</published>
    <updated>2019-04-14T12:53:15.638Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹äºæœåŠ¡ç«¯å¼€å‘è€Œè¨€ï¼Œæ¥å£çš„æµ‹è¯•æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå°¤å…¶æ˜¯å¯¹äºæ¥å£çš„å‹åŠ›æµ‹è¯•ï¼Œå¯¹äºé«˜å¹¶å‘çš„æ‰¿å—èƒ½åŠ›ç­‰ã€‚<br>æ¥å£æµ‹è¯•ä¸€èˆ¬ä½¿ç”¨postmanæµ‹è¯•å³å¯ï¼Œæœ¬æ–‡æš‚ä¸è¯¦è§£ï¼Œåç»­å†æ›´æ–°è¯´æ˜å§ã€‚</p><p>ç½‘ä¼ postmanä¹Ÿå¯ä»¥è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œæœ¬äººå°±äº²è‡ªå»è¯•äº†ä¸€æŠŠï¼Œæœç„¶å‡ºäººæ„æ–™å•Šï¼Œä¸€ä¼ åã€åä¼ ç™¾ï¼Œæ ¹æœ¬å°±ä¸æ˜¯å¤§å®¶è¯´çš„é‚£æ ·å•Šã€‚</p><blockquote><p>postmanåªæ˜¯è¿›è¡Œç®€å•çš„æ¥å£æµ‹è¯•<br>postmanæœ‰ä¸ªrunnneråŠŸèƒ½ï¼Œå¯ä»¥è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œä½†æ˜¯ä¸æ”¯æŒå¹¶å‘æµ‹è¯•ï¼Œå…¶ä¸­çš„å¤šæ¬¡æµ‹è¯•éƒ½æ˜¯ä¸²è¡Œæ‰§è¡Œçš„</p></blockquote><p><em>é‚£ä¹ˆæ¥å£çš„å‹åŠ›æµ‹è¯•å‘¢ï¼Œç›®å‰è¡Œä¸šå†…æœ‰å¾ˆå¤šå·¥å…·æ”¯æŒï¼Œå¦‚Jmeterã€Loadrunnerã€abç­‰.</em><br><em>ç½‘ä¸Šè¯´äº†å¾ˆå¤šçš„æµ‹è¯•å·¥å…·ï¼Œå…¶ä¸­abå·¥å…·æ˜¯æœ€ç›´æ¥æœ€ç®€å•çš„ï¼Œæ‰€ä»¥æœ¬æ–‡é’ˆå¯¹abæµ‹è¯•å±•å¼€è®¨è®ºã€‚</em></p><h4 id="abå·¥å…·çš„ç®€å•ä»‹ç»"><a href="#abå·¥å…·çš„ç®€å•ä»‹ç»" class="headerlink" title="abå·¥å…·çš„ç®€å•ä»‹ç»"></a>abå·¥å…·çš„ç®€å•ä»‹ç»</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">abå…¨ç§°ä¸ºï¼šapache bench</span><br><span class="line">åœ¨apacheå®˜ç½‘çš„ä»‹ç»å¦‚ä¸‹ï¼š</span><br><span class="line">abæ˜¯Apacheè¶…æ–‡æœ¬ä¼ è¾“åè®®(HTTP)çš„æ€§èƒ½æµ‹è¯•å·¥å…·ã€‚å…¶è®¾è®¡æ„å›¾æ˜¯æç»˜å½“å‰æ‰€å®‰è£…çš„Apacheçš„æ‰§è¡Œæ€§èƒ½ï¼Œä¸»è¦æ˜¯æ˜¾ç¤ºä½ å®‰è£…çš„Apacheæ¯ç§’å¯ä»¥å¤„ç†å¤šå°‘ä¸ªè¯·æ±‚ã€‚</span><br></pre></td></tr></table></figure><h4 id="abå·¥å…·çš„å®‰è£…"><a href="#abå·¥å…·çš„å®‰è£…" class="headerlink" title="abå·¥å…·çš„å®‰è£…"></a>abå·¥å…·çš„å®‰è£…</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">macçš„å®‰è£…ï¼š</span><br><span class="line">macä¸‹æœ¬èº«ç³»ç»Ÿå°±è‡ªå¸¦äº†apacheï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨abå·¥å…·ï¼Œä½¿ç”¨macçš„æœ‰é’±å¤§ä½¬å¯ä»¥è·³è¿‡å®‰è£…ç›´æ¥å¾€ä¸‹çœ‹äº†ã€‚</span><br><span class="line">ubuntuç³»ç»Ÿï¼š</span><br><span class="line">ä½¿ç”¨aptå‘½ä»¤ç›´æ¥å®‰è£…å³å¯</span><br><span class="line">sudo apt install apache2-utils</span><br><span class="line">centosç³»ç»Ÿï¼š</span><br><span class="line">ä½¿ç”¨yumå‘½ä»¤ç›´æ¥å®‰è£…å³å¯</span><br><span class="line">yum -y install httpd-tools</span><br><span class="line">windowsç³»ç»Ÿï¼š</span><br><span class="line">åœ¨å®˜ç½‘ä¸‹è½½ï¼Œå‚»ç“œå¼å®‰è£…å³å¯</span><br><span class="line">https://www.apachehaus.com/cgi-bin/download.plx</span><br></pre></td></tr></table></figure><h4 id="abå·¥å…·çš„ä½¿ç”¨"><a href="#abå·¥å…·çš„ä½¿ç”¨" class="headerlink" title="abå·¥å…·çš„ä½¿ç”¨"></a>abå·¥å…·çš„ä½¿ç”¨</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab -n 100 -c 10 https://www.baidu.com</span><br></pre></td></tr></table></figure><h4 id="abå·¥å…·çš„å‚æ•°"><a href="#abå·¥å…·çš„å‚æ•°" class="headerlink" title="abå·¥å…·çš„å‚æ•°"></a>abå·¥å…·çš„å‚æ•°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ab:  httpè¯·æ±‚</span><br><span class="line">abs: httpsè¯·æ±‚</span><br><span class="line">-n:  è¯·æ±‚æ€»æ¬¡æ•°</span><br><span class="line">-c:  å¹¶å‘ç”¨æˆ·æ•°</span><br><span class="line">-T:  å†…å®¹ç±»å‹ï¼Œä¸€èˆ¬å’Œ-p -èµ·ä½¿ç”¨ï¼ˆContent-Typeï¼‰</span><br><span class="line">-p:  åŒ…å«POSTå‚æ•°çš„æ–‡ä»¶æˆ–æ•°æ®</span><br><span class="line">-C:  cookieå‚æ•°</span><br></pre></td></tr></table></figure><p>å¦‚æœè¯·æ±‚æ•°è¿‡å¤§å¤±è´¥æ˜¾ç¤ºè¿æ¥æ•°è¢«é™åˆ¶äº†ï¼Œè§£å†³<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ulimit -n 65535</span><br></pre></td></tr></table></figure></p><h4 id="abæµ‹è¯•åçš„å‚æ•°è¯´æ˜"><a href="#abæµ‹è¯•åçš„å‚æ•°è¯´æ˜" class="headerlink" title="abæµ‹è¯•åçš„å‚æ•°è¯´æ˜"></a>abæµ‹è¯•åçš„å‚æ•°è¯´æ˜</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">request pre second: ååç‡</span><br><span class="line">    è®¡ç®—å…¬å¼ï¼šæ€»è¯·æ±‚æ•°/å¤„ç†å®Œæ‰€æœ‰è¯·æ±‚èŠ±è´¹çš„æ—¶é—´</span><br><span class="line">    request pre second = complete requests / time taken for tests</span><br><span class="line"></span><br><span class="line">complete requests: æ€»è¯·æ±‚æ•°</span><br><span class="line"></span><br><span class="line">time taken for tests å¤„ç†å®Œè¯·æ±‚èŠ±è´¹çš„æ—¶é—´</span><br><span class="line"></span><br><span class="line">concurrency level: å¹¶å‘ç”¨æˆ·æ•°</span><br><span class="line">    è¦åŒºåˆ†å¹¶å‘ç”¨æˆ·æ•°ä¸å¹¶å‘è¿æ¥æ•°ï¼Œä¸€ä¸ªç”¨æˆ·å¯èƒ½å­˜åœ¨å¤šä¸ªè¿æ¥æ•°</span><br><span class="line"></span><br><span class="line">time pre request: ç”¨æˆ·å¹³å‡è¯·æ±‚ç­‰å¾…æ—¶é—´</span><br><span class="line">    è®¡ç®—å…¬å¼ï¼šå¤„ç†å®Œæ‰€æœ‰è¯·æ±‚èŠ±è´¹çš„æ—¶é—´ / ï¼ˆæ€»è¯·æ±‚æ•°/å¹¶å‘ç”¨æˆ·æ•°ï¼‰</span><br><span class="line">    time pre request = time taken for tests / (complete request / concurrency level)</span><br><span class="line"></span><br><span class="line">time pre request: across all concurrent requests æœåŠ¡å™¨å¹³å‡è¯·æ±‚ç­‰å¾…æ—¶é—´</span><br><span class="line">    è®¡ç®—å…¬å¼ï¼šå¤„ç†å®Œæ‰€æœ‰è¯·æ±‚èŠ±è´¹çš„æ—¶é—´ / æ€»è¯·æ±‚æ•°</span><br><span class="line">    time taken for tests / complete requests</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¯¹äºæœåŠ¡ç«¯å¼€å‘è€Œè¨€ï¼Œæ¥å£çš„æµ‹è¯•æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå°¤å…¶æ˜¯å¯¹äºæ¥å£çš„å‹åŠ›æµ‹è¯•ï¼Œå¯¹äºé«˜å¹¶å‘çš„æ‰¿å—èƒ½åŠ›ç­‰ã€‚&lt;br&gt;æ¥å£æµ‹è¯•ä¸€èˆ¬ä½¿ç”¨postmanæµ‹è¯•å³å¯ï¼Œæœ¬æ–‡æš‚ä¸è¯¦è§£ï¼Œåç»­å†æ›´æ–°è¯´æ˜å§ã€‚&lt;/p&gt;
&lt;p&gt;ç½‘ä¼ postmanä¹Ÿå¯ä»¥è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œæœ¬äººå°±äº²è‡ªå»è¯•äº†ä¸€æŠŠï¼Œæœç„¶å‡ºäººæ„æ–™å•Šï¼Œä¸€ä¼ åã€
      
    
    </summary>
    
      <category term="æ¥å£æµ‹è¯•" scheme="https://zhipenwang.github.io/categories/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="æµ‹è¯•" scheme="https://zhipenwang.github.io/tags/%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>hexoæ¢äº†è®¾å¤‡ä¹‹åæœ¬åœ°æ²¡é—®é¢˜ï¼Œè®¿é—®åŸŸåç©ºç™½</title>
    <link href="https://zhipenwang.github.io/2019/04/10/hexo_bug/"/>
    <id>https://zhipenwang.github.io/2019/04/10/hexo_bug/</id>
    <published>2019-04-10T05:28:01.000Z</published>
    <updated>2019-04-10T05:35:27.962Z</updated>
    
    <content type="html"><![CDATA[<ul><li>hexoä¸‰ä»¶å¥—<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>æœ¬åœ°cloneäº†ä»“åº“åï¼Œæ‰§è¡Œhexo sæœ¬åœ°æ²¡é—®é¢˜<br>é—®é¢˜ç‚¹ï¼š<br>æœ¬åœ°æ–°å†™äº†åšå®¢ï¼Œç„¶åæ‰§è¡Œhexoä¸‰ä»¶å¥—,çº¿ä¸Šæ‰“å¼€ç©ºç™½äº†<br>   è§£å†³ï¼šæœ¬åœ°é¡¹ç›®ç›®å½•ä¸‹Data/å’Œarchives/æ–‡ä»¶å†…æ¸…ç©ºï¼Œæ‰§è¡Œhexoä¸‰ä»¶å¥—<br>å¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œç»§ç»­ï¼š<br>     è§£å†³ï¼šå°†æœ¬åœ°é¡¹ç›®ç›®å½•ä¸‹çš„ .deploy_git/æ–‡ä»¶å¤¹åˆ é™¤ï¼Œé‡æ–°æ‰§è¡Œhexoä¸‰ä»¶å¥—<br>è¿™ä¸ªæ—¶å€™ä¸€èˆ¬å°±è§£å†³é—®é¢˜äº†</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;hexoä¸‰ä»¶å¥—&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span
      
    
    </summary>
    
      <category term="æ­å»ºåšå®¢" scheme="https://zhipenwang.github.io/categories/%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/"/>
    
    
      <category term="Article" scheme="https://zhipenwang.github.io/tags/Article/"/>
    
  </entry>
  
  <entry>
    <title>MYSQLä¹‹æ•°æ®è¡¨çº§è”æ“ä½œ-æ•°æ®å®Œæ•´æ€§çº¦æŸ</title>
    <link href="https://zhipenwang.github.io/2018/07/15/mysql_key/"/>
    <id>https://zhipenwang.github.io/2018/07/15/mysql_key/</id>
    <published>2018-07-15T12:21:01.000Z</published>
    <updated>2019-04-09T14:57:32.976Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å¤–é”®çº¦æŸ"><a href="#å¤–é”®çº¦æŸ" class="headerlink" title="å¤–é”®çº¦æŸ"></a>å¤–é”®çº¦æŸ</h3><blockquote><p>ç›®å‰mysqlåªæœ‰InnoDBå­˜å‚¨å¼•æ“æ”¯æŒå¤–é”®çº¦æŸ</p><ol><li>column_name å½“å‰è¡¨å¤–é”®å­—æ®µå</li><li>table_name å¤–é”®è¡¨</li><li>index_column_name å¤–é”®æ‰€åœ¨å¤–é”®è¡¨ä¸­å­—æ®µå</li><li>ON DELETE åˆ é™¤  ON UPDATE æ›´æ–°</li><li>reference_optionè¯­æ³•æ ¼å¼ä¸ºï¼šï¼ˆæ²¡è®¾ç½®æ—¶å€™ï¼Œé»˜è®¤ä¸¤ä¸ªéƒ½æŒ‡å®š RESTRICTï¼‰<br> å½“åˆ é™¤æˆ–æ›´æ–°å¤–é”®æ‰€åœ¨å¤–é”®è¡¨çš„æ•°æ®æ—¶å€™<br> RESTRICT      é™åˆ¶ç­–ç•¥ï¼Œç³»ç»Ÿä¸åˆ é™¤æˆ–æ›´æ–°å¤–é”®å½“å‰è¡¨çš„æ•°æ®<br> CASCADE          çº§è”ç­–ç•¥ï¼Œè‡ªåŠ¨åˆ é™¤æˆ–æ›´æ–°å¤–é”®å½“å‰è¡¨çš„æ•°æ®<br> SET FULL       ç½®ç©ºç­–ç•¥ï¼Œè®¾ç½®å¤–é”®å½“å‰è¡¨çš„æ•°æ®å¤–é”®åˆ—æ•°æ®ä¸ºNULLï¼Œéœ€è¦æå‰è®¾ç½®å¤–é”®åˆ—æœªè¢«é™åˆ¶ NOT NULL<br> NO ACTION       ä¸é‡‡å–å®æ–½ç­–ç•¥ï¼Œç³»ç»Ÿä¸åˆ é™¤æˆ–æ›´æ–°å¤–é”®å½“å‰è¡¨çš„æ•°æ®ï¼Œä¸ RESTRICT ä¸€è‡´</li></ol></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FOREIGN KEY ( column_name [(length)] [ASC | DESC] ) </span><br><span class="line">REFERENCES table_name(index_column_name)</span><br><span class="line">[MATCH FULL | MATCH PARTIAL | MATCH SIMPLE]</span><br><span class="line">[ON DELETE reference_option]</span><br><span class="line">[ON UPDATE reference_option]</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºè¡¨ï¼Œå…³è”å¤–é”®"><a href="#åˆ›å»ºè¡¨ï¼Œå…³è”å¤–é”®" class="headerlink" title="åˆ›å»ºè¡¨ï¼Œå…³è”å¤–é”®"></a>åˆ›å»ºè¡¨ï¼Œå…³è”å¤–é”®</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»º ç­çº§è¡¨</span><br><span class="line">create table if not exists class(</span><br><span class="line">id int(11) not null auto_increment,</span><br><span class="line">name varchar(30) not null,</span><br><span class="line">primary key (id)</span><br><span class="line">) ENGINE=InnoDB default charset=utf8;</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºå­¦ç”Ÿè¡¨ï¼Œå¤–é”® ç­çº§id class_idï¼Œçº§è”åˆ é™¤åŠæ›´æ–°</span><br><span class="line">create table if not exists student(</span><br><span class="line">id int(11) not null auto_increment,</span><br><span class="line">name varchar(30) not null,</span><br><span class="line">class_id int(11) not null,</span><br><span class="line">primary key(id),</span><br><span class="line">index(class_id),</span><br><span class="line">foreign key (class_id) references class(id) on delete cascade on update cascade</span><br><span class="line">) ENGINE=InnoDB default charset=utf8;</span><br></pre></td></tr></table></figure><h4 id="æ’å…¥æ•°æ®æ“ä½œ"><a href="#æ’å…¥æ•°æ®æ“ä½œ" class="headerlink" title="æ’å…¥æ•°æ®æ“ä½œ"></a>æ’å…¥æ•°æ®æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//æ’å…¥æ•°æ®</span><br><span class="line">insert into class(name) values(&apos;one&apos;), (&apos;two&apos;), (&apos;three&apos;);</span><br><span class="line">// ç”Ÿæˆ id 1,2,3</span><br><span class="line"></span><br><span class="line">insert into student(class_id,name) values(1, &apos;lili&apos;);</span><br><span class="line">insert into student(class_id,name) values(2, &apos;lili&apos;);</span><br><span class="line">insert into student(class_id,name) values(2, &apos;lili&apos;);</span><br><span class="line">insert into student(class_id,name) values(3, &apos;lili&apos;);</span><br><span class="line"></span><br><span class="line">// æ’å…¥å¤±è´¥ï¼Œå› ä¸ºç­çº§è¡¨ä¸­æ²¡æœ‰id =10çš„æ•°æ®</span><br><span class="line">insert into student(class_id,name) values(10, &apos;lili&apos;);</span><br></pre></td></tr></table></figure><h4 id="æ›´æ–°æ•°æ®æ“ä½œ"><a href="#æ›´æ–°æ•°æ®æ“ä½œ" class="headerlink" title="æ›´æ–°æ•°æ®æ“ä½œ"></a>æ›´æ–°æ•°æ®æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//æ›´æ–°æ•°æ®</span><br><span class="line">update class set id=5 where id=2;</span><br><span class="line">//æ­¤æ—¶ å­¦ç”Ÿè¡¨ä¸­ sid=2çš„æ•°æ®åŒæ­¥æ›´æ–°ä¸ºäº†5</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤æ•°æ®æ“ä½œ"><a href="#åˆ é™¤æ•°æ®æ“ä½œ" class="headerlink" title="åˆ é™¤æ•°æ®æ“ä½œ"></a>åˆ é™¤æ•°æ®æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//åˆ é™¤æ•°æ®</span><br><span class="line">delete from class where id=1;</span><br><span class="line">//æ­¤æ—¶ å­¦ç”Ÿè¡¨ä¸­ sid=1çš„æ•°æ®åŒæ­¥åˆ é™¤äº†</span><br></pre></td></tr></table></figure><h3 id="ä¸»é”®"><a href="#ä¸»é”®" class="headerlink" title="ä¸»é”®"></a>ä¸»é”®</h3><blockquote><p>ä¸€ä¸ªè¡¨ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªä¸»é”®</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// å•å­—æ®µä¸»é”®</span><br><span class="line">create table if not exists table_test(</span><br><span class="line">id int(11) not null auto_increment primary key,</span><br><span class="line">name varchar(30) not null</span><br><span class="line">) engine=InnoDB default charset=utf8;</span><br><span class="line"></span><br><span class="line">// å¤åˆå­—æ®µä¸»é”®</span><br><span class="line">create table if not exists table_test(</span><br><span class="line">id int(11) not null auto_increment,</span><br><span class="line">name varchar(30) not null,</span><br><span class="line">primary key(id, name)</span><br><span class="line">) engine=InnoDB default charset=utf8;</span><br></pre></td></tr></table></figure><h3 id="å€™é€‰é”®"><a href="#å€™é€‰é”®" class="headerlink" title="å€™é€‰é”®"></a>å€™é€‰é”®</h3><blockquote><p>ä¸€ä¸ªè¡¨ä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªå€™é€‰é”®<br>UNIQUE æ¥è¡¨ç¤º</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists table_test(</span><br><span class="line">id int(11) not null auto_increment UNIQUE,</span><br><span class="line">name varchar(30) not null UNIQUE,</span><br><span class="line">) engine=InnoDB default charset=utf8;</span><br></pre></td></tr></table></figure><h3 id="å­—æ®µæ¡ä»¶çº¦æŸ"><a href="#å­—æ®µæ¡ä»¶çº¦æŸ" class="headerlink" title="å­—æ®µæ¡ä»¶çº¦æŸ"></a>å­—æ®µæ¡ä»¶çº¦æŸ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// null</span><br><span class="line">id int(11) not null,</span><br><span class="line">sid int(11) null</span><br><span class="line"></span><br><span class="line">// checkå¯¹åˆ—çº¦æŸ</span><br><span class="line">age int(2) not null check(age&gt;6 and age&lt;18)</span><br><span class="line"></span><br><span class="line">// checkå¯¹è¡¨çº¦æŸ</span><br><span class="line">primary key(id),</span><br><span class="line">check(class_id in (select id from tb_class))</span><br></pre></td></tr></table></figure><h3 id="å®Œæ•´æ€§çº¦æŸ"><a href="#å®Œæ•´æ€§çº¦æŸ" class="headerlink" title="å®Œæ•´æ€§çº¦æŸ"></a>å®Œæ•´æ€§çº¦æŸ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»ºè¡¨çš„æ—¶å€™ä½¿ç”¨</span><br><span class="line">constraint &lt;symbol&gt;</span><br><span class="line">[primary ... | foreign ... | check ...]</span><br><span class="line"></span><br><span class="line">// æ›´æ–°è¡¨çš„å®Œæ•´æ€§çº¦æŸ</span><br><span class="line">alter table table_name add constraint primary</span><br><span class="line">primary key(id)</span><br><span class="line"></span><br><span class="line">// åˆ é™¤è¡¨çš„å®Œæ•´æ€§çº¦æŸ</span><br><span class="line">alter table table_name drop [foreign key|index] &lt;symbol&gt; [primary key]</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å¤–é”®çº¦æŸ&quot;&gt;&lt;a href=&quot;#å¤–é”®çº¦æŸ&quot; class=&quot;headerlink&quot; title=&quot;å¤–é”®çº¦æŸ&quot;&gt;&lt;/a&gt;å¤–é”®çº¦æŸ&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;ç›®å‰mysqlåªæœ‰InnoDBå­˜å‚¨å¼•æ“æ”¯æŒå¤–é”®çº¦æŸ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;column_nam
      
    
    </summary>
    
      <category term="MySQL" scheme="https://zhipenwang.github.io/categories/MySQL/"/>
    
    
      <category term="æ•°æ®åº“" scheme="https://zhipenwang.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>MYSQLä¹‹ç´¢å¼•</title>
    <link href="https://zhipenwang.github.io/2018/07/15/mysql_index/"/>
    <id>https://zhipenwang.github.io/2018/07/15/mysql_index/</id>
    <published>2018-07-15T11:21:01.000Z</published>
    <updated>2019-04-09T14:57:32.975Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ç´¢å¼•çš„ä¸¤ç§å­˜å‚¨ç±»å‹ï¼šBæ ‘(BTree)ç´¢å¼•ã€å“ˆå¸Œ(Hash)ç´¢å¼•<br>BTreeä¸ºç³»ç»Ÿé»˜è®¤ç´¢å¼•</p></blockquote><h3 id="åˆ›å»ºè¡¨æ—¶å»ºç«‹ç´¢å¼•"><a href="#åˆ›å»ºè¡¨æ—¶å»ºç«‹ç´¢å¼•" class="headerlink" title="åˆ›å»ºè¡¨æ—¶å»ºç«‹ç´¢å¼•"></a>åˆ›å»ºè¡¨æ—¶å»ºç«‹ç´¢å¼•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table (</span><br><span class="line">å±æ€§å é•¿åº¦ æ˜¯å¦ä¸ºç©º,</span><br><span class="line">[UNIQUE | FULLTEXT | SPATIAL ]  INDEX|KEY [åˆ«å]( å±æ€§å1 [(é•¿åº¦)] [ASC | DESC])</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="å·²å»ºç«‹çš„è¡¨ä¸­åˆ›å»ºç´¢å¼•"><a href="#å·²å»ºç«‹çš„è¡¨ä¸­åˆ›å»ºç´¢å¼•" class="headerlink" title="å·²å»ºç«‹çš„è¡¨ä¸­åˆ›å»ºç´¢å¼•"></a>å·²å»ºç«‹çš„è¡¨ä¸­åˆ›å»ºç´¢å¼•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create [UNIQUE | FULLTEXT | SPATIAL ]  INDEX [åˆ«å] on table_name( å±æ€§å1 [(é•¿åº¦)] [ASC | DESC])</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹è¡¨ç»“æ„æ·»åŠ ç´¢å¼•"><a href="#ä¿®æ”¹è¡¨ç»“æ„æ·»åŠ ç´¢å¼•" class="headerlink" title="ä¿®æ”¹è¡¨ç»“æ„æ·»åŠ ç´¢å¼•"></a>ä¿®æ”¹è¡¨ç»“æ„æ·»åŠ ç´¢å¼•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table table_name add [UNIQUE | FULLTEXT | SPATIAL ]  INDEX [åˆ«å] on table_name( å±æ€§å1 [(é•¿åº¦)] [ASC | DESC])</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤ç´¢å¼•"><a href="#åˆ é™¤ç´¢å¼•" class="headerlink" title="åˆ é™¤ç´¢å¼•"></a>åˆ é™¤ç´¢å¼•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop INDEX å±æ€§å on table_name</span><br></pre></td></tr></table></figure><blockquote><ol><li>[]æ˜¯å¯é€‰é¡¹  </li><li>[UNIQUE | FULLTEXT | SPATIAL ] å¯é€‰é¡¹ï¼Œåˆ†åˆ«ä»£è¡¨å”¯ä¸€æ€§ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ã€ç©ºé—´ç´¢å¼•</li><li>INDEXå’ŒKEYå‚æ•°å…¶ä¸­ä¸€ä¸ªå³å¯ï¼Œç”¨äºæŒ‡å®šå­—æ®µç´¢å¼•</li><li>åˆ«åä¸ºå¯é€‰é¡¹ï¼Œåˆ›å»ºçš„ç´¢å¼•å–æ–°åç§°<br> åˆ«åçš„å‚æ•°å¦‚ä¸‹ï¼š<br> å±æ€§å1 å¿…é€‰é¡¹ï¼ŒæŒ‡ç´¢å¼•å¯¹åº”çš„å­—æ®µåç§°ï¼Œè¯¥å­—æ®µå¿…é¡»é¢„é€‰è¢«å®šä¹‰åˆ°è¡¨ä¸­<br> é•¿åº¦    å¯é€‰é¡¹ï¼Œç´¢å¼•çš„é•¿åº¦ï¼Œå¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹æ‰å¯ä»¥ä½¿ç”¨<br> ASC/DESCå¯é€‰é¡¹ï¼ŒASCè¡¨ç¤ºå‡åºæ’åˆ—ï¼ŒDESCè¡¨ç¤ºé™åºæ’åˆ—  </li><li>table_name è¡¨åç§°</li></ol></blockquote><h3 id="æ™®é€šç´¢å¼•"><a href="#æ™®é€šç´¢å¼•" class="headerlink" title="æ™®é€šç´¢å¼•"></a>æ™®é€šç´¢å¼•</h3><blockquote><p>åœ¨ä»»ä½•æ•°æ®ç±»å‹çš„å­—æ®µä¸­åˆ›å»ºç´¢å¼•</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•</span><br><span class="line">// åˆ›å»ºäº†ç´¢å¼•åˆ— id</span><br><span class="line">create table if not exists table_test(</span><br><span class="line">id int(11) not null auto_increment primary key,</span><br><span class="line">name varchar(30) not null,</span><br><span class="line">index(id)</span><br><span class="line">);</span><br><span class="line">// å·²å­˜åœ¨è¡¨ä¸­åˆ›å»ºç´¢å¼•</span><br><span class="line">create index info on table_test (id)</span><br><span class="line">// ä¿®æ”¹è¡¨ç»“æ„æ·»åŠ ç´¢å¼•</span><br><span class="line">alter table table_test add index info (id)</span><br><span class="line">// æŸ¥çœ‹è¡¨ç»“æ„</span><br><span class="line">show create table table_test;</span><br></pre></td></tr></table></figure><h3 id="å”¯ä¸€æ€§ç´¢å¼•"><a href="#å”¯ä¸€æ€§ç´¢å¼•" class="headerlink" title="å”¯ä¸€æ€§ç´¢å¼•"></a>å”¯ä¸€æ€§ç´¢å¼•</h3><blockquote><p>ä½¿ç”¨UNIQUEå‚æ•°è®¾ç½®å”¯ä¸€ç´¢å¼•ï¼Œè¯¥ç´¢å¼•çš„å€¼å¿…é¡»å”¯ä¸€<br>ä¸»é”®æ˜¯ä¸€ç§ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•</span><br><span class="line">// åˆ›å»ºå”¯ä¸€ç´¢å¼• åˆ«åä¸º name ç´¢å¼•å­—æ®µä¸º idï¼Œç´¢å¼•å­˜å‚¨æ’åºä¸º asc</span><br><span class="line">create table if not exists table_test(</span><br><span class="line">id int(11) not null auto_increment primary key,</span><br><span class="line">name varchar(30) not null,</span><br><span class="line">UNIQUE INDEX name (id asc)</span><br><span class="line">);</span><br><span class="line">// å·²å­˜åœ¨è¡¨ä¸­åˆ›å»ºç´¢å¼•</span><br><span class="line">create UNIQUE INDEX name on table_test (id asc)</span><br><span class="line">// ä¿®æ”¹è¡¨ç»“æ„æ·»åŠ ç´¢å¼•</span><br><span class="line">alter table table_test add UNIQUE INDEX name (id asc)</span><br><span class="line">// æŸ¥çœ‹è¡¨ç»“æ„</span><br><span class="line">show create table table_test;</span><br></pre></td></tr></table></figure><h3 id="å…¨æ–‡ç´¢å¼•"><a href="#å…¨æ–‡ç´¢å¼•" class="headerlink" title="å…¨æ–‡ç´¢å¼•"></a>å…¨æ–‡ç´¢å¼•</h3><blockquote><p>ä½¿ç”¨FULLTEXTå‚æ•°è®¾ç½®å…¨æ–‡ç´¢å¼•<br>åªæœ‰myisamå­˜å‚¨å¼•æ“çš„æ•°æ®è¡¨æ”¯æŒfulltextå…¨æ–‡ç´¢å¼•<br>åªèƒ½åˆ›å»ºåœ¨æ•°æ®ç±»å‹ä¸º charã€varcharã€textçš„å­—æ®µä¸Š<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œåº”ç”¨å…¨æ–‡ç´¢å¼•å¤§å°å†™ä¸æ•æ„Ÿï¼Œç´¢å¼•çš„åˆ—ä½¿ç”¨äºŒè¿›åˆ¶æ’åºåï¼Œå¯ä»¥æ‰§è¡Œå¤§å°å†™æ•æ„Ÿçš„å…¨æ–‡ç´¢å¼•</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•</span><br><span class="line">// åˆ›å»ºå…¨æ–‡ç´¢å¼• åˆ«åä¸º name_info ç´¢å¼•å­—æ®µä¸º name</span><br><span class="line">create table if not exists table_test(</span><br><span class="line">id int(11) not null auto_increment primary key,</span><br><span class="line">name varchar(30) not null,</span><br><span class="line">FULLTEXT KEY name_info (name)</span><br><span class="line">) engine=MyISAM;</span><br><span class="line">// å·²å­˜åœ¨è¡¨ä¸­åˆ›å»ºç´¢å¼•</span><br><span class="line">create FULLTEXT INDEX name_info on table_test (name)</span><br><span class="line">// ä¿®æ”¹è¡¨ç»“æ„æ·»åŠ ç´¢å¼•</span><br><span class="line">alter table table_test add FULLTEXT INDEX name_info (name)</span><br><span class="line">// æŸ¥çœ‹è¡¨ç»“æ„</span><br><span class="line">show create table table_test;</span><br></pre></td></tr></table></figure><h3 id="å•åˆ—ç´¢å¼•"><a href="#å•åˆ—ç´¢å¼•" class="headerlink" title="å•åˆ—ç´¢å¼•"></a>å•åˆ—ç´¢å¼•</h3><blockquote><p>åªå¯¹åº”ä¸€ä¸ªå­—æ®µçš„ç´¢å¼•</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•</span><br><span class="line">// åˆ›å»ºå•åˆ—ç´¢å¼• åˆ«åä¸º name_info ç´¢å¼•å­—æ®µä¸º nameï¼Œç´¢å¼•å­—æ®µé•¿åº¦ä¸º20</span><br><span class="line">// æ•°æ®è¡¨ä¸­çš„å­—æ®µé•¿åº¦ä¸º30ï¼Œè€Œåˆ›å»ºçš„ç´¢å¼•çš„å­—æ®µé•¿åº¦ä¸º20ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œä¼˜åŒ–æŸ¥è¯¢é€Ÿåº¦</span><br><span class="line">create table if not exists table_test(</span><br><span class="line">id int(11) not null auto_increment primary key,</span><br><span class="line">name varchar(30) not null,</span><br><span class="line">INDEX name_info (name(20))</span><br><span class="line">);</span><br><span class="line">// å·²å­˜åœ¨è¡¨ä¸­åˆ›å»ºç´¢å¼•</span><br><span class="line">create INDEX name_info on table_test (name(20))</span><br><span class="line">// ä¿®æ”¹è¡¨ç»“æ„æ·»åŠ ç´¢å¼•</span><br><span class="line">alter table table_test add INDEX name_info (name(20))</span><br><span class="line">// æŸ¥çœ‹è¡¨ç»“æ„</span><br><span class="line">show create table table_test;</span><br></pre></td></tr></table></figure><h3 id="å¤šåˆ—ç´¢å¼•"><a href="#å¤šåˆ—ç´¢å¼•" class="headerlink" title="å¤šåˆ—ç´¢å¼•"></a>å¤šåˆ—ç´¢å¼•</h3><blockquote><p>è¡¨çš„å¤šä¸ªå­—æ®µä¸Šåˆ›å»ºç´¢å¼•<br>åº”ç”¨æ­¤ç´¢å¼•ï¼Œå¿…é¡»ä½¿ç”¨è¿™äº›å­—æ®µçš„ç¬¬ä¸€ä¸ªå­—æ®µ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•</span><br><span class="line">// åˆ›å»ºå¤šåˆ—ç´¢å¼• åˆ«åä¸º info ç´¢å¼•å­—æ®µä¸º nameã€sex</span><br><span class="line">create table if not exists table_test(</span><br><span class="line">id int(11) not null auto_increment primary key,</span><br><span class="line">name varchar(30) not null,</span><br><span class="line">sex bit(1) not null,</span><br><span class="line">INDEX info (name,sex)</span><br><span class="line">);</span><br><span class="line">// å·²å­˜åœ¨è¡¨ä¸­åˆ›å»ºç´¢å¼•</span><br><span class="line">create INDEX info on table_test (name,sex)</span><br><span class="line">// ä¿®æ”¹è¡¨ç»“æ„æ·»åŠ ç´¢å¼•</span><br><span class="line">alter table table_test add INDEX info (name,sex)</span><br><span class="line">// æŸ¥çœ‹è¡¨ç»“æ„</span><br><span class="line">show create table table_test;</span><br></pre></td></tr></table></figure><h3 id="ç©ºé—´ç´¢å¼•"><a href="#ç©ºé—´ç´¢å¼•" class="headerlink" title="ç©ºé—´ç´¢å¼•"></a>ç©ºé—´ç´¢å¼•</h3><blockquote><p>ä½¿ç”¨SPATIALå‚æ•°å¯ä»¥è®¾ç½®ç©ºé—´ç´¢å¼•<br>åªèƒ½å»ºç«‹åœ¨æ•°æ®ç±»å‹ä¸ºç©ºé—´ç±»å‹çš„å­—æ®µä¸Š<br>mysqlåªæœ‰MyISAMå­˜å‚¨å¼•æ“æ”¯æŒç©ºé—´æ£€ç´¢ï¼Œä¸”ç´¢å¼•çš„å­—æ®µä¸èƒ½ä¸ºç©ºå€¼<br>ç©ºé—´ç±»å‹ï¼šgeometryã€pointã€linestringã€polygon</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•</span><br><span class="line">// åˆ›å»ºç©ºé—´ç´¢å¼• åˆ«åä¸º good_info ç´¢å¼•å­—æ®µä¸º good</span><br><span class="line">create table if not exists table_test(</span><br><span class="line">id int(11) not null auto_increment primary key,</span><br><span class="line">good geometry not null,</span><br><span class="line">SPATIAL INDEX good_info (good)</span><br><span class="line">);</span><br><span class="line">// å·²å­˜åœ¨è¡¨ä¸­åˆ›å»ºç´¢å¼•</span><br><span class="line">create SPATIAL INDEX good_info on table_test (good)</span><br><span class="line">// ä¿®æ”¹è¡¨ç»“æ„æ·»åŠ ç´¢å¼•</span><br><span class="line">alter table table_test add SPATIAL INDEX good_info (good)</span><br><span class="line">// æŸ¥çœ‹è¡¨ç»“æ„</span><br><span class="line">show create table table_test;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;ç´¢å¼•çš„ä¸¤ç§å­˜å‚¨ç±»å‹ï¼šBæ ‘(BTree)ç´¢å¼•ã€å“ˆå¸Œ(Hash)ç´¢å¼•&lt;br&gt;BTreeä¸ºç³»ç»Ÿé»˜è®¤ç´¢å¼•&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;åˆ›å»ºè¡¨æ—¶å»ºç«‹ç´¢å¼•&quot;&gt;&lt;a href=&quot;#åˆ›å»ºè¡¨æ—¶å»ºç«‹ç´¢å¼•&quot; class=&quot;headerlink&quot; 
      
    
    </summary>
    
      <category term="MySQL" scheme="https://zhipenwang.github.io/categories/MySQL/"/>
    
    
      <category term="æ•°æ®åº“" scheme="https://zhipenwang.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>MYSQLä¹‹æµç¨‹æ§åˆ¶è¯­å¥</title>
    <link href="https://zhipenwang.github.io/2018/07/07/mysql_condition/"/>
    <id>https://zhipenwang.github.io/2018/07/07/mysql_condition/</id>
    <published>2018-07-07T12:21:01.000Z</published>
    <updated>2019-04-09T14:57:32.974Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ifã€caseã€loopã€whileã€iterateã€leave</p></blockquote><h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><blockquote><p>æ³¨æ„ åˆ†å·ä¸èƒ½çœç•¥</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">IF CONDITION THEN</span><br><span class="line">...;</span><br><span class="line">ELSEIF CONDITION THEN</span><br><span class="line">...;</span><br><span class="line">ELSE</span><br><span class="line">...;</span><br><span class="line">END IF;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">è°ƒç”¨ï¼šcall do_if(10)</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE do_if(in x int)</span><br><span class="line">BEGIN</span><br><span class="line">IF x IS NULL THEN</span><br><span class="line">select 100;</span><br><span class="line">ELSEIF x=0 THEN</span><br><span class="line">select 101;</span><br><span class="line">ELSE</span><br><span class="line">select 102;</span><br><span class="line">END IF;</span><br><span class="line">END</span><br></pre></td></tr></table></figure><h3 id="case"><a href="#case" class="headerlink" title="case"></a>case</h3><blockquote><p>æ³¨æ„ åˆ†å·ä¸èƒ½çœç•¥</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CASE value</span><br><span class="line">WHEN value THEN ...;</span><br><span class="line">WHEN value THEN ...;</span><br><span class="line">ELSE ...;</span><br><span class="line">END CASE;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">è°ƒç”¨ï¼šcall do_case(10)</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE do_case(in x int)</span><br><span class="line">BEGIN</span><br><span class="line">CASE x</span><br><span class="line">WHEN x IS NULL THEN SELECT 100;</span><br><span class="line">WHEN x = 0 THEN SELECT 101;</span><br><span class="line">ELSE SELECT 102;</span><br><span class="line">END CASE;</span><br><span class="line">END</span><br></pre></td></tr></table></figure><h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><blockquote><p>æ³¨æ„ åˆ†å·ä¸èƒ½çœç•¥</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WHILE CONDITION DO</span><br><span class="line">...;</span><br><span class="line">END WHILE;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">è°ƒç”¨ï¼š</span><br><span class="line">call do_while(@sum)</span><br><span class="line">select @sum</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE do_while(out x int)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE i int DEFAULT 1;</span><br><span class="line">DECLARE j int DEFAULT 0;</span><br><span class="line">WHILE i&lt;100 DO</span><br><span class="line">set j=j+i;</span><br><span class="line">set i=i+1;</span><br><span class="line">END WHILE;</span><br><span class="line">SET x=j;</span><br><span class="line">END</span><br></pre></td></tr></table></figure><h3 id="loop"><a href="#loop" class="headerlink" title="loop"></a>loop</h3><blockquote><p>æ³¨æ„ åˆ†å·ä¸èƒ½çœç•¥<br>LEAVE loop_label é€€å‡º å®šä¹‰åç§°ä¸ºloop_labelçš„loopé€€å‡ºå¾ªç¯</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LOOP</span><br><span class="line">...</span><br><span class="line">END LOOP;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">è°ƒç”¨ï¼š</span><br><span class="line">call do_loop(@sum)</span><br><span class="line">select @sum</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE do_loop(out x int)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE i int DEFAULT 1;</span><br><span class="line">DECLARE j int DEFAULT 0;</span><br><span class="line">loop_label:LOOP</span><br><span class="line">set j=j+i;</span><br><span class="line">set i=i+1;</span><br><span class="line">IF i&gt;10 THEN</span><br><span class="line">LEAVE loop_label;</span><br><span class="line">END IF;</span><br><span class="line">END LOOP;</span><br><span class="line">set x=j;</span><br><span class="line">END</span><br></pre></td></tr></table></figure><h3 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h3><blockquote><p>æ³¨æ„ åˆ†å·ä¸èƒ½çœç•¥  </p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REPEAT</span><br><span class="line">...</span><br><span class="line">UNTIL CONDITION</span><br><span class="line">END REPEAT;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">è°ƒç”¨ï¼š</span><br><span class="line">call do_repeat(@sum)</span><br><span class="line">select @sum</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE do_repeat(out x int)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE i int DEFAULT 1;</span><br><span class="line">DECLARE j int DEFAULT 0;</span><br><span class="line">REPEAT</span><br><span class="line">set j=j+i;</span><br><span class="line">set i=i+1;</span><br><span class="line">UNTIL i&gt;10</span><br><span class="line">END REPEAT;</span><br><span class="line">set x=j;</span><br><span class="line">END</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;ifã€caseã€loopã€whileã€iterateã€leave&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;if&quot;&gt;&lt;a href=&quot;#if&quot; class=&quot;headerlink&quot; title=&quot;if&quot;&gt;&lt;/a&gt;if&lt;/h3&gt;&lt;block
      
    
    </summary>
    
      <category term="MySQL" scheme="https://zhipenwang.github.io/categories/MySQL/"/>
    
    
      <category term="æ•°æ®åº“" scheme="https://zhipenwang.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>MYSQLä¹‹è¿ç®—ç¬¦æ“ä½œ</title>
    <link href="https://zhipenwang.github.io/2018/07/07/mysql_calculate/"/>
    <id>https://zhipenwang.github.io/2018/07/07/mysql_calculate/</id>
    <published>2018-07-07T11:21:01.000Z</published>
    <updated>2019-04-09T14:57:32.973Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists test(</span><br><span class="line">id int(11) not null auto_increment primary key,</span><br><span class="line">num int(11) null</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="ç®—æœ¯è¿ç®—ç¬¦"><a href="#ç®—æœ¯è¿ç®—ç¬¦" class="headerlink" title="ç®—æœ¯è¿ç®—ç¬¦"></a>ç®—æœ¯è¿ç®—ç¬¦</h3><blockquote><p>åŠ (+)ã€å‡(-)ã€ä¹˜(*)ã€é™¤(/)ã€ä½™(%)ã€é™¤(div)ã€ä½™(mod)</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select id, num, id+num, id-num, id*num, id/num, id%num, id div num, id mod num from test;</span><br><span class="line">ç»“æœï¼š</span><br><span class="line">id num id+num id-num id*num id/num id%num id div num id mod num</span><br><span class="line">5  2   8  3      10     2.5    1      21</span><br><span class="line">6   nullnullnullnullnullnullnullnull</span><br><span class="line">null 5nullnullnullnullnullnullnull</span><br></pre></td></tr></table></figure><h3 id="æ¯”è¾ƒè¿ç®—ç¬¦"><a href="#æ¯”è¾ƒè¿ç®—ç¬¦" class="headerlink" title="æ¯”è¾ƒè¿ç®—ç¬¦"></a>æ¯”è¾ƒè¿ç®—ç¬¦</h3><blockquote><p>å¤§äº(&gt;)ã€å°äº(&lt;)ã€ç­‰äº(=)ã€ä¸ç­‰äº(!=æˆ–&lt;&gt;)ã€å¤§äºç­‰äº(&gt;=)ã€å°äºç­‰äº(&lt;=)</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. ç¬¦åˆæ¡ä»¶çš„ç»“æœä¸º1</span><br><span class="line">2. ä¸ç¬¦åˆæ¡ä»¶çš„ç»“æœä¸º0</span><br><span class="line">3. å€¼ä¸ºNULLçš„ç»“æœä¸ºnull</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">&gt;æ˜¯null(IS NULL)ã€ä¸æ˜¯null(IS NOT NULL)</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­æ˜¯å¦ä¸ºç©ºå€¼å¯ä»¥é‡‡ç”¨ &lt;=&gt; è¿›è¡Œåˆ¤æ–­ï¼Œa&lt;=&gt;0ï¼Œå€¼ä¸º0çš„ç»“æœä¸º1ï¼Œå…¶ä»–éƒ½ä¸º0ï¼›a&lt;=&gt;nullï¼Œå€¼ä¸ºnullçš„ç»“æœä¸º1ï¼Œå…¶ä»–éƒ½ä¸º0<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;åŒ…å«(between a and b)  </span><br><span class="line">&gt;åŒ…å«(id IN (1,2,3))ã€ä¸åŒ…å«(id not in(1,2,3))  </span><br><span class="line">&gt;æ¨¡å¼åŒ¹é…(name like &apos;%keyword%&apos;)ã€æ¨¡å¼ä¸åŒ¹é…(name not like &apos;%keyword%&apos;)</span><br></pre></td></tr></table></figure></p><ol><li>like â€˜abcâ€™  è¡¨ç¤ºå­—ç¬¦ä¸²=abcçš„åŒ¹é…</li><li>like â€˜%abcâ€™ è¡¨ç¤ºä»¥abcç»“å°¾çš„å­—ç¬¦ä¸²åŒ¹é…</li><li>like â€˜abc%â€™ è¡¨ç¤ºä»¥abcå¼€å¤´çš„å­—ç¬¦ä¸²åŒ¹é…</li><li>like â€˜%abc%â€™è¡¨ç¤ºåŒ…å«abcçš„å­—ç¬¦ä¸²åŒ¹é…</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;æ­£åˆ™åŒ¹é…(a regexp &apos;^a&apos;)</span><br></pre></td></tr></table></figure><ol><li>a regexp â€˜^abcâ€™ è¡¨ç¤ºä»¥abcå¼€å¤´çš„å­—ç¬¦ä¸²åŒ¹é…</li><li>a regexp â€˜abcâ€™  è¡¨ç¤ºåŒ…å«abcçš„å­—ç¬¦ä¸²åŒ¹é…</li><li><p>a regexp â€˜abc$â€™ è¡¨ç¤ºä»¥abcç»“å°¾çš„å­—ç¬¦ä¸²åŒ¹é…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### é€»è¾‘è¿ç®—ç¬¦</span><br><span class="line">&gt;ä¸(&amp;&amp;æˆ–AND)ã€æˆ–(||æˆ–OR)ã€é(!æˆ–NOT)ã€å¼‚æˆ–(XOR)</span><br></pre></td></tr></table></figure></li><li><p>&amp;&amp;  åªè¦æœ‰ä¸€ä¸ªå€¼ä¸º0ï¼Œç»“æœä¸º0ï¼›æœ‰å€¼ä¸ºnullï¼Œå…¶ä»–éƒ½ä¸ä¸º0ï¼Œç»“æœä¸ºnullï¼›å€¼éƒ½ä¸ä¸ºnullä¸0çš„ç»“æœä¸º1ï¼›</p></li><li>||  å€¼éƒ½ä¸º0ç»“æœä¸º0ï¼›å€¼ä¸º0æˆ–è€…nullç»“æœä¸ºnullï¼›å€¼å­˜åœ¨ä¸ä¸º0æˆ–è€…nullçš„ç»“æœä¸º1ï¼›</li><li>!   å€¼ä¸ºnullç»“æœä¸ºnullï¼›å€¼ä¸º0çš„ç»“æœä¸º1ï¼›å€¼ä¸ºé0æˆ–nullçš„ç»“æœä¸º1ï¼›</li><li><p>XOR å€¼å­˜åœ¨nullçš„ç»“æœä¸ºnullï¼›å€¼éƒ½æ˜¯é0æˆ–è€…éƒ½æ˜¯0çš„ç»“æœä¸º0ï¼›å€¼å­˜åœ¨0è·Ÿé0çš„ç»“æœä¸º1ï¼›</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### ä½è¿ç®—ç¬¦</span><br><span class="line">&gt;æŒ‰ä½ä¸(&amp;)ã€æŒ‰ä½æˆ–(|)ã€æŒ‰ä½å–å(~)ã€æŒ‰ä½å¼‚æˆ–(^)ã€æŒ‰ä½å·¦ç§»(&lt;&lt;)ã€æŒ‰ä½å³ç§»(&gt;&gt;)</span><br></pre></td></tr></table></figure></li><li><p>&amp;    å°†åè¿›åˆ¶æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°ï¼Œæ¯ä¸ªäºŒè¿›åˆ¶æ•°å¯¹åº”çš„ä½ä¸Šè¿›è¡Œä¸è¿ç®—ï¼Œæœ€åè½¬æ¢ä¸ºåè¿›åˆ¶æ•°<br> ä¾‹ï¼š10&amp;5 =&gt; 1010&amp;0101 =&gt; 0000 =&gt; 0<br> ä¾‹ï¼š10&amp;6 =&gt; 1010&amp;0110 =&gt; 0010 =&gt; 2</p></li><li>|    å°†åè¿›åˆ¶æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°ï¼Œæ¯ä¸ªäºŒè¿›åˆ¶æ•°å¯¹åº”çš„ä½ä¸Šè¿›è¡Œæˆ–è¿ç®—ï¼Œæœ€åè½¬æ¢ä¸ºåè¿›åˆ¶æ•°<br> ä¾‹ï¼š10&amp;5 =&gt; 1010|0101 =&gt; 1111 =&gt; 15<br> ä¾‹ï¼š10&amp;6 =&gt; 1010|0110 =&gt; 1110 =&gt; 14</li><li>~    å°†åè¿›åˆ¶æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°ï¼Œæ¯ä½éƒ½è¿›è¡Œå–åè¿ç®—<br> ä¾‹ï¼š10 =&gt; 1010 =&gt; 0101 =&gt; 18446744073709551605(å­—èŠ‚è®¡ç®—ç»“æœ)</li><li>^    å°†åè¿›åˆ¶æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°ï¼Œæ¯ä¸ªäºŒè¿›åˆ¶æ•°å¯¹åº”çš„ä½ä¸Šè¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œæœ€åè½¬æ¢ä¸ºåè¿›åˆ¶æ•°<br> ä¾‹ï¼š10&amp;5 =&gt; 1010^0101 =&gt; 1111 =&gt; 15<br> ä¾‹ï¼š10&amp;6 =&gt; 1010^0110 =&gt; 1100 =&gt; 12</li><li>&lt;&lt;    m &lt;&lt; n å°†åè¿›åˆ¶æ•°mè½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°ï¼ŒæŒ‰ä½å·¦ç§»nä½ï¼Œå³è¾¹è¡¥ä¸Šnä¸ª0ï¼Œæœ€åè½¬æ¢ä¸ºåè¿›åˆ¶æ•°<br> ä¾‹ï¼š10 &lt;&lt; 1 =&gt; 1010 =&gt; 10100 =&gt; 20</li><li><blockquote><blockquote><p>   m &gt;&gt; n å°†åè¿›åˆ¶æ•°mè½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°ï¼ŒæŒ‰ä½å³ç§»nä½ï¼Œå·¦è¾¹è¡¥ä¸Šnä¸ª0ï¼Œæœ€åè½¬æ¢ä¸ºåè¿›åˆ¶æ•°<br> ä¾‹ï¼š10 &gt;&gt; 1 =&gt; 1010 =&gt; 0101 =&gt; 5<br><code>`</code></p></blockquote></blockquote></li></ol><h3 id="è¿ç®—ç¬¦ä¼˜å…ˆçº§"><a href="#è¿ç®—ç¬¦ä¼˜å…ˆçº§" class="headerlink" title="è¿ç®—ç¬¦ä¼˜å…ˆçº§"></a>è¿ç®—ç¬¦ä¼˜å…ˆçº§</h3><p><img src="https://wenku.baidu.com/content/216d3e2926284b73f242336c1eb91a37f11132c9?m=26e2fd787393eaa2973d6c1f478627b5&amp;type=pic&amp;src=04452f9619b2848d6d760be569e87603.jpg" alt="image"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class
      
    
    </summary>
    
      <category term="MySQL" scheme="https://zhipenwang.github.io/categories/MySQL/"/>
    
    
      <category term="æ•°æ®åº“" scheme="https://zhipenwang.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>MYSQLä¹‹æ“ä½œæ•°æ®ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰</title>
    <link href="https://zhipenwang.github.io/2018/07/07/mysql_dba/"/>
    <id>https://zhipenwang.github.io/2018/07/07/mysql_dba/</id>
    <published>2018-07-07T10:21:01.000Z</published>
    <updated>2019-04-09T14:57:32.975Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ•°æ®è¡¨ç»“æ„"><a href="#æ•°æ®è¡¨ç»“æ„" class="headerlink" title="æ•°æ®è¡¨ç»“æ„"></a>æ•°æ®è¡¨ç»“æ„</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$sql = `</span><br><span class="line">create table if not exists table_test(</span><br><span class="line">id int(11) not null auto_increment primary key,</span><br><span class="line">name varchar(30) not null,</span><br><span class="line">sex tinyint(1) null</span><br><span class="line">)</span><br><span class="line">`;</span><br></pre></td></tr></table></figure><h3 id="æ’å…¥æ“ä½œ"><a href="#æ’å…¥æ“ä½œ" class="headerlink" title="æ’å…¥æ“ä½œ"></a>æ’å…¥æ“ä½œ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// insert value æ’å…¥</span><br><span class="line">$sql = &quot;insert into table_test values(1, &apos;name1&apos;, 1)&quot;;</span><br><span class="line">// æ’å…¥éƒ¨åˆ†å­—æ®µ</span><br><span class="line">$sql = &quot;insert into table_test (name,sex) values(&apos;name2&apos;, 2)&quot;;</span><br><span class="line">// æ’å…¥å¤šæ¡è¯­å¥</span><br><span class="line">$sql = &quot;insert into table_test (name,sex) values(&apos;name1&apos;, 1), (&apos;name2&apos;, 2)&quot;;</span><br><span class="line">// insert set æ’å…¥</span><br><span class="line">$sql = &quot;insert into table_test set name=&apos;name1&apos;,sex=1&quot;;</span><br><span class="line">// insert selectæ’å…¥</span><br><span class="line">$sql = &quot;insert into table_test (name,sex) select name,sex from table_test where id=1&quot;;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹æ“ä½œ"><a href="#ä¿®æ”¹æ“ä½œ" class="headerlink" title="ä¿®æ”¹æ“ä½œ"></a>ä¿®æ”¹æ“ä½œ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// update setä¿®æ”¹</span><br><span class="line">$sql = &quot;update table_test set name=&apos;name2&apos; where id=1&quot;;</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤æ“ä½œ"><a href="#åˆ é™¤æ“ä½œ" class="headerlink" title="åˆ é™¤æ“ä½œ"></a>åˆ é™¤æ“ä½œ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// delete whereåˆ é™¤</span><br><span class="line">$sql = &quot;delete from table_test where id=1&quot;;</span><br><span class="line">// truncate tableåˆ é™¤è¡¨æ‰€æœ‰è¡Œæ•°æ®,ä¸”auto_increment é‡æ–°è®¡æ•°</span><br><span class="line">$sql = &quot;truncate table table_test&quot;;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢æ“ä½œ"><a href="#æŸ¥è¯¢æ“ä½œ" class="headerlink" title="æŸ¥è¯¢æ“ä½œ"></a>æŸ¥è¯¢æ“ä½œ</h3><blockquote><p>æ¡ä»¶é¡ºåºå¦‚ä¸‹ï¼š group by â€¦ having â€¦ order by â€¦ limit â€¦</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// æ™®é€šæŸ¥è¯¢</span><br><span class="line">$sql = &quot;select * from table_test&quot;;</span><br><span class="line">// in æŸ¥è¯¢</span><br><span class="line">$sql = &quot;select * from table_test where name in (&apos;name1&apos;, &apos;name2&apos;)&quot;;</span><br><span class="line">// distinct æŸ¥è¯¢æŸä¸ªå­—æ®µå»é‡(å¤šå­—æ®µè¡¨ç¤ºå¤šå­—æ®µåˆå¹¶çš„å»é‡ distinct name,sex)</span><br><span class="line">$sql = &quot;select distinct name from table_test&quot;;</span><br><span class="line">// group_concat(field1) group by field2(æŒ‰field2åˆ†ç»„åï¼Œfield1çš„å€¼ç”¨ï¼Œéš”å¼€)</span><br><span class="line">$sql = &quot;select group_concat(money),order_id from table_test group by order_id&quot;;</span><br></pre></td></tr></table></figure><h3 id="èšåˆæŸ¥è¯¢"><a href="#èšåˆæŸ¥è¯¢" class="headerlink" title="èšåˆæŸ¥è¯¢"></a>èšåˆæŸ¥è¯¢</h3><blockquote><p>count(*) æŸ¥è¯¢ç»“æœæ€»æ•°é›†<br>sum(field) è®¡ç®—å­—æ®µæ±‚å’Œæ€»å€¼<br>avg(field) è®¡ç®—å­—æ®µå¹³å‡å€¼<br>max(field) è®¡ç®—å­—æ®µæœ€å¤§å€¼<br>min(field) è®¡ç®—å­—æ®µæœ€å°å€¼</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;æ•°æ®è¡¨ç»“æ„&quot;&gt;&lt;a href=&quot;#æ•°æ®è¡¨ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;æ•°æ®è¡¨ç»“æ„&quot;&gt;&lt;/a&gt;æ•°æ®è¡¨ç»“æ„&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;
      
    
    </summary>
    
      <category term="MySQL" scheme="https://zhipenwang.github.io/categories/MySQL/"/>
    
    
      <category term="æ•°æ®åº“" scheme="https://zhipenwang.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>MYSQLä¹‹æ“ä½œæ•°æ®è¡¨</title>
    <link href="https://zhipenwang.github.io/2018/07/07/mysql_operation/"/>
    <id>https://zhipenwang.github.io/2018/07/07/mysql_operation/</id>
    <published>2018-07-07T09:21:01.000Z</published>
    <updated>2019-04-09T14:57:32.977Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ–‡ä¸­å‡ä½¿ç”¨ <code>table_test</code> ä½œä¸ºè¡¨å</p></blockquote><h3 id="åˆ›å»ºæ•°æ®è¡¨"><a href="#åˆ›å»ºæ•°æ®è¡¨" class="headerlink" title="åˆ›å»ºæ•°æ®è¡¨"></a>åˆ›å»ºæ•°æ®è¡¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists table_test(</span><br><span class="line">    id int(11) auto_increment primary key,</span><br><span class="line">    name varchar(30) not null comment &apos;åç§°&apos;,</span><br><span class="line">    password varchar(30) not null comment &apos;å¯†ç &apos;</span><br><span class="line">) comment=&quot;è¡¨å&quot;;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹è¡¨ç»“æ„"><a href="#æŸ¥çœ‹è¡¨ç»“æ„" class="headerlink" title="æŸ¥çœ‹è¡¨ç»“æ„"></a>æŸ¥çœ‹è¡¨ç»“æ„</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">show columns from table_test;</span><br><span class="line">æˆ–è€…</span><br><span class="line">describe table_test;</span><br><span class="line">æˆ–è€…</span><br><span class="line">desc table_test;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹è¡¨ç»“æ„"><a href="#ä¿®æ”¹è¡¨ç»“æ„" class="headerlink" title="ä¿®æ”¹è¡¨ç»“æ„"></a>ä¿®æ”¹è¡¨ç»“æ„</h3><h4 id="1-æ·»åŠ æ–°å­—æ®µåŠä¿®æ”¹å­˜åœ¨å­—æ®µ"><a href="#1-æ·»åŠ æ–°å­—æ®µåŠä¿®æ”¹å­˜åœ¨å­—æ®µ" class="headerlink" title="1. æ·»åŠ æ–°å­—æ®µåŠä¿®æ”¹å­˜åœ¨å­—æ®µ"></a>1. æ·»åŠ æ–°å­—æ®µåŠä¿®æ”¹å­˜åœ¨å­—æ®µ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter table table_test</span><br><span class="line">    add sex enum(&apos;male&apos;, &apos;female&apos;) not null default &apos;male&apos; comment &apos;æ€§åˆ«&apos;,</span><br><span class="line">    modify name varchar(40);</span><br></pre></td></tr></table></figure><h4 id="2-ä¿®æ”¹è¡¨å­—æ®µå"><a href="#2-ä¿®æ”¹è¡¨å­—æ®µå" class="headerlink" title="2. ä¿®æ”¹è¡¨å­—æ®µå"></a>2. ä¿®æ”¹è¡¨å­—æ®µå</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table table_test</span><br><span class="line">    change column date create_time date null default &apos;0000-00-00&apos;;</span><br></pre></td></tr></table></figure><h4 id="3-åˆ é™¤å­—æ®µ"><a href="#3-åˆ é™¤å­—æ®µ" class="headerlink" title="3. åˆ é™¤å­—æ®µ"></a>3. åˆ é™¤å­—æ®µ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table table_test </span><br><span class="line">    drop create_time;</span><br></pre></td></tr></table></figure><h4 id="4-ä¿®æ”¹è¡¨å"><a href="#4-ä¿®æ”¹è¡¨å" class="headerlink" title="4. ä¿®æ”¹è¡¨å"></a>4. ä¿®æ”¹è¡¨å</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table table_test </span><br><span class="line">    rename as table_test_new;</span><br></pre></td></tr></table></figure><h3 id="é‡å‘½åè¡¨"><a href="#é‡å‘½åè¡¨" class="headerlink" title="é‡å‘½åè¡¨"></a>é‡å‘½åè¡¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename table table_test_new to table_test;</span><br></pre></td></tr></table></figure><h3 id="å¤åˆ¶è¡¨"><a href="#å¤åˆ¶è¡¨" class="headerlink" title="å¤åˆ¶è¡¨"></a>å¤åˆ¶è¡¨</h3><h4 id="1-å¤åˆ¶è¡¨ç»“æ„"><a href="#1-å¤åˆ¶è¡¨ç»“æ„" class="headerlink" title="1. å¤åˆ¶è¡¨ç»“æ„"></a>1. å¤åˆ¶è¡¨ç»“æ„</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table table_test_copy1 like table_test;</span><br></pre></td></tr></table></figure><h4 id="2-å¤åˆ¶è¡¨ç»“æ„åŠæ•°æ®"><a href="#2-å¤åˆ¶è¡¨ç»“æ„åŠæ•°æ®" class="headerlink" title="2. å¤åˆ¶è¡¨ç»“æ„åŠæ•°æ®"></a>2. å¤åˆ¶è¡¨ç»“æ„åŠæ•°æ®</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table table_test_copy2 as select * from table_test;</span><br></pre></td></tr></table></figure><h4 id="3-å¤åˆ¶éƒ¨åˆ†è¡¨ç»“æ„åŠæ•°æ®"><a href="#3-å¤åˆ¶éƒ¨åˆ†è¡¨ç»“æ„åŠæ•°æ®" class="headerlink" title="3. å¤åˆ¶éƒ¨åˆ†è¡¨ç»“æ„åŠæ•°æ®"></a>3. å¤åˆ¶éƒ¨åˆ†è¡¨ç»“æ„åŠæ•°æ®</h4><blockquote><p>åªå¤åˆ¶äº†<code>id</code>,<code>name</code>ä¸¤ä¸ªå­—æ®µçš„è¡¨ç»“æ„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table table_test_copy3 as select id,name from table_test&apos;</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="åˆ é™¤è¡¨"><a href="#åˆ é™¤è¡¨" class="headerlink" title="åˆ é™¤è¡¨"></a>åˆ é™¤è¡¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table if not exists table_test;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æ–‡ä¸­å‡ä½¿ç”¨ &lt;code&gt;table_test&lt;/code&gt; ä½œä¸ºè¡¨å&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;åˆ›å»ºæ•°æ®è¡¨&quot;&gt;&lt;a href=&quot;#åˆ›å»ºæ•°æ®è¡¨&quot; class=&quot;headerlink&quot; title=&quot;åˆ›å»ºæ•°æ®è¡¨&quot;&gt;&lt;/a&gt;åˆ›å»º
      
    
    </summary>
    
      <category term="MySQL" scheme="https://zhipenwang.github.io/categories/MySQL/"/>
    
    
      <category term="æ•°æ®åº“" scheme="https://zhipenwang.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>PHPè®¾è®¡æ¨¡å¼ä¹‹è¡Œä¸ºå‹æ¨¡å¼ï¼ˆbehavioral patternsï¼‰</title>
    <link href="https://zhipenwang.github.io/2018/07/01/behavioral_patterns/"/>
    <id>https://zhipenwang.github.io/2018/07/01/behavioral_patterns/</id>
    <published>2018-07-01T12:21:01.000Z</published>
    <updated>2019-04-09T14:57:32.964Z</updated>
    
    <content type="html"><![CDATA[<h3 id="è´£ä»»é“¾æ¨¡å¼"><a href="#è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼"></a>è´£ä»»é“¾æ¨¡å¼</h3><blockquote><p>ä¸ºè¯·æ±‚åˆ›å»ºäº†ä¸€ä¸ªæ¥æ”¶è€…å¯¹è±¡çš„é“¾<br>è¿™ç§æ¨¡å¼ç»™äºˆè¯·æ±‚çš„ç±»å‹ï¼Œå¯¹è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…è¿›è¡Œè§£è€¦<br><strong>ä¼˜ç‚¹ï¼š</strong>  </p><ol><li>é™ä½è€¦åˆåº¦ã€‚å®ƒå°†è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…è§£è€¦ã€‚ </li><li>ç®€åŒ–äº†å¯¹è±¡ã€‚ä½¿å¾—å¯¹è±¡ä¸éœ€è¦çŸ¥é“é“¾çš„ç»“æ„ã€‚ </li><li>å¢å¼ºç»™å¯¹è±¡æŒ‡æ´¾èŒè´£çš„çµæ´»æ€§ã€‚é€šè¿‡æ”¹å˜é“¾å†…çš„æˆå‘˜æˆ–è€…è°ƒåŠ¨å®ƒä»¬çš„æ¬¡åºï¼Œå…è®¸åŠ¨æ€åœ°æ–°å¢æˆ–è€…åˆ é™¤è´£ä»»ã€‚ </li><li>å¢åŠ æ–°çš„è¯·æ±‚å¤„ç†ç±»å¾ˆæ–¹ä¾¿ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong></p><ol><li>ä¸èƒ½ä¿è¯è¯·æ±‚ä¸€å®šè¢«æ¥æ”¶ã€‚ </li><li>ç³»ç»Ÿæ€§èƒ½å°†å—åˆ°ä¸€å®šå½±å“ï¼Œè€Œä¸”åœ¨è¿›è¡Œä»£ç è°ƒè¯•æ—¶ä¸å¤ªæ–¹ä¾¿ï¼Œå¯èƒ½ä¼šé€ æˆå¾ªç¯è°ƒç”¨ã€‚ </li><li>å¯èƒ½ä¸å®¹æ˜“è§‚å¯Ÿè¿è¡Œæ—¶çš„ç‰¹å¾ï¼Œæœ‰ç¢äºé™¤é”™</li></ol></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * è´£ä»»é“¾æ¨¡å¼  -- responsibility pattern</span><br><span class="line"> */</span><br><span class="line">abstract class Responsibility</span><br><span class="line">&#123;</span><br><span class="line">protected $next;</span><br><span class="line">public function setNext(Responsibility $obj)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;next = $obj;</span><br><span class="line">return $this;</span><br><span class="line">&#125;</span><br><span class="line">abstract public function operator();</span><br><span class="line">&#125;</span><br><span class="line">class ResponsibilityA extends Responsibility</span><br><span class="line">&#123;</span><br><span class="line">public function operator()</span><br><span class="line">&#123;</span><br><span class="line">if(false == is_null($this-&gt;next))&#123;</span><br><span class="line">$this-&gt;next-&gt;operator();</span><br><span class="line">echo &quot;this is responsibility A&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class ResponsibilityB extends Responsibility</span><br><span class="line">&#123;</span><br><span class="line">public function operator()</span><br><span class="line">&#123;</span><br><span class="line">if(false == is_null($this-&gt;next))&#123;</span><br><span class="line">$this-&gt;next-&gt;operator();</span><br><span class="line">echo &quot;this is responsibility B&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$responsibilityA = new ResponsibilityA();</span><br><span class="line">$responsibilityB = new ResponsibilityB();</span><br><span class="line">$responsibilityA-&gt;setNext($responsibilityB);</span><br><span class="line">$responsibilityA-&gt;operator();</span><br></pre></td></tr></table></figure><h3 id="å‘½ä»¤æ¨¡å¼"><a href="#å‘½ä»¤æ¨¡å¼" class="headerlink" title="å‘½ä»¤æ¨¡å¼"></a>å‘½ä»¤æ¨¡å¼</h3><blockquote><p>è¯·æ±‚ä»¥å‘½ä»¤çš„å½¢å¼åŒ…è£¹åœ¨å¯¹è±¡ä¸­ï¼Œå¹¶ä¼ ç»™è°ƒç”¨å¯¹è±¡ã€‚<br>è°ƒç”¨å¯¹è±¡å¯»æ‰¾å¯ä»¥å¤„ç†è¯¥å‘½ä»¤çš„åˆé€‚çš„å¯¹è±¡ï¼Œå¹¶æŠŠè¯¥å‘½ä»¤ä¼ ç»™ç›¸åº”çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ‰§è¡Œå‘½ä»¤ã€‚<br>é€šè¿‡è°ƒç”¨è€…è°ƒç”¨æ¥å—è€…æ‰§è¡Œå‘½ä»¤ï¼Œé¡ºåºï¼šè°ƒç”¨è€…â†’æ¥å—è€…â†’å‘½ä»¤ã€‚<br><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li>é™ä½äº†ç³»ç»Ÿè€¦åˆåº¦ã€‚</li><li>æ–°çš„å‘½ä»¤å¯ä»¥å¾ˆå®¹æ˜“æ·»åŠ åˆ°ç³»ç»Ÿä¸­å»ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong><br>ä½¿ç”¨å‘½ä»¤æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´æŸäº›ç³»ç»Ÿæœ‰è¿‡å¤šçš„å…·ä½“å‘½ä»¤ç±»ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * å‘½ä»¤æ¨¡å¼  -- commandpattern</span><br><span class="line"> */</span><br><span class="line">// å®šä¹‰æ¥å£</span><br><span class="line">interface Command</span><br><span class="line">&#123;</span><br><span class="line">public function execute();</span><br><span class="line">&#125;</span><br><span class="line">class RealCommand implements Command</span><br><span class="line">&#123;</span><br><span class="line">private $_receiver;</span><br><span class="line">public function __construct(Receiver $receiver)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_receiver = $receiver;</span><br><span class="line">&#125;</span><br><span class="line">public function execute()</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_receiver-&gt;action();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">// æ¥å—è€…</span><br><span class="line">class Receiver</span><br><span class="line">&#123;</span><br><span class="line">private $_name;</span><br><span class="line">public function __construct($name)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_name = $name;</span><br><span class="line">&#125;</span><br><span class="line">public function action()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;this is receiver&quot; . $this-&gt;_name;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">// è¯·æ±‚è€…</span><br><span class="line">class Invoker</span><br><span class="line">&#123;</span><br><span class="line">private $_realCommand;</span><br><span class="line">public function __construct(RealCommand $realCommand)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_realCommand = $realCommand;</span><br><span class="line">&#125;</span><br><span class="line">public function operator()</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_realCommand-&gt;execute();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$receiver = new Receiver(&apos;hello world&apos;);</span><br><span class="line">$realCommand = new RealCommand($receiver);</span><br><span class="line">$invoker = new Invoker($realCommand);</span><br><span class="line">$invoker-&gt;operator();</span><br></pre></td></tr></table></figure><h3 id="è§£é‡Šå™¨æ¨¡å¼"><a href="#è§£é‡Šå™¨æ¨¡å¼" class="headerlink" title="è§£é‡Šå™¨æ¨¡å¼"></a>è§£é‡Šå™¨æ¨¡å¼</h3><blockquote><p>ä¸€ä¸ªè¡¨è¾¾å¼æ¥å£ï¼Œè¯¥æ¥å£è§£é‡Šä¸€ä¸ªç‰¹å®šçš„ä¸Šä¸‹æ–‡ã€‚è¿™ç§æ¨¡å¼è¢«ç”¨åœ¨ SQL è§£æã€ç¬¦å·å¤„ç†å¼•æ“ç­‰ã€‚<br><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li>å¯æ‰©å±•æ€§æ¯”è¾ƒå¥½ï¼Œçµæ´»ã€‚ </li><li>å¢åŠ äº†æ–°çš„è§£é‡Šè¡¨è¾¾å¼çš„æ–¹å¼ã€‚ </li><li>æ˜“äºå®ç°ç®€å•æ–‡æ³•ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong></p><ol><li>å¯åˆ©ç”¨åœºæ™¯æ¯”è¾ƒå°‘ã€‚ </li><li>å¯¹äºå¤æ‚çš„æ–‡æ³•æ¯”è¾ƒéš¾ç»´æŠ¤ã€‚ </li><li>è§£é‡Šå™¨æ¨¡å¼ä¼šå¼•èµ·ç±»è†¨èƒ€ã€‚ </li><li>è§£é‡Šå™¨æ¨¡å¼é‡‡ç”¨é€’å½’è°ƒç”¨æ–¹æ³•ã€‚</li></ol></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * è§£é‡Šå™¨æ¨¡å¼  -- interpreter pattern</span><br><span class="line"> */</span><br><span class="line">interface Expression</span><br><span class="line">&#123;</span><br><span class="line">public function interpreter($data);</span><br><span class="line">&#125;</span><br><span class="line">class NumberExpression implements Expression</span><br><span class="line">&#123;</span><br><span class="line">public function interpreter($num)</span><br><span class="line">&#123;</span><br><span class="line">switch($num)&#123;</span><br><span class="line">case &apos;0&apos;: return &apos;é›¶&apos;;</span><br><span class="line">case &apos;1&apos;: return &apos;ä¸€&apos;;</span><br><span class="line">case &apos;2&apos;: return &apos;äºŒ&apos;;</span><br><span class="line">case &apos;3&apos;: return &apos;ä¸‰&apos;;</span><br><span class="line">case &apos;4&apos;: return &apos;å››&apos;;</span><br><span class="line">case &apos;5&apos;: return &apos;äº”&apos;;</span><br><span class="line">case &apos;6&apos;: return &apos;å…­&apos;;</span><br><span class="line">case &apos;7&apos;: return &apos;ä¸ƒ&apos;;</span><br><span class="line">case &apos;8&apos;: return &apos;å…«&apos;;</span><br><span class="line">case &apos;9&apos;: return &apos;ä¹…&apos;;</span><br><span class="line">default: return &apos;æ— &apos;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class StringExpression implements Expression</span><br><span class="line">&#123;</span><br><span class="line">public function interpreter($str)</span><br><span class="line">&#123;</span><br><span class="line">return strtoupper($str);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class Interpreter</span><br><span class="line">&#123;</span><br><span class="line">public function execute($string)</span><br><span class="line">&#123;</span><br><span class="line">$expression = null;</span><br><span class="line">for($i=0; $i&lt;strlen($string); $i++)&#123;</span><br><span class="line">if(is_numeric($string[$i]))&#123;</span><br><span class="line">$expression = new NumberExpression();</span><br><span class="line">&#125;elseif(is_string($string[$i]))&#123;</span><br><span class="line">$expression = new StringExpression();</span><br><span class="line">&#125;</span><br><span class="line">echo $expression-&gt;interpreter($string[$i]);</span><br><span class="line">echo &quot;&lt;br/&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj = new Interpreter();</span><br><span class="line">$obj-&gt;execute(&apos;123sqwe09843&apos;);</span><br></pre></td></tr></table></figure><h3 id="è¿­ä»£å™¨æ¨¡å¼"><a href="#è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="è¿­ä»£å™¨æ¨¡å¼"></a>è¿­ä»£å™¨æ¨¡å¼</h3><blockquote><p>é¡ºåºè®¿é—®é›†åˆå¯¹è±¡çš„å…ƒç´ ï¼Œä¸éœ€è¦çŸ¥é“é›†åˆå¯¹è±¡çš„åº•å±‚è¡¨ç¤ºã€‚<br><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li>å®ƒæ”¯æŒä»¥ä¸åŒçš„æ–¹å¼éå†ä¸€ä¸ªèšåˆå¯¹è±¡ã€‚ </li><li>è¿­ä»£å™¨ç®€åŒ–äº†èšåˆç±»ã€‚ </li><li>åœ¨åŒä¸€ä¸ªèšåˆä¸Šå¯ä»¥æœ‰å¤šä¸ªéå†ã€‚ </li><li>åœ¨è¿­ä»£å™¨æ¨¡å¼ä¸­ï¼Œå¢åŠ æ–°çš„èšåˆç±»å’Œè¿­ä»£å™¨ç±»éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ä»£ç ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong><br>ç”±äºè¿­ä»£å™¨æ¨¡å¼å°†å­˜å‚¨æ•°æ®å’Œéå†æ•°æ®çš„èŒè´£åˆ†ç¦»ï¼Œå¢åŠ æ–°çš„èšåˆç±»éœ€è¦å¯¹åº”å¢åŠ æ–°çš„è¿­ä»£å™¨ç±»ï¼Œç±»çš„ä¸ªæ•°æˆå¯¹å¢åŠ ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong><br>è¿­ä»£å™¨æ¨¡å¼å°±æ˜¯åˆ†ç¦»äº†é›†åˆå¯¹è±¡çš„éå†è¡Œä¸ºï¼ŒæŠ½è±¡å‡ºä¸€ä¸ªè¿­ä»£å™¨ç±»æ¥è´Ÿè´£ï¼Œè¿™æ ·æ—¢å¯ä»¥åšåˆ°ä¸æš´éœ²é›†åˆçš„å†…éƒ¨ç»“æ„ï¼Œåˆå¯è®©å¤–éƒ¨ä»£ç é€æ˜åœ°è®¿é—®é›†åˆå†…éƒ¨çš„æ•°æ®ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * è¿­ä»£å™¨æ¨¡å¼  --  iterator pattern</span><br><span class="line"> */</span><br><span class="line">class Sample implements Iterator</span><br><span class="line">&#123;</span><br><span class="line">private $_item;</span><br><span class="line">public function __construct($data)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_item = $data;</span><br><span class="line">&#125;</span><br><span class="line">public function current()</span><br><span class="line">&#123;</span><br><span class="line">return current($this-&gt;_item);</span><br><span class="line">&#125;</span><br><span class="line">public function next()</span><br><span class="line">&#123;</span><br><span class="line">return next($this-&gt;_item);</span><br><span class="line">&#125;</span><br><span class="line">public function key()</span><br><span class="line">&#123;</span><br><span class="line">return key($this-&gt;_item);</span><br><span class="line">&#125;</span><br><span class="line">public function rewind()</span><br><span class="line">&#123;</span><br><span class="line">reset($this-&gt;_item);</span><br><span class="line">&#125;</span><br><span class="line">public function valid()</span><br><span class="line">&#123;</span><br><span class="line">return ($this-&gt;current() !== false);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$data = array(&apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;);</span><br><span class="line">$obj = new Sample($data);</span><br><span class="line">echo $obj-&gt;current();</span><br><span class="line">echo $obj-&gt;next();</span><br><span class="line">echo $obj-&gt;key();</span><br><span class="line">echo $obj-&gt;rewind();</span><br><span class="line">echo $obj-&gt;valid();</span><br></pre></td></tr></table></figure><h3 id="ä¸­ä»‹è€…æ¨¡å¼"><a href="#ä¸­ä»‹è€…æ¨¡å¼" class="headerlink" title="ä¸­ä»‹è€…æ¨¡å¼"></a>ä¸­ä»‹è€…æ¨¡å¼</h3><blockquote><p>é™ä½å¤šä¸ªå¯¹è±¡å’Œç±»ä¹‹é—´çš„é€šä¿¡å¤æ‚æ€§ã€‚<br>è¯¥ç±»é€šå¸¸å¤„ç†ä¸åŒç±»ä¹‹é—´çš„é€šä¿¡ï¼Œå¹¶æ”¯æŒæ¾è€¦åˆï¼Œä½¿ä»£ç æ˜“äºç»´æŠ¤ã€‚<br><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li>é™ä½äº†ç±»çš„å¤æ‚åº¦ï¼Œå°†ä¸€å¯¹å¤šè½¬åŒ–æˆäº†ä¸€å¯¹ä¸€ã€‚ </li><li>å„ä¸ªç±»ä¹‹é—´çš„è§£è€¦ã€‚ 3ã€ç¬¦åˆè¿ªç±³ç‰¹åŸåˆ™ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong><br>ä¸­ä»‹è€…ä¼šåºå¤§ï¼Œå˜å¾—å¤æ‚éš¾ä»¥ç»´æŠ¤ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * ä¸­ä»‹è€…æ¨¡å¼  -- mediator pattern</span><br><span class="line"> */</span><br><span class="line">abstract class Mediator</span><br><span class="line">&#123;</span><br><span class="line">abstract public function send($message, $colleague);</span><br><span class="line">&#125;</span><br><span class="line">abstract class Colleague</span><br><span class="line">&#123;</span><br><span class="line">private $_mediator;</span><br><span class="line">public function __construct($mediator)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_mediator = $mediator;</span><br><span class="line">&#125;</span><br><span class="line">public function send($message)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_mediator-&gt;send($message, $this);</span><br><span class="line">&#125;</span><br><span class="line">abstract public function notify($message);</span><br><span class="line">&#125;</span><br><span class="line">class Colleague1 extends Colleague</span><br><span class="line">&#123;</span><br><span class="line">public function notify($message)</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;colleague1 &quot; . $message;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class Colleague2 extends Colleague</span><br><span class="line">&#123;</span><br><span class="line">public function notify($message)</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;colleague2 &quot; . $message;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class NewMediator extends Mediator</span><br><span class="line">&#123;</span><br><span class="line">private $_colleauge1;</span><br><span class="line">private $_colleauge2;</span><br><span class="line">public function set($col1, $col2)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_colleauge1 = $col1;</span><br><span class="line">$this-&gt;_colleauge2 = $col2;</span><br><span class="line">&#125;</span><br><span class="line">public function send($message, $colleague)</span><br><span class="line">&#123;</span><br><span class="line">if($this-&gt;_colleauge1 == $colleague)&#123;</span><br><span class="line">$this-&gt;_colleauge1-&gt;notify($message);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">$this-&gt;_colleauge2-&gt;notify($message);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$newMediator = new NewMediator();</span><br><span class="line">$col1 = new Colleague1($newMediator);</span><br><span class="line">$col2 = new Colleague2($newMediator);</span><br><span class="line">$newMediator-&gt;set($col1, $col2);</span><br><span class="line">$col1-&gt;send(&apos;hello col1&apos;);</span><br><span class="line">$col2-&gt;send(&apos;hello col2&apos;);</span><br></pre></td></tr></table></figure><h3 id="å¤‡å¿˜å½•æ¨¡å¼"><a href="#å¤‡å¿˜å½•æ¨¡å¼" class="headerlink" title="å¤‡å¿˜å½•æ¨¡å¼"></a>å¤‡å¿˜å½•æ¨¡å¼</h3><blockquote><p>ä¿å­˜ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªçŠ¶æ€ï¼Œä»¥ä¾¿åœ¨é€‚å½“çš„æ—¶å€™æ¢å¤å¯¹è±¡<br>æ‰€è°“å¤‡å¿˜å½•æ¨¡å¼å°±æ˜¯åœ¨ä¸ç ´åå°è£…çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œè¿™æ ·å¯ä»¥åœ¨ä»¥åå°†å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€<br>é€šè¿‡ä¸€ä¸ªå¤‡å¿˜å½•ç±»ä¸“é—¨å­˜å‚¨å¯¹è±¡çŠ¶æ€<br>å®¢æˆ·ä¸ä¸å¤‡å¿˜å½•ç±»è€¦åˆï¼Œä¸å¤‡å¿˜å½•ç®¡ç†ç±»è€¦åˆ<br><strong>ä¼˜ç‚¹ï¼š</strong>  </p><ol><li>ç»™ç”¨æˆ·æä¾›äº†ä¸€ç§å¯ä»¥æ¢å¤çŠ¶æ€çš„æœºåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨æˆ·èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿åœ°å›åˆ°æŸä¸ªå†å²çš„çŠ¶æ€ã€‚ </li><li>å®ç°äº†ä¿¡æ¯çš„å°è£…ï¼Œä½¿å¾—ç”¨æˆ·ä¸éœ€è¦å…³å¿ƒçŠ¶æ€çš„ä¿å­˜ç»†èŠ‚ã€‚  </li></ol><p><strong>ç¼ºç‚¹ï¼š</strong><br>æ¶ˆè€—èµ„æºã€‚å¦‚æœç±»çš„æˆå‘˜å˜é‡è¿‡å¤šï¼ŒåŠ¿å¿…ä¼šå ç”¨æ¯”è¾ƒå¤§çš„èµ„æºï¼Œè€Œä¸”æ¯ä¸€æ¬¡ä¿å­˜éƒ½ä¼šæ¶ˆè€—ä¸€å®šçš„å†…å­˜ã€‚  </p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong>  </p><ol><li>ä¸ºäº†ç¬¦åˆè¿ªç±³ç‰¹åŸåˆ™ï¼Œè¿˜è¦å¢åŠ ä¸€ä¸ªç®¡ç†å¤‡å¿˜å½•çš„ç±»ã€‚ </li><li>ä¸ºäº†èŠ‚çº¦å†…å­˜ï¼Œå¯ä½¿ç”¨åŸå‹æ¨¡å¼+å¤‡å¿˜å½•æ¨¡å¼ã€‚</li></ol></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * å¤‡å¿˜å½•æ¨¡å¼  --  memento pattern</span><br><span class="line"> */</span><br><span class="line">class Memento</span><br><span class="line">&#123;</span><br><span class="line">private $_memento;</span><br><span class="line">public function __construct(string $state)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_memento = $state;</span><br><span class="line">&#125;</span><br><span class="line">public function getState()</span><br><span class="line">&#123;</span><br><span class="line">return $this-&gt;_memento;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class Originator</span><br><span class="line">&#123;</span><br><span class="line">private $_state;</span><br><span class="line">public function setState(string $state)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_state = $state;</span><br><span class="line">&#125;</span><br><span class="line">public function getState()</span><br><span class="line">&#123;</span><br><span class="line">return $this-&gt;_state;</span><br><span class="line">&#125;</span><br><span class="line">public function saveMemento()</span><br><span class="line">&#123;</span><br><span class="line">return new Memento($this-&gt;_state);</span><br><span class="line">&#125;</span><br><span class="line">public function getMemento(Memento $memento)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_state = $memento-&gt;getState();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class CakeTask</span><br><span class="line">&#123;</span><br><span class="line">private $_mementoList;</span><br><span class="line">public function __construct()</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_mementoList = array();</span><br><span class="line">&#125;</span><br><span class="line">public function add(Memento $memento)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_mementoList[] = $memento;</span><br><span class="line">&#125;</span><br><span class="line">public function get(int $index)</span><br><span class="line">&#123;</span><br><span class="line">return $this-&gt;_mementoList[$index];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$originator = new Originator();</span><br><span class="line">$cakeTask = new CakeTask();</span><br><span class="line">$originator-&gt;setState(&apos;hello one&apos;);</span><br><span class="line">$originator-&gt;setState(&apos;hello two&apos;);</span><br><span class="line">$cakeTask-&gt;add($originator-&gt;saveMemento());</span><br><span class="line">$originator-&gt;setState(&apos;hello three&apos;);</span><br><span class="line">$cakeTask-&gt;add($originator-&gt;saveMemento());</span><br><span class="line">$originator-&gt;setState(&apos;hello four&apos;);</span><br><span class="line"></span><br><span class="line">echo $originator-&gt;getState();</span><br><span class="line">$originator-&gt;getMemento($cakeTask-&gt;get(0));</span><br><span class="line">echo $originator-&gt;getState();</span><br><span class="line">$originator-&gt;getMemento($cakeTask-&gt;get(1));</span><br><span class="line">echo $originator-&gt;getState();</span><br></pre></td></tr></table></figure><h3 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h3><blockquote><p>å¯¹è±¡é—´å­˜åœ¨ä¸€å¯¹å¤šå…³ç³»<br>å½“ä¸€ä¸ªå¯¹è±¡è¢«ä¿®æ”¹æ—¶ï¼Œåˆ™ä¼šè‡ªåŠ¨é€šçŸ¥å®ƒçš„ä¾èµ–å¯¹è±¡å¹¶è¢«è‡ªåŠ¨æ›´æ–°<br><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li>è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…æ˜¯æŠ½è±¡è€¦åˆçš„ã€‚ </li><li>å»ºç«‹ä¸€å¥—è§¦å‘æœºåˆ¶ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong></p><ol><li>å¦‚æœä¸€ä¸ªè¢«è§‚å¯Ÿè€…å¯¹è±¡æœ‰å¾ˆå¤šçš„ç›´æ¥å’Œé—´æ¥çš„è§‚å¯Ÿè€…çš„è¯ï¼Œå°†æ‰€æœ‰çš„è§‚å¯Ÿè€…éƒ½é€šçŸ¥åˆ°ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚ </li><li>å¦‚æœåœ¨è§‚å¯Ÿè€…å’Œè§‚å¯Ÿç›®æ ‡ä¹‹é—´æœ‰å¾ªç¯ä¾èµ–çš„è¯ï¼Œè§‚å¯Ÿç›®æ ‡ä¼šè§¦å‘å®ƒä»¬ä¹‹é—´è¿›è¡Œå¾ªç¯è°ƒç”¨ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚ </li><li>è§‚å¯Ÿè€…æ¨¡å¼æ²¡æœ‰ç›¸åº”çš„æœºåˆ¶è®©è§‚å¯Ÿè€…çŸ¥é“æ‰€è§‚å¯Ÿçš„ç›®æ ‡å¯¹è±¡æ˜¯æ€ä¹ˆå‘ç”Ÿå˜åŒ–çš„ï¼Œè€Œä»…ä»…åªæ˜¯çŸ¥é“è§‚å¯Ÿç›®æ ‡å‘ç”Ÿäº†å˜åŒ–ã€‚</li></ol><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p><ol><li>é¿å…å¾ªç¯å¼•ç”¨ã€‚ </li><li>å¦‚æœé¡ºåºæ‰§è¡Œï¼ŒæŸä¸€è§‚å¯Ÿè€…é”™è¯¯ä¼šå¯¼è‡´ç³»ç»Ÿå¡å£³ï¼Œä¸€èˆ¬é‡‡ç”¨å¼‚æ­¥æ–¹å¼ã€‚</li></ol></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * è§‚å¯Ÿè€…æ¨¡å¼  -- observer pattern</span><br><span class="line"> */</span><br><span class="line">// å®šä¹‰æ¥å£</span><br><span class="line">interface Observer</span><br><span class="line">&#123;</span><br><span class="line">public function onSendMsg($name);</span><br><span class="line">public function getName();</span><br><span class="line">&#125;</span><br><span class="line">class UserListLogger implements Observer</span><br><span class="line">&#123;</span><br><span class="line">public function onSendMsg($name)</span><br><span class="line">&#123;</span><br><span class="line">echo $name . &apos; send to UserListLogger&apos;;</span><br><span class="line">&#125;</span><br><span class="line">public function getName()</span><br><span class="line">&#123;</span><br><span class="line">return &apos;userlist_logger&apos;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class OtherObserver implements Observer</span><br><span class="line">&#123;</span><br><span class="line">public function onSendMsg($name)</span><br><span class="line">&#123;</span><br><span class="line">echo $name . &apos; send to OtherObserver&apos;;</span><br><span class="line">&#125;</span><br><span class="line">public function getName()</span><br><span class="line">&#123;</span><br><span class="line">return &apos;other_observer&apos;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">interface Observerable</span><br><span class="line">&#123;</span><br><span class="line">public function add(Observer $observer);</span><br><span class="line">public function remove($name);</span><br><span class="line">&#125;</span><br><span class="line">class UserList implements Observerable</span><br><span class="line">&#123;</span><br><span class="line">private $_observer = array();</span><br><span class="line">public function add(Observer $observer)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_observer[] = $observer;</span><br><span class="line">&#125;</span><br><span class="line">public function remove($name)</span><br><span class="line">&#123;</span><br><span class="line">foreach($this-&gt;_observer as $k=&gt;$val)&#123;</span><br><span class="line">if($val-&gt;getName() == $name)&#123;</span><br><span class="line">unset($this-&gt;_observer[$k]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">public function sendMsg($name)</span><br><span class="line">&#123;</span><br><span class="line">foreach($this-&gt;_observer as $val)&#123;</span><br><span class="line">$val-&gt;onSendMsg($name);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$userList = new UserList();</span><br><span class="line">$userList-&gt;add(new UserListLogger());</span><br><span class="line">$userList-&gt;add(new OtherObserver());</span><br><span class="line">$userList-&gt;sendMsg(&apos;jone&apos;);</span><br><span class="line">$userList-&gt;remove(&apos;userlist_logger&apos;);</span><br><span class="line">$userList-&gt;sendMsg(&apos;jami&apos;);</span><br></pre></td></tr></table></figure><h3 id="çŠ¶æ€æ¨¡å¼"><a href="#çŠ¶æ€æ¨¡å¼" class="headerlink" title="çŠ¶æ€æ¨¡å¼"></a>çŠ¶æ€æ¨¡å¼</h3><blockquote><p>ç±»çš„è¡Œä¸ºæ˜¯åŸºäºå®ƒçš„çŠ¶æ€æ”¹å˜çš„<br>å¯¹è±¡çš„è¡Œä¸ºä¾èµ–äºå®ƒçš„çŠ¶æ€ï¼ˆå±æ€§ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®å®ƒçš„çŠ¶æ€æ”¹å˜è€Œæ”¹å˜å®ƒçš„ç›¸å…³è¡Œä¸ºã€‚<br><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li>å°è£…äº†è½¬æ¢è§„åˆ™ã€‚ </li><li>æšä¸¾å¯èƒ½çš„çŠ¶æ€ï¼Œåœ¨æšä¸¾çŠ¶æ€ä¹‹å‰éœ€è¦ç¡®å®šçŠ¶æ€ç§ç±»ã€‚ </li><li>å°†æ‰€æœ‰ä¸æŸä¸ªçŠ¶æ€æœ‰å…³çš„è¡Œä¸ºæ”¾åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°å¢åŠ æ–°çš„çŠ¶æ€ï¼Œåªéœ€è¦æ”¹å˜å¯¹è±¡çŠ¶æ€å³å¯æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºã€‚ </li><li>å…è®¸çŠ¶æ€è½¬æ¢é€»è¾‘ä¸çŠ¶æ€å¯¹è±¡åˆæˆä¸€ä½“ï¼Œè€Œä¸æ˜¯æŸä¸€ä¸ªå·¨å¤§çš„æ¡ä»¶è¯­å¥å—ã€‚ </li><li>å¯ä»¥è®©å¤šä¸ªç¯å¢ƒå¯¹è±¡å…±äº«ä¸€ä¸ªçŠ¶æ€å¯¹è±¡ï¼Œä»è€Œå‡å°‘ç³»ç»Ÿä¸­å¯¹è±¡çš„ä¸ªæ•°ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong></p><ol><li>çŠ¶æ€æ¨¡å¼çš„ä½¿ç”¨å¿…ç„¶ä¼šå¢åŠ ç³»ç»Ÿç±»å’Œå¯¹è±¡çš„ä¸ªæ•°ã€‚ </li><li>çŠ¶æ€æ¨¡å¼çš„ç»“æ„ä¸å®ç°éƒ½è¾ƒä¸ºå¤æ‚ï¼Œå¦‚æœä½¿ç”¨ä¸å½“å°†å¯¼è‡´ç¨‹åºç»“æ„å’Œä»£ç çš„æ··ä¹±ã€‚ </li><li>çŠ¶æ€æ¨¡å¼å¯¹â€å¼€é—­åŸåˆ™â€çš„æ”¯æŒå¹¶ä¸å¤ªå¥½ï¼Œå¯¹äºå¯ä»¥åˆ‡æ¢çŠ¶æ€çš„çŠ¶æ€æ¨¡å¼ï¼Œå¢åŠ æ–°çš„çŠ¶æ€ç±»éœ€è¦ä¿®æ”¹é‚£äº›è´Ÿè´£çŠ¶æ€è½¬æ¢çš„æºä»£ç ï¼Œå¦åˆ™æ— æ³•åˆ‡æ¢åˆ°æ–°å¢çŠ¶æ€ï¼Œè€Œä¸”ä¿®æ”¹æŸä¸ªçŠ¶æ€ç±»çš„è¡Œä¸ºä¹Ÿéœ€ä¿®æ”¹å¯¹åº”ç±»çš„æºä»£ç ã€‚</li></ol><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong><br>åœ¨è¡Œä¸ºå—çŠ¶æ€çº¦æŸçš„æ—¶å€™ä½¿ç”¨çŠ¶æ€æ¨¡å¼ï¼Œè€Œä¸”çŠ¶æ€ä¸è¶…è¿‡ 5 ä¸ªã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * çŠ¶æ€æ¨¡å¼  --  state pattern</span><br><span class="line"> */</span><br><span class="line">interface State</span><br><span class="line">&#123;</span><br><span class="line">public function handle(Context $context);</span><br><span class="line">&#125;</span><br><span class="line">class StateA implements State</span><br><span class="line">&#123;</span><br><span class="line">private static $_instance;</span><br><span class="line">private function __construct()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">public static function getInstance()</span><br><span class="line">&#123;</span><br><span class="line">if(is_null(self::$_instance))&#123;</span><br><span class="line">self::$_instance = new StateA();</span><br><span class="line">&#125;</span><br><span class="line">return self::$_instance;</span><br><span class="line">&#125;</span><br><span class="line">public function handle(Context $context)</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;context A&quot;;</span><br><span class="line">$context-&gt;setState(StateB::getInstance());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class StateB implements State</span><br><span class="line">&#123;</span><br><span class="line">private static $_instance;</span><br><span class="line">private function __construct()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">public static function getInstance()</span><br><span class="line">&#123;</span><br><span class="line">if(is_null(self::$_instance))&#123;</span><br><span class="line">self::$_instance = new StateB();</span><br><span class="line">&#125;</span><br><span class="line">return self::$_instance;</span><br><span class="line">&#125;</span><br><span class="line">public function handle(Context $context)</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;context B&quot;;</span><br><span class="line">$context-&gt;setState(StateA::getInstance());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class Context&#123;</span><br><span class="line">private $_state;</span><br><span class="line">public function __construct()</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_state = StateA::getInstance();</span><br><span class="line">&#125;</span><br><span class="line">public function setState(State $state)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_state = $state;</span><br><span class="line">&#125;</span><br><span class="line">public function request()</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_state-&gt;handle($this);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$context = new Context();</span><br><span class="line">$context-&gt;request();</span><br><span class="line">$context-&gt;request();</span><br><span class="line">$context-&gt;request();</span><br><span class="line">$context-&gt;request();</span><br></pre></td></tr></table></figure><h3 id="ç©ºå¯¹è±¡æ¨¡å¼"><a href="#ç©ºå¯¹è±¡æ¨¡å¼" class="headerlink" title="ç©ºå¯¹è±¡æ¨¡å¼"></a>ç©ºå¯¹è±¡æ¨¡å¼</h3><blockquote><p>ä¸€ä¸ªç©ºå¯¹è±¡å–ä»£ NULL å¯¹è±¡å®ä¾‹çš„æ£€æŸ¥<br>åœ¨ç©ºå¯¹è±¡æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæŒ‡å®šå„ç§è¦æ‰§è¡Œçš„æ“ä½œçš„æŠ½è±¡ç±»å’Œæ‰©å±•è¯¥ç±»çš„å®ä½“ç±»ï¼Œè¿˜åˆ›å»ºä¸€ä¸ªæœªå¯¹è¯¥ç±»åšä»»ä½•å®ç°çš„ç©ºå¯¹è±¡ç±»ï¼Œè¯¥ç©ºå¯¹è±¡ç±»å°†æ— ç¼åœ°ä½¿ç”¨åœ¨éœ€è¦æ£€æŸ¥ç©ºå€¼çš„åœ°æ–¹ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * ç©ºå¯¹è±¡æ¨¡å¼  --  null object pattern</span><br><span class="line"> */</span><br><span class="line">abstract class AbstractCustom</span><br><span class="line">&#123;</span><br><span class="line">private $_name;</span><br><span class="line">abstract public function isNil();</span><br><span class="line">abstract public function getName();</span><br><span class="line">&#125;</span><br><span class="line">class RealCustom extends AbstractCustom</span><br><span class="line">&#123;</span><br><span class="line">private $_name;</span><br><span class="line">public function __construct($name)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_name = $name;</span><br><span class="line">&#125;</span><br><span class="line">public function getName()</span><br><span class="line">&#123;</span><br><span class="line">return $this-&gt;_name;</span><br><span class="line">&#125;</span><br><span class="line">public function isNil()</span><br><span class="line">&#123;</span><br><span class="line">return false;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class NullCustom extends AbstractCustom</span><br><span class="line">&#123;</span><br><span class="line">public function getName()</span><br><span class="line">&#123;</span><br><span class="line">return &quot;this is null custom&quot;;</span><br><span class="line">&#125;</span><br><span class="line">public function isNil()</span><br><span class="line">&#123;</span><br><span class="line">return false;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class NullFactory</span><br><span class="line">&#123;</span><br><span class="line">private $_arr = array(&apos;one&apos;, &apos;two&apos;);</span><br><span class="line">public function getCustom($name)&#123;</span><br><span class="line">if(in_array($name, $this-&gt;_arr))&#123;</span><br><span class="line">return new RealCustom($name);</span><br><span class="line">&#125;</span><br><span class="line">return new NullCustom();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj = new NullFactory();</span><br><span class="line">$test1 = $obj-&gt;getCustom(&apos;one&apos;);</span><br><span class="line">$test2 = $obj-&gt;getCustom(&apos;one_one&apos;);</span><br><span class="line">$test3 = $obj-&gt;getCustom(&apos;two&apos;);</span><br><span class="line">$test4 = $obj-&gt;getCustom(&apos;two_two&apos;);</span><br><span class="line">echo $test1-&gt;getName();</span><br><span class="line">echo $test2-&gt;getName();</span><br><span class="line">echo $test3-&gt;getName();</span><br><span class="line">echo $test4-&gt;getName();</span><br></pre></td></tr></table></figure><h3 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h3><blockquote><p>ä¸€ä¸ªç±»çš„è¡Œä¸ºæˆ–å…¶ç®—æ³•å¯ä»¥åœ¨è¿è¡Œæ—¶æ›´æ”¹<br>å®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•,æŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥, å¹¶ä¸”ä½¿å®ƒä»¬å¯ç›¸äº’æ›¿æ¢<br><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li>ç®—æ³•å¯ä»¥è‡ªç”±åˆ‡æ¢ã€‚ </li><li>é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶åˆ¤æ–­ã€‚ </li><li>æ‰©å±•æ€§è‰¯å¥½ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong></p><ol><li>ç­–ç•¥ç±»ä¼šå¢å¤šã€‚ </li><li>æ‰€æœ‰ç­–ç•¥ç±»éƒ½éœ€è¦å¯¹å¤–æš´éœ²ã€‚</li></ol><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong><br>å¦‚æœä¸€ä¸ªç³»ç»Ÿçš„ç­–ç•¥å¤šäºå››ä¸ªï¼Œå°±éœ€è¦è€ƒè™‘ä½¿ç”¨æ··åˆæ¨¡å¼ï¼Œè§£å†³ç­–ç•¥ç±»è†¨èƒ€çš„é—®é¢˜</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * ç­–ç•¥æ¨¡å¼  -- strategy pattern</span><br><span class="line"> */</span><br><span class="line">interface Strategy</span><br><span class="line">&#123;</span><br><span class="line">public function do_method();</span><br><span class="line">&#125;</span><br><span class="line">class StrategyA implements Strategy</span><br><span class="line">&#123;</span><br><span class="line">public function do_method()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;this is strategy A&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class StrategyB implements Strategy</span><br><span class="line">&#123;</span><br><span class="line">public function do_method()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;this is strategy B&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class StrategyC implements Strategy</span><br><span class="line">&#123;</span><br><span class="line">public function do_method()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;this is strategy C&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Question</span><br><span class="line">&#123;</span><br><span class="line">private $_strategy;</span><br><span class="line">public function __construct($strategy)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_strategy = $strategy;</span><br><span class="line">&#125;</span><br><span class="line">public function handle()</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_strategy-&gt;do_method();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = new Question(new StrategyA());</span><br><span class="line">$a-&gt;handle();</span><br><span class="line">$b = new Question(new StrategyB());</span><br><span class="line">$b-&gt;handle();</span><br><span class="line">$c = new Question(new StrategyC());</span><br><span class="line">$c-&gt;handle();</span><br></pre></td></tr></table></figure><h3 id="æ¨¡æ¿æ¨¡å¼"><a href="#æ¨¡æ¿æ¨¡å¼" class="headerlink" title="æ¨¡æ¿æ¨¡å¼"></a>æ¨¡æ¿æ¨¡å¼</h3><blockquote><p>ä¸€äº›æ–¹æ³•é€šç”¨ï¼Œå´åœ¨æ¯ä¸€ä¸ªå­ç±»éƒ½é‡æ–°å†™äº†è¿™ä¸€æ–¹æ³•<br>å°†è¿™äº›é€šç”¨ç®—æ³•æŠ½è±¡å‡ºæ¥<br>åœ¨æŠ½è±¡ç±»å®ç°ï¼Œå…¶ä»–æ­¥éª¤åœ¨å­ç±»å®ç°<br><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li>å°è£…ä¸å˜éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ã€‚ </li><li>æå–å…¬å…±ä»£ç ï¼Œä¾¿äºç»´æŠ¤ã€‚ </li><li>è¡Œä¸ºç”±çˆ¶ç±»æ§åˆ¶ï¼Œå­ç±»å®ç°ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong><br>æ¯ä¸€ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦ä¸€ä¸ªå­ç±»æ¥å®ç°ï¼Œå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œä½¿å¾—ç³»ç»Ÿæ›´åŠ åºå¤§ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong><br>ä¸ºé˜²æ­¢æ¶æ„æ“ä½œï¼Œä¸€èˆ¬æ¨¡æ¿æ–¹æ³•éƒ½åŠ ä¸Š final å…³é”®è¯ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * æ¨¡æ¿æ¨¡å¼ -- template pattern</span><br><span class="line"> */</span><br><span class="line">abstract class Game</span><br><span class="line">&#123;</span><br><span class="line">abstract public function start();</span><br><span class="line">abstract public function end();</span><br><span class="line">public function action()</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;start();</span><br><span class="line">$this-&gt;end();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class SuperMary extends Game</span><br><span class="line">&#123;</span><br><span class="line">public function start()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;the game is starting&quot;;</span><br><span class="line">&#125;</span><br><span class="line">public function end()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;the game is ending&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$superMary = new SuperMary();</span><br><span class="line">$superMary-&gt;action();</span><br></pre></td></tr></table></figure><h3 id="è®¿é—®è€…æ¨¡å¼"><a href="#è®¿é—®è€…æ¨¡å¼" class="headerlink" title="è®¿é—®è€…æ¨¡å¼"></a>è®¿é—®è€…æ¨¡å¼</h3><blockquote><p>ä½¿ç”¨äº†ä¸€ä¸ªè®¿é—®è€…ç±»ï¼Œå®ƒæ”¹å˜äº†å…ƒç´ ç±»çš„æ‰§è¡Œç®—æ³•<br>å…ƒç´ çš„æ‰§è¡Œç®—æ³•å¯ä»¥éšç€è®¿é—®è€…æ”¹å˜è€Œæ”¹å˜<br>ç¨³å®šçš„æ•°æ®ç»“æ„å’Œæ˜“å˜çš„æ“ä½œè€¦åˆé—®é¢˜ã€‚<br>åœ¨æ•°æ®åŸºç¡€ç±»é‡Œé¢æœ‰ä¸€ä¸ªæ–¹æ³•æ¥å—è®¿é—®è€…ï¼Œå°†è‡ªèº«å¼•ç”¨ä¼ å…¥è®¿é—®è€…ã€‚<br><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li>ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚ </li><li>ä¼˜ç§€çš„æ‰©å±•æ€§ã€‚ </li><li>çµæ´»æ€§ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong></p><ol><li>å…·ä½“å…ƒç´ å¯¹è®¿é—®è€…å…¬å¸ƒç»†èŠ‚ï¼Œè¿åäº†è¿ªç±³ç‰¹åŸåˆ™ã€‚ </li><li>å…·ä½“å…ƒç´ å˜æ›´æ¯”è¾ƒå›°éš¾ã€‚ </li><li>è¿åäº†ä¾èµ–å€’ç½®åŸåˆ™ï¼Œä¾èµ–äº†å…·ä½“ç±»ï¼Œæ²¡æœ‰ä¾èµ–æŠ½è±¡ã€‚</li></ol><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong><br>è®¿é—®è€…å¯ä»¥å¯¹åŠŸèƒ½è¿›è¡Œç»Ÿä¸€ï¼Œå¯ä»¥åšæŠ¥è¡¨ã€UIã€æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">interface ComputerPart</span><br><span class="line">&#123;</span><br><span class="line">public function accept(Visitor $visitor);</span><br><span class="line">&#125;</span><br><span class="line">class Computer implements ComputerPart</span><br><span class="line">&#123;</span><br><span class="line">private $_computerPart = array();</span><br><span class="line">public function accept(Visitor $visitor)</span><br><span class="line">&#123;</span><br><span class="line">foreach($this-&gt;_computerPart as $val)&#123;</span><br><span class="line">$val-&gt;accept($visitor);</span><br><span class="line">&#125;</span><br><span class="line">$visitor-&gt;visit($this);</span><br><span class="line">&#125;</span><br><span class="line">public function getName()</span><br><span class="line">&#123;</span><br><span class="line">return &apos;computer&apos;;</span><br><span class="line">&#125;</span><br><span class="line">public function setAttach(ComputerPart $computerPart)</span><br><span class="line">&#123;</span><br><span class="line">array_push($this-&gt;_computerPart, $computerPart);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class Mouse implements ComputerPart</span><br><span class="line">&#123;</span><br><span class="line">public function accept(Visitor $visitor)</span><br><span class="line">&#123;</span><br><span class="line">$visitor-&gt;visit($this);</span><br><span class="line">&#125;</span><br><span class="line">public function getName()</span><br><span class="line">&#123;</span><br><span class="line">return &apos;mouse&apos;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class KeyBoard implements ComputerPart</span><br><span class="line">&#123;</span><br><span class="line">public function accept(Visitor $visitor)</span><br><span class="line">&#123;</span><br><span class="line">$visitor-&gt;visit($this);</span><br><span class="line">&#125;</span><br><span class="line">public function getName()</span><br><span class="line">&#123;</span><br><span class="line">return &apos;keyboard&apos;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class Visitor</span><br><span class="line">&#123;</span><br><span class="line">public function visit(ComputerPart $computerPart)</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;this is &quot;.$computerPart-&gt;getName();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$computer = new Computer();</span><br><span class="line">$computer-&gt;setAttach(new Mouse());</span><br><span class="line">$computer-&gt;setAttach(new KeyBoard());</span><br><span class="line">$computer-&gt;accept(new Visitor());</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;è´£ä»»é“¾æ¨¡å¼&quot;&gt;&lt;a href=&quot;#è´£ä»»é“¾æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;è´£ä»»é“¾æ¨¡å¼&quot;&gt;&lt;/a&gt;è´£ä»»é“¾æ¨¡å¼&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;ä¸ºè¯·æ±‚åˆ›å»ºäº†ä¸€ä¸ªæ¥æ”¶è€…å¯¹è±¡çš„é“¾&lt;br&gt;è¿™ç§æ¨¡å¼ç»™äºˆè¯·æ±‚çš„ç±»å‹ï¼Œå¯¹è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…è¿›è¡Œè§£
      
    
    </summary>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://zhipenwang.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://zhipenwang.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>PHPè®¾è®¡æ¨¡å¼ä¹‹ç»“æ„å‹æ¨¡å¼ï¼ˆstructural patternsï¼‰</title>
    <link href="https://zhipenwang.github.io/2018/06/17/structrual_patterns/"/>
    <id>https://zhipenwang.github.io/2018/06/17/structrual_patterns/</id>
    <published>2018-06-17T12:21:01.000Z</published>
    <updated>2019-04-09T14:57:32.979Z</updated>
    
    <content type="html"><![CDATA[<h3 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h3><blockquote><p>æ¶‰åŠåˆ°ä¸€ä¸ªå•ä¸€çš„ç±»ï¼Œè¯¥ç±»è´Ÿè´£åŠ å…¥ç‹¬ç«‹çš„æˆ–ä¸å…¼å®¹çš„æ¥å£åŠŸèƒ½ã€‚<br>é€‚é…å™¨ç»§æ‰¿æˆ–ä¾èµ–å·²æœ‰çš„å¯¹è±¡ï¼Œå®ç°æƒ³è¦çš„ç›®æ ‡æ¥å£ã€‚<br><strong>ä¼˜ç‚¹ï¼š</strong>  </p><ol><li>å¯ä»¥è®©ä»»ä½•ä¸¤ä¸ªæ²¡æœ‰å…³è”çš„ç±»ä¸€èµ·è¿è¡Œã€‚  </li><li>æé«˜äº†ç±»çš„å¤ç”¨ã€‚  </li><li>å¢åŠ äº†ç±»çš„é€æ˜åº¦ã€‚  </li><li>çµæ´»æ€§å¥½ã€‚  </li></ol><p><strong>ç¼ºç‚¹ï¼š</strong></p><ol><li>è¿‡å¤šä½¿ç”¨é€‚é…å™¨ä¼šè®©ç³»ç»Ÿå‡Œä¹±ï¼Œä¸æ˜“æ•´ä½“æŠŠæ¡ï¼Œæ²¡æœ‰å¿…è¦ï¼Œä¸å»ºè®®ä½¿ç”¨é€‚é…å™¨æ¨¡å¼  </li></ol><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong><br>é€‚é…å™¨ä¸æ˜¯åœ¨è¯¦ç»†è®¾è®¡æ—¶ä½¿ç”¨çš„ï¼Œè€Œæ˜¯åœ¨è§£å†³æ­£åœ¨æœå½¹çš„é¡¹ç›®ä½¿ç”¨çš„</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * adapter pattern  é€‚é…å™¨æ¨¡å¼</span><br><span class="line"> */</span><br><span class="line">// å¯¹è±¡é€‚é…å™¨</span><br><span class="line">// å®šä¹‰æ¥å£</span><br><span class="line">interface target</span><br><span class="line">&#123;</span><br><span class="line">public function echoSample1();</span><br><span class="line">public function echoSample2();</span><br><span class="line">&#125;</span><br><span class="line">class adapterOne implements target</span><br><span class="line">&#123;</span><br><span class="line">public function echoSample1()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;+++++&quot;;</span><br><span class="line">&#125;</span><br><span class="line">public function echoSample2()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class adapterTwo implements target</span><br><span class="line">&#123;</span><br><span class="line">private $adapterOne;</span><br><span class="line">public function __construct(adapterOne $obj)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;adapterOne = $obj;</span><br><span class="line">&#125;</span><br><span class="line">public function echoSample1()</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;adapterOne-&gt;echoSample1();</span><br><span class="line">&#125;</span><br><span class="line">public function echoSample2()</span><br><span class="line">&#123;</span><br><span class="line">echo &apos;----&apos;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$adapterTwo = new adapterTwo(new adapterOne);</span><br><span class="line">$adapterTwo-&gt;echoSample1();</span><br><span class="line">$adapterTwo-&gt;echoSample2();</span><br><span class="line"></span><br><span class="line">// ç±»é€‚é…å™¨</span><br><span class="line">interface target2</span><br><span class="line">&#123;</span><br><span class="line">public function echoSample1();</span><br><span class="line">public function echoSample2();</span><br><span class="line">&#125;</span><br><span class="line">class adapterClassOne</span><br><span class="line">&#123;</span><br><span class="line">public function echoSample1()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;****&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class adapterClassTwo extends adapterClassOne implements target2</span><br><span class="line">&#123;</span><br><span class="line">public function echoSample2()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;&amp;&amp;&amp;&amp;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$adapterClassTwo = new adapterClassTwo();</span><br><span class="line">$adapterClassTwo-&gt;echoSample1();</span><br><span class="line">$adapterClassTwo-&gt;echoSample2();</span><br></pre></td></tr></table></figure><h3 id="æ¡¥æ¥æ¨¡å¼"><a href="#æ¡¥æ¥æ¨¡å¼" class="headerlink" title="æ¡¥æ¥æ¨¡å¼"></a>æ¡¥æ¥æ¨¡å¼</h3><blockquote><p>æŠŠæŠ½è±¡åŒ–ä¸å®ç°åŒ–è§£è€¦ï¼Œä½¿å¾—äºŒè€…å¯ä»¥ç‹¬ç«‹å˜åŒ–<br>æŠ½è±¡ç±»ä¾èµ–å®ç°ç±»ã€‚<br><strong>ä¼˜ç‚¹ï¼š</strong>  </p><ol><li>æŠ½è±¡å’Œå®ç°çš„åˆ†ç¦»ã€‚ </li><li>ä¼˜ç§€çš„æ‰©å±•èƒ½åŠ›ã€‚ </li><li>å®ç°ç»†èŠ‚å¯¹å®¢æˆ·é€æ˜ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong><br>æ¡¥æ¥æ¨¡å¼çš„å¼•å…¥ä¼šå¢åŠ ç³»ç»Ÿçš„ç†è§£ä¸è®¾è®¡éš¾åº¦ï¼Œç”±äºèšåˆå…³è”å…³ç³»å»ºç«‹åœ¨æŠ½è±¡å±‚ï¼Œè¦æ±‚å¼€å‘è€…é’ˆå¯¹æŠ½è±¡è¿›è¡Œè®¾è®¡ä¸ç¼–ç¨‹ã€‚<br><strong>æ³¨æ„äº‹é¡¹ï¼š</strong><br>å¯¹äºä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œä½¿ç”¨æ¡¥æ¥æ¨¡å¼å†é€‚åˆä¸è¿‡äº†ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * æ¡¥æ¥æ¨¡å¼ -- bridge pattern</span><br><span class="line"> */</span><br><span class="line">// å®šä¹‰æ¥å£--å¯¹è±¡</span><br><span class="line">interface DrawApi</span><br><span class="line">&#123;</span><br><span class="line">public function draw();</span><br><span class="line">&#125;</span><br><span class="line">class RedColor implements DrawApi</span><br><span class="line">&#123;</span><br><span class="line">public function draw()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;red color&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class GreenColor implements DrawApi</span><br><span class="line">&#123;</span><br><span class="line">public function draw()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;green color&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">// å®šä¹‰æŠ½è±¡ç±»</span><br><span class="line">abstract class Shape</span><br><span class="line">&#123;</span><br><span class="line">abstract public function draw();</span><br><span class="line">&#125;</span><br><span class="line">class Circle extends Shape</span><br><span class="line">&#123;</span><br><span class="line">private $drawApi;</span><br><span class="line">public function __construct(DrawApi $obj)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;drawApi = $obj;</span><br><span class="line">&#125;</span><br><span class="line">public function draw()</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;drawApi-&gt;draw();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$obj = new Circle(new RedColor());</span><br><span class="line">$obj-&gt;draw();</span><br><span class="line">$obj2 = new Circle(new GreenColor());</span><br><span class="line">$obj2-&gt;draw();</span><br></pre></td></tr></table></figure><h3 id="è¿‡æ»¤å™¨æ¨¡å¼"><a href="#è¿‡æ»¤å™¨æ¨¡å¼" class="headerlink" title="è¿‡æ»¤å™¨æ¨¡å¼"></a>è¿‡æ»¤å™¨æ¨¡å¼</h3><blockquote><p>ä½¿ç”¨ä¸åŒçš„æ ‡å‡†æ¥è¿‡æ»¤ä¸€ç»„å¯¹è±¡ï¼Œé€šè¿‡é€»è¾‘è¿ç®—ä»¥è§£è€¦çš„æ–¹å¼æŠŠå®ƒä»¬è¿æ¥èµ·æ¥</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * è¿‡æ»¤å™¨æ¨¡å¼ -- filter pattern</span><br><span class="line"> */</span><br><span class="line">// å®šä¹‰æ¥å£</span><br><span class="line">interface Shape</span><br><span class="line">&#123;</span><br><span class="line">public function arrayPrint(array $arr);</span><br><span class="line">&#125;</span><br><span class="line">class One implements Shape</span><br><span class="line">&#123;</span><br><span class="line">public function arrayPrint(array $arr)</span><br><span class="line">&#123;</span><br><span class="line">$array = array();</span><br><span class="line">foreach($arr as $v)&#123;</span><br><span class="line">if($v-&gt;getName() == &apos;one&apos;)&#123;</span><br><span class="line">$array[] = $v;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return $array;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class Two implements Shape</span><br><span class="line">&#123;</span><br><span class="line">public function arrayPrint(array $arr)</span><br><span class="line">&#123;</span><br><span class="line">$array = array();</span><br><span class="line">foreach($arr as $v)&#123;</span><br><span class="line">if($v-&gt;getName() == &apos;two&apos;)&#123;</span><br><span class="line">$array[] = $v;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return $array;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class Three implements Shape</span><br><span class="line">&#123;</span><br><span class="line">public function arrayPrint(array $arr)</span><br><span class="line">&#123;</span><br><span class="line">$array = array();</span><br><span class="line">foreach($arr as $v)&#123;</span><br><span class="line">if($v-&gt;getID() == &apos;2&apos;)&#123;</span><br><span class="line">$array[] = $v;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return $array;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å®šä¹‰æ ‡å‡†ç±»</span><br><span class="line">class Data</span><br><span class="line">&#123;</span><br><span class="line">private $id;</span><br><span class="line">private $name;</span><br><span class="line">public function __construct($id, $name)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;id = $id;</span><br><span class="line">$this-&gt;name = $name;</span><br><span class="line">&#125;</span><br><span class="line">public function getID()</span><br><span class="line">&#123;</span><br><span class="line">return $this-&gt;id;</span><br><span class="line">&#125;</span><br><span class="line">public function getName()</span><br><span class="line">&#123;</span><br><span class="line">return $this-&gt;name;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$array = array();</span><br><span class="line">$array[] = new Data(&apos;1&apos;, &apos;one&apos;);</span><br><span class="line">$array[] = new Data(&apos;2&apos;, &apos;one&apos;);</span><br><span class="line">$array[] = new Data(&apos;3&apos;, &apos;two&apos;);</span><br><span class="line">$array[] = new Data(&apos;4&apos;, &apos;three&apos;);</span><br><span class="line"></span><br><span class="line">$one = new One();</span><br><span class="line">arrayPrint($one-&gt;arrayPrint($array));</span><br><span class="line">$two = new Two();</span><br><span class="line">arrayPrint($two-&gt;arrayPrint($array));</span><br><span class="line"></span><br><span class="line">$three = new Three();</span><br><span class="line">arrayPrint($three-&gt;arrayPrint($one-&gt;arrayPrint($array)));</span><br><span class="line"></span><br><span class="line">function arrayPrint($arr)</span><br><span class="line">&#123;</span><br><span class="line">foreach($arr as $v)&#123;</span><br><span class="line">echo $v-&gt;getID();</span><br><span class="line">echo $v-&gt;getName();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»„åˆæ¨¡å¼"><a href="#ç»„åˆæ¨¡å¼" class="headerlink" title="ç»„åˆæ¨¡å¼"></a>ç»„åˆæ¨¡å¼</h3><blockquote><p>ä¸€ç»„ç›¸ä¼¼çš„å¯¹è±¡å½“ä½œä¸€ä¸ªå•ä¸€çš„å¯¹è±¡<br>ç»„åˆæ¨¡å¼ä¾æ®æ ‘å½¢ç»“æ„æ¥ç»„åˆå¯¹è±¡ï¼Œç”¨æ¥è¡¨ç¤ºéƒ¨åˆ†ä»¥åŠæ•´ä½“å±‚æ¬¡<br><strong>æ„å›¾ï¼š</strong><br>å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€éƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ã€‚ç»„åˆæ¨¡å¼ä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚<br><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li>é«˜å±‚æ¨¡å—è°ƒç”¨ç®€å•ã€‚</li><li>èŠ‚ç‚¹è‡ªç”±å¢åŠ ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong><br>åœ¨ä½¿ç”¨ç»„åˆæ¨¡å¼æ—¶ï¼Œå…¶å¶å­å’Œæ ‘æçš„å£°æ˜éƒ½æ˜¯å®ç°ç±»ï¼Œè€Œä¸æ˜¯æ¥å£ï¼Œè¿åäº†ä¾èµ–å€’ç½®åŸåˆ™ã€‚<br><strong>æ³¨æ„äº‹é¡¹ï¼š</strong><br>å®šä¹‰æ—¶ä¸ºå…·ä½“ç±»ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * ç»„åˆæ¨¡å¼  -- composite pattern</span><br><span class="line"> */</span><br><span class="line">interface Shape</span><br><span class="line">&#123;</span><br><span class="line">public function add($obj);</span><br><span class="line">public function remove($obj);</span><br><span class="line">public function operator();</span><br><span class="line">&#125;</span><br><span class="line">class Composite implements Shape</span><br><span class="line">&#123;</span><br><span class="line">private $_composite;</span><br><span class="line">public function __construct()</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_composite = array();</span><br><span class="line">&#125;</span><br><span class="line">public function operator()</span><br><span class="line">&#123;</span><br><span class="line">foreach($this-&gt;_composite as $v)&#123;</span><br><span class="line">$v-&gt;operator();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">public function add($obj)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_composite[] = $obj;</span><br><span class="line">&#125;</span><br><span class="line">public function remove($obj)</span><br><span class="line">&#123;</span><br><span class="line">foreach($this-&gt;_composite as $k=&gt;$v)&#123;</span><br><span class="line">if($obj == $v)&#123;</span><br><span class="line">unset($this-&gt;_composite[$k]);</span><br><span class="line">return true;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return false;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Leaf implements Shape</span><br><span class="line">&#123;</span><br><span class="line">private $_name;</span><br><span class="line">public function __construct($name)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_name = $name;</span><br><span class="line">&#125;</span><br><span class="line">public function add($obj)&#123;&#125;</span><br><span class="line">public function remove($obj)&#123;&#125;</span><br><span class="line">public function operator()</span><br><span class="line">&#123;</span><br><span class="line">echo $this-&gt;_name;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$leaf1 = new Leaf(&apos;one&apos;);</span><br><span class="line">$leaf2 = new Leaf(&apos;two&apos;);</span><br><span class="line">$composite = new Composite();</span><br><span class="line">$composite-&gt;add($leaf1);</span><br><span class="line">$composite-&gt;add($leaf2);</span><br><span class="line">$composite-&gt;operator();</span><br><span class="line">$composite-&gt;remove($leaf1);</span><br><span class="line">$composite-&gt;operator();</span><br></pre></td></tr></table></figure><h3 id="è£…é¥°å™¨æ¨¡å¼"><a href="#è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="è£…é¥°å™¨æ¨¡å¼"></a>è£…é¥°å™¨æ¨¡å¼</h3><blockquote><p>å…è®¸å‘ä¸€ä¸ªç°æœ‰çš„å¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ï¼ŒåŒæ—¶åˆä¸æ”¹å˜å…¶ç»“æ„<br><strong>ä¼˜ç‚¹ï¼š</strong><br>è£…é¥°ç±»å’Œè¢«è£…é¥°ç±»å¯ä»¥ç‹¬ç«‹å‘å±•ï¼Œä¸ä¼šç›¸äº’è€¦åˆï¼Œè£…é¥°æ¨¡å¼æ˜¯ç»§æ‰¿çš„ä¸€ä¸ªæ›¿ä»£æ¨¡å¼ï¼Œè£…é¥°æ¨¡å¼å¯ä»¥åŠ¨æ€æ‰©å±•ä¸€ä¸ªå®ç°ç±»çš„åŠŸèƒ½ã€‚<br><strong>ç¼ºç‚¹ï¼š</strong><br>å¤šå±‚è£…é¥°æ¯”è¾ƒå¤æ‚ã€‚<br><strong>æ³¨æ„äº‹é¡¹ï¼š</strong><br>å¯ä»£æ›¿ç»§æ‰¿ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * è£…é¥°å™¨æ¨¡å¼  -- decorator pattern</span><br><span class="line"> */</span><br><span class="line">// å®šä¹‰æ¥å£</span><br><span class="line">interface Shape</span><br><span class="line">&#123;</span><br><span class="line">public function draw();</span><br><span class="line">&#125;</span><br><span class="line">class Decorator implements Shape</span><br><span class="line">&#123;</span><br><span class="line">private $_decorator;</span><br><span class="line">public function __construct(Shape $decorator)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_decorator = $decorator;</span><br><span class="line">&#125;</span><br><span class="line">public function draw()</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_decorator-&gt;draw();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class RedColor extends Decorator</span><br><span class="line">&#123;</span><br><span class="line">public function __construct(Shape $decorator)</span><br><span class="line">&#123;</span><br><span class="line">parent::__construct($decorator);</span><br><span class="line">&#125;</span><br><span class="line">public function draw()</span><br><span class="line">&#123;</span><br><span class="line">parent::draw();</span><br><span class="line">$this-&gt;echoDraw();</span><br><span class="line">&#125;</span><br><span class="line">public function echoDraw()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;red color&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class GreenColor extends Decorator</span><br><span class="line">&#123;</span><br><span class="line">public function __construct(Shape $decorator)</span><br><span class="line">&#123;</span><br><span class="line">parent::__construct($decorator);</span><br><span class="line">&#125;</span><br><span class="line">public function draw()</span><br><span class="line">&#123;</span><br><span class="line">parent::draw();</span><br><span class="line">$this-&gt;echoDraw();</span><br><span class="line">&#125;</span><br><span class="line">public function echoDraw()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;green color&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class Color implements Shape</span><br><span class="line">&#123;</span><br><span class="line">public function draw()&#123;</span><br><span class="line">echo &quot;color&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj = new Color();</span><br><span class="line">$obj_red = new RedColor($obj);</span><br><span class="line">$obj_green = new GreenColor($obj_red);</span><br><span class="line">$obj_red-&gt;draw();</span><br><span class="line">$obj_green-&gt;draw();</span><br></pre></td></tr></table></figure><h3 id="å¤–è§‚æ¨¡å¼"><a href="#å¤–è§‚æ¨¡å¼" class="headerlink" title="å¤–è§‚æ¨¡å¼"></a>å¤–è§‚æ¨¡å¼</h3><blockquote><p>éšè—ç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œå¹¶å‘å®¢æˆ·ç«¯æä¾›äº†ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥è®¿é—®ç³»ç»Ÿçš„æ¥å£<br>åœ¨å®¢æˆ·ç«¯å’Œå¤æ‚ç³»ç»Ÿä¹‹é—´å†åŠ ä¸€å±‚ï¼Œè¿™ä¸€å±‚å°†è°ƒç”¨é¡ºåºã€ä¾èµ–å…³ç³»ç­‰å¤„ç†å¥½ã€‚<br><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li>å‡å°‘ç³»ç»Ÿç›¸äº’ä¾èµ–ã€‚ </li><li>æé«˜çµæ´»æ€§ã€‚ </li><li>æé«˜äº†å®‰å…¨æ€§ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong><br>ä¸ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œå¦‚æœè¦æ”¹ä¸œè¥¿å¾ˆéº»çƒ¦ï¼Œç»§æ‰¿é‡å†™éƒ½ä¸åˆé€‚ã€‚<br><strong>æ³¨æ„äº‹é¡¹ï¼š</strong><br>åœ¨å±‚æ¬¡åŒ–ç»“æ„ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤–è§‚æ¨¡å¼å®šä¹‰ç³»ç»Ÿä¸­æ¯ä¸€å±‚çš„å…¥å£ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * é—¨é¢æ¨¡å¼/å¤–è§‚æ¨¡å¼  -- facade pattern</span><br><span class="line"> */</span><br><span class="line">//å®šä¹‰æ¥å£</span><br><span class="line">interface Shape</span><br><span class="line">&#123;</span><br><span class="line">public function draw();</span><br><span class="line">&#125;</span><br><span class="line">class Red implements Shape</span><br><span class="line">&#123;</span><br><span class="line">public function draw()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;red&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class Green implements Shape</span><br><span class="line">&#123;</span><br><span class="line">public function draw()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;green&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class Demo</span><br><span class="line">&#123;</span><br><span class="line">private $_red;</span><br><span class="line">private $_green;</span><br><span class="line">public function __construct()</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_red = new Red();</span><br><span class="line">$this-&gt;_green = new Green();</span><br><span class="line">&#125;</span><br><span class="line">public function draw()</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_red-&gt;draw();</span><br><span class="line">$this-&gt;_green-&gt;draw();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj = new Demo();</span><br><span class="line">$obj-&gt;draw();</span><br></pre></td></tr></table></figure><h3 id="äº«å…ƒæ¨¡å¼"><a href="#äº«å…ƒæ¨¡å¼" class="headerlink" title="äº«å…ƒæ¨¡å¼"></a>äº«å…ƒæ¨¡å¼</h3><blockquote><p>å‡å°‘åˆ›å»ºå¯¹è±¡çš„æ•°é‡ï¼Œä»¥å‡å°‘å†…å­˜å ç”¨å’Œæé«˜æ€§èƒ½<br>ç”¨ HashMap å­˜å‚¨è¿™äº›å¯¹è±¡ã€‚<br><strong>ä¼˜ç‚¹ï¼š</strong><br>å¤§å¤§å‡å°‘å¯¹è±¡çš„åˆ›å»ºï¼Œé™ä½ç³»ç»Ÿçš„å†…å­˜ï¼Œä½¿æ•ˆç‡æé«˜ã€‚<br><strong>ç¼ºç‚¹ï¼š</strong><br>æé«˜äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œéœ€è¦åˆ†ç¦»å‡ºå¤–éƒ¨çŠ¶æ€å’Œå†…éƒ¨çŠ¶æ€ï¼Œè€Œä¸”å¤–éƒ¨çŠ¶æ€å…·æœ‰å›ºæœ‰åŒ–çš„æ€§è´¨ï¼Œä¸åº”è¯¥éšç€å†…éƒ¨çŠ¶æ€çš„å˜åŒ–è€Œå˜åŒ–ï¼Œå¦åˆ™ä¼šé€ æˆç³»ç»Ÿçš„æ··ä¹±ã€‚<br><strong>æ³¨æ„äº‹é¡¹ï¼š</strong>  </p><ol><li>æ³¨æ„åˆ’åˆ†å¤–éƒ¨çŠ¶æ€å’Œå†…éƒ¨çŠ¶æ€ï¼Œå¦åˆ™å¯èƒ½ä¼šå¼•èµ·çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ </li><li>è¿™äº›ç±»å¿…é¡»æœ‰ä¸€ä¸ªå·¥å‚å¯¹è±¡åŠ ä»¥æ§åˆ¶</li></ol></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * äº«å…ƒæ¨¡å¼  -- flyweight pattern</span><br><span class="line"> */</span><br><span class="line">abstract class Resource</span><br><span class="line">&#123;</span><br><span class="line">private $_resource = null;</span><br><span class="line">abstract public function operator();</span><br><span class="line">&#125;</span><br><span class="line">class UnShare extends Resource</span><br><span class="line">&#123;</span><br><span class="line">public function __construct($str)</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;_resource = $str;</span><br><span class="line">&#125;</span><br><span class="line">public function operator()</span><br><span class="line">&#123;</span><br><span class="line">echo $this-&gt;_resource;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class Share extends Resource</span><br><span class="line">&#123;</span><br><span class="line">private $_resources = array();</span><br><span class="line">public function setResource($str)</span><br><span class="line">&#123;</span><br><span class="line">if(isset($this-&gt;_resources[$str]))&#123;</span><br><span class="line">return $this-&gt;_resources[$str];</span><br><span class="line">&#125;else&#123;</span><br><span class="line">return $this-&gt;_resources[$str] = $str;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">public function operator()</span><br><span class="line">&#123;</span><br><span class="line">foreach($this-&gt;_resources as $key=&gt;$val)&#123;</span><br><span class="line">echo $key . &apos;=&gt;&apos; . $val;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj = new Share();</span><br><span class="line">$obj-&gt;setResource(&apos;a&apos;);</span><br><span class="line">$obj-&gt;operator();</span><br><span class="line">$obj-&gt;setResource(&apos;b&apos;);</span><br><span class="line">$obj-&gt;operator();</span><br><span class="line">$objUnShare = new UnShare(&apos;A&apos;);</span><br><span class="line">$objUnShare-&gt;operator();</span><br><span class="line">$objUnShare = new UnShare(&apos;B&apos;);</span><br><span class="line">$objUnShare-&gt;operator();</span><br></pre></td></tr></table></figure><h3 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h3><blockquote><p>ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚<br>å®ç°ä¸è¢«ä»£ç†ç±»ç»„åˆã€‚<br><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li>èŒè´£æ¸…æ™°ã€‚ </li><li>é«˜æ‰©å±•æ€§ã€‚ </li><li>æ™ºèƒ½åŒ–ã€‚  </li></ol><p><strong>ç¼ºç‚¹ï¼š</strong> </p><ol><li>ç”±äºåœ¨å®¢æˆ·ç«¯å’ŒçœŸå®ä¸»é¢˜ä¹‹é—´å¢åŠ äº†ä»£ç†å¯¹è±¡ï¼Œå› æ­¤æœ‰äº›ç±»å‹çš„ä»£ç†æ¨¡å¼å¯èƒ½ä¼šé€ æˆè¯·æ±‚çš„å¤„ç†é€Ÿåº¦å˜æ…¢ã€‚</li><li>å®ç°ä»£ç†æ¨¡å¼éœ€è¦é¢å¤–çš„å·¥ä½œï¼Œæœ‰äº›ä»£ç†æ¨¡å¼çš„å®ç°éå¸¸å¤æ‚ã€‚</li></ol><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> </p><ol><li>å’Œé€‚é…å™¨æ¨¡å¼çš„åŒºåˆ«ï¼šé€‚é…å™¨æ¨¡å¼ä¸»è¦æ”¹å˜æ‰€è€ƒè™‘å¯¹è±¡çš„æ¥å£ï¼Œè€Œä»£ç†æ¨¡å¼ä¸èƒ½æ”¹å˜æ‰€ä»£ç†ç±»çš„æ¥å£ã€‚ </li><li>å’Œè£…é¥°å™¨æ¨¡å¼çš„åŒºåˆ«ï¼šè£…é¥°å™¨æ¨¡å¼ä¸ºäº†å¢å¼ºåŠŸèƒ½ï¼Œè€Œä»£ç†æ¨¡å¼æ˜¯ä¸ºäº†åŠ ä»¥æ§åˆ¶ã€‚</li></ol></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * ä»£ç†æ¨¡å¼  -- proxy pattern</span><br><span class="line"> */</span><br><span class="line">abstract class Subject</span><br><span class="line">&#123;</span><br><span class="line">abstract public function draw();</span><br><span class="line">&#125;</span><br><span class="line">class RealSubject extends Subject</span><br><span class="line">&#123;</span><br><span class="line">public function draw()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;real subject&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class ProxySubject extends Subject</span><br><span class="line">&#123;</span><br><span class="line">private $_subject = null;</span><br><span class="line">public function draw()</span><br><span class="line">&#123;</span><br><span class="line">$this-&gt;before();</span><br><span class="line">if(is_null($this-&gt;_subject))&#123;</span><br><span class="line">$this-&gt;_subject = new RealSubject();</span><br><span class="line">&#125;</span><br><span class="line">$this-&gt;_subject-&gt;draw();</span><br><span class="line">$this-&gt;after();</span><br><span class="line">&#125;</span><br><span class="line">public function before()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;before&quot;;</span><br><span class="line">&#125;</span><br><span class="line">public function after()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;after&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj = new ProxySubject();</span><br><span class="line">$obj-&gt;draw();</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;é€‚é…å™¨æ¨¡å¼&quot;&gt;&lt;a href=&quot;#é€‚é…å™¨æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;é€‚é…å™¨æ¨¡å¼&quot;&gt;&lt;/a&gt;é€‚é…å™¨æ¨¡å¼&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;æ¶‰åŠåˆ°ä¸€ä¸ªå•ä¸€çš„ç±»ï¼Œè¯¥ç±»è´Ÿè´£åŠ å…¥ç‹¬ç«‹çš„æˆ–ä¸å…¼å®¹çš„æ¥å£åŠŸèƒ½ã€‚&lt;br&gt;é€‚é…å™¨ç»§æ‰¿æˆ–ä¾èµ–å·²æœ‰çš„å¯¹
      
    
    </summary>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://zhipenwang.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://zhipenwang.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>PHPè®¾è®¡æ¨¡å¼ä¹‹åˆ›å»ºå‹æ¨¡å¼ï¼ˆcreational patternsï¼‰</title>
    <link href="https://zhipenwang.github.io/2018/06/16/creational_patterns/"/>
    <id>https://zhipenwang.github.io/2018/06/16/creational_patterns/</id>
    <published>2018-06-16T12:21:01.000Z</published>
    <updated>2019-04-09T14:57:32.967Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h3><blockquote><p>å®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å…¶å­ç±»å†³å®šå»å®ä¾‹åŒ–å“ªä¸€ä¸ªå·¥å‚ç±»<br>åˆ›å»ºçš„è¿‡ç¨‹æ˜¯åœ¨å­ç±»ä¸­æ‰§è¡Œ<br><strong>ä¼˜ç‚¹</strong>ï¼š  </p><ol><li>è°ƒç”¨è€…æƒ³åˆ›å»ºä¸€ä¸ªå¯¹è±¡åªéœ€è¦çŸ¥é“åç§°å³å¯  </li><li>æ‰©å±•æ€§é«˜ï¼Œæƒ³å¢åŠ ä¸€ä¸ªäº§å“ï¼Œåªéœ€è¦æ‰©å±•ä¸€ä¸ªå·¥å‚ç±»å°±å¯ä»¥  </li><li>å±è”½äº§å“å…·ä½“å®ç°ï¼Œè°ƒç”¨è€…åªå…³å¿ƒäº§å“çš„æ¥å£  </li></ol><p><strong>ç¼ºç‚¹</strong>ï¼š  </p><ol><li>æ¯å¢åŠ ä¸€ä¸ªäº§å“ï¼Œéƒ½éœ€è¦å¢åŠ ä¸€ä¸ªå…·ä½“ç±»å’Œå¯¹è±¡å®ç°å·¥å‚ï¼Œä½¿å¾—ç³»ç»Ÿç±»çš„ä¸ªæ•°æˆå€å¢åŠ ï¼Œä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿå¤æ‚åº¦ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†ç³»ç»Ÿå…·ä½“ç±»çš„ä¾èµ–</li></ol></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">/*** ------------å·¥å‚æ¨¡å¼  factory-----------------------  ***/</span><br><span class="line"></span><br><span class="line">class DB</span><br><span class="line">&#123;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo get_class();</span><br><span class="line">    &#125;</span><br><span class="line">    public function die()</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Mysql extends DB&#123;&#125;</span><br><span class="line">class SqlSrv extends DB&#123;&#125;</span><br><span class="line">class Odbc extends DB&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">interface TestFactory</span><br><span class="line">&#123;</span><br><span class="line">    public function toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Factory implements TestFactory</span><br><span class="line">&#123;</span><br><span class="line">    public function toString()&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    public function do($type)</span><br><span class="line">    &#123;</span><br><span class="line">        switch($type)&#123;</span><br><span class="line">            case &apos;Mysql&apos;:</span><br><span class="line">                return new Mysql();</span><br><span class="line">            case &apos;SqlSrv&apos;:</span><br><span class="line">                return new SqlSrv();</span><br><span class="line">            case &apos;Odbc&apos;:</span><br><span class="line">                return new Odbc();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$test = new Factory();</span><br><span class="line">$test-&gt;do(&apos;Mysql&apos;);</span><br><span class="line">$test-&gt;do(&apos;SqlSrv&apos;);</span><br><span class="line">$test-&gt;do(&apos;Odbc&apos;);</span><br></pre></td></tr></table></figure><h3 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h3><blockquote><p>å›´ç»•ä¸€ä¸ªè¶…çº§å·¥å‚åˆ›å»ºå…¶ä»–å·¥å‚ï¼Œè¯¥è¶…çº§å·¥å‚æ˜¯å…¶ä»–å·¥å‚çš„å·¥å‚<br>ä¸€ä¸ªå·¥å‚ä¸­èšåˆå¤šä¸ªåŒç±»äº§å“<br><strong>ä¼˜ç‚¹</strong>ï¼š<br>    å½“ä¸€ä¸ªäº§å“æ—ä¸­çš„å¤šä¸ªå¯¹è±¡è¢«è®¾è®¡æˆä¸€èµ·å·¥ä½œæ—¶ï¼Œå®ƒèƒ½ä¿è¯å®¢æˆ·ç«¯å§‹ç»ˆåªä½¿ç”¨åŒä¸€ä¸ªäº§å“æ—ä¸­çš„å¯¹è±¡ã€‚<br><strong>ç¼ºç‚¹</strong>ï¼š<br>    äº§å“æ—æ‰©å±•éå¸¸å›°éš¾ï¼Œè¦å¢åŠ ä¸€ä¸ªç³»åˆ—çš„æŸä¸€äº§å“ï¼Œæ—¢è¦åœ¨æŠ½è±¡çš„ Creator é‡ŒåŠ ä»£ç ï¼Œåˆè¦åœ¨å…·ä½“çš„é‡Œé¢åŠ ä»£ç ã€‚<br><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š<br>    äº§å“æ—éš¾æ‰©å±•ï¼Œäº§å“ç­‰çº§æ˜“æ‰©å±•ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">/*** ------------æŠ½è±¡å·¥å‚æ¨¡å¼  abstract factory-----------------------  ***/</span><br><span class="line">class Cache&#123;&#125;</span><br><span class="line">class CacheDie&#123;&#125;</span><br><span class="line">class FileCache extends Cache</span><br><span class="line">&#123;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;filecache&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class RedisCache extends Cache&#123;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;rediscache&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class FileCacheDie extends CacheDie</span><br><span class="line">&#123;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;FileCacheDie&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class RedisCacheDie extends CacheDie</span><br><span class="line">&#123;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;RedisCacheDie&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class CacheAbstractFactory</span><br><span class="line">&#123;</span><br><span class="line">    public function createCache($type)&#123;</span><br><span class="line">        switch ($type) &#123;</span><br><span class="line">            case &apos;file&apos;:</span><br><span class="line">                return new FileCache();</span><br><span class="line">            case &apos;redis&apos;:</span><br><span class="line">                return new RedisCache();</span><br><span class="line">            default:</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class CacheDieAbstractFactory</span><br><span class="line">&#123;</span><br><span class="line">    public function createCache($type)&#123;</span><br><span class="line">        switch ($type) &#123;</span><br><span class="line">            case &apos;file&apos;:</span><br><span class="line">                return new FileCacheDie();</span><br><span class="line">            case &apos;redis&apos;:</span><br><span class="line">                return new RedisCacheDie();</span><br><span class="line">            default:</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class TestAbstractFactory</span><br><span class="line">&#123;</span><br><span class="line">    public function createType($type)</span><br><span class="line">    &#123;</span><br><span class="line">        switch ($type) &#123;</span><br><span class="line">            case &apos;cache&apos;:</span><br><span class="line">                return new CacheAbstractFactory();</span><br><span class="line">            case &apos;cacheDie&apos;:</span><br><span class="line">                return new CacheDieAbstractFactory();</span><br><span class="line">            default:</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$testAbstractFactory = new TestAbstractFactory();</span><br><span class="line">$cache = $testAbstractFactory-&gt;createType(&apos;cache&apos;);</span><br><span class="line">$cache-&gt;createCache(&apos;file&apos;);</span><br><span class="line">$cache-&gt;createCache(&apos;redis&apos;);</span><br><span class="line">$cacheDie = $testAbstractFactory-&gt;createType(&apos;cacheDie&apos;);</span><br><span class="line">$cacheDie-&gt;createCache(&apos;file&apos;);</span><br><span class="line">$cacheDie-&gt;createCache(&apos;redis&apos;);</span><br><span class="line"></span><br><span class="line">/*** -----------------------------------  ***/</span><br></pre></td></tr></table></figure><h3 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h3><blockquote><p>è´Ÿè´£åˆ›å»ºè‡ªå·±çš„å¯¹è±¡ï¼ŒåŒæ—¶ç¡®ä¿åªæœ‰å•ä¸ªå¯¹è±¡è¢«åˆ›å»ºã€‚<br>è¿™ä¸ªç±»æä¾›äº†ä¸€ç§è®¿é—®å…¶å”¯ä¸€çš„å¯¹è±¡çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ã€‚<br><strong>æ³¨æ„</strong>ï¼š  </p><ol><li>å•ä¾‹ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚  </li><li>å•ä¾‹ç±»å¿…é¡»è‡ªå·±åˆ›å»ºè‡ªå·±çš„å”¯ä¸€å®ä¾‹ã€‚  </li><li>å•ä¾‹ç±»å¿…é¡»ç»™æ‰€æœ‰å…¶ä»–å¯¹è±¡æä¾›è¿™ä¸€å®ä¾‹ã€‚  </li></ol><p><strong>ä¼˜ç‚¹</strong>ï¼š  </p><ol><li>åœ¨å†…å­˜é‡Œåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å†…å­˜çš„å¼€é”€ï¼Œå°¤å…¶æ˜¯é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯å®ä¾‹  </li><li>é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨ï¼ˆæ¯”å¦‚å†™æ–‡ä»¶æ“ä½œï¼‰ã€‚  </li></ol><p><strong>ç¼ºç‚¹</strong>ï¼š<br>    æ²¡æœ‰æ¥å£ï¼Œä¸èƒ½ç»§æ‰¿ï¼Œä¸å•ä¸€èŒè´£åŸåˆ™å†²çªï¼Œä¸€ä¸ªç±»åº”è¯¥åªå…³å¿ƒå†…éƒ¨é€»è¾‘ï¼Œè€Œä¸å…³å¿ƒå¤–é¢æ€ä¹ˆæ ·æ¥å®ä¾‹åŒ–ã€‚<br><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š<br>    getInstance() æ–¹æ³•ä¸­éœ€è¦ä½¿ç”¨åŒæ­¥é” synchronized (Singleton.class) é˜²æ­¢å¤šçº¿ç¨‹åŒæ—¶è¿›å…¥é€ æˆ instance è¢«å¤šæ¬¡å®ä¾‹åŒ–ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">/*** -----------å•ä¾‹æ¨¡å¼  singleton------------  ***/</span><br><span class="line">final class TestSingle</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    private static $instance;</span><br><span class="line">    public static function getInstance()</span><br><span class="line">    &#123;</span><br><span class="line">        if(!(self::$instance instanceof self ))&#123;</span><br><span class="line">            self::$instance = new self();</span><br><span class="line">        &#125;</span><br><span class="line">        return self::$instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function __construct()</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function toString()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;string&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$test = TestSingle::getInstance();</span><br><span class="line">$test-&gt;toString();</span><br><span class="line"></span><br><span class="line">/*** -----------------------------------  ***/</span><br></pre></td></tr></table></figure><h3 id="å»ºé€ è€…æ¨¡å¼"><a href="#å»ºé€ è€…æ¨¡å¼" class="headerlink" title="å»ºé€ è€…æ¨¡å¼"></a>å»ºé€ è€…æ¨¡å¼</h3><blockquote><p>ä¸€ä¸ª Builder ç±»ä¼šä¸€æ­¥ä¸€æ­¥æ„é€ æœ€ç»ˆçš„å¯¹è±¡ã€‚è¯¥ Builder ç±»æ˜¯ç‹¬ç«‹äºå…¶ä»–å¯¹è±¡çš„ã€‚<br><strong>ä¼˜ç‚¹</strong>ï¼š  </p><ol><li>å»ºé€ è€…ç‹¬ç«‹ï¼Œæ˜“æ‰©å±•ã€‚  </li><li>ä¾¿äºæ§åˆ¶ç»†èŠ‚é£é™©ã€‚  </li></ol><p><strong>ç¼ºç‚¹</strong>ï¼š  </p><ol><li>äº§å“å¿…é¡»æœ‰å…±åŒç‚¹ï¼ŒèŒƒå›´æœ‰é™åˆ¶ã€‚  </li><li>å¦‚å†…éƒ¨å˜åŒ–å¤æ‚ï¼Œä¼šæœ‰å¾ˆå¤šçš„å»ºé€ ç±»ã€‚  </li></ol><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š<br>    ä¸å·¥å‚æ¨¡å¼çš„åŒºåˆ«æ˜¯ï¼šå»ºé€ è€…æ¨¡å¼æ›´åŠ å…³æ³¨ä¸é›¶ä»¶è£…é…çš„é¡ºåºã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">/*** --------------å»ºé€ è€…æ¨¡å¼  builder---------------------  ***/</span><br><span class="line"></span><br><span class="line">class Product</span><br><span class="line">&#123;</span><br><span class="line">    private $_arr;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;_arr = array();</span><br><span class="line">    &#125;</span><br><span class="line">    public function add($part)</span><br><span class="line">    &#123;</span><br><span class="line">        return array_push($this-&gt;_arr, $part);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Builder</span><br><span class="line">&#123;</span><br><span class="line">    private $_product;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;_product = new Product();</span><br><span class="line">    &#125;</span><br><span class="line">    public function add1($part)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;_product-&gt;add($part);</span><br><span class="line">    &#125;</span><br><span class="line">    public function add2($part)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;_product-&gt;add($part);</span><br><span class="line">    &#125;</span><br><span class="line">    public function getPart()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;_product;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Director</span><br><span class="line">&#123;</span><br><span class="line">    public function __construct(Builder $builder)</span><br><span class="line">    &#123;</span><br><span class="line">        $builder-&gt;add1(&apos;arr1&apos;);</span><br><span class="line">        $builder-&gt;add2(&apos;add2&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$test_builder = new Builder();</span><br><span class="line">$test_director = new Director($test_builder);</span><br><span class="line">print_r($test_builder-&gt;getPart());</span><br><span class="line"></span><br><span class="line">/*** -----------------------------------  ***/</span><br></pre></td></tr></table></figure><h3 id="åŸå‹æ¨¡å¼"><a href="#åŸå‹æ¨¡å¼" class="headerlink" title="åŸå‹æ¨¡å¼"></a>åŸå‹æ¨¡å¼</h3><blockquote><p>å®ç°äº†ä¸€ä¸ªåŸå‹æ¥å£ï¼Œè¯¥æ¥å£ç”¨äºåˆ›å»ºå½“å‰å¯¹è±¡çš„å…‹éš†ã€‚<br>å®ç°å…‹éš† clone<br><strong>ä¼˜ç‚¹</strong>ï¼š  </p><ol><li>æ€§èƒ½æé«˜ã€‚  </li><li>é€ƒé¿æ„é€ å‡½æ•°çš„çº¦æŸã€‚  </li></ol><p><strong>ç¼ºç‚¹</strong>ï¼š  </p><ol><li>é…å¤‡å…‹éš†æ–¹æ³•éœ€è¦å¯¹ç±»çš„åŠŸèƒ½è¿›è¡Œé€šç›˜è€ƒè™‘ï¼Œè¿™å¯¹äºå…¨æ–°çš„ç±»ä¸æ˜¯å¾ˆéš¾ï¼Œä½†å¯¹äºå·²æœ‰çš„ç±»ä¸ä¸€å®šå¾ˆå®¹æ˜“ï¼Œç‰¹åˆ«å½“ä¸€ä¸ªç±»å¼•ç”¨ä¸æ”¯æŒä¸²è¡ŒåŒ–çš„é—´æ¥å¯¹è±¡ï¼Œæˆ–è€…å¼•ç”¨å«æœ‰å¾ªç¯ç»“æ„çš„æ—¶å€™ã€‚  </li><li>å¿…é¡»å®ç° Cloneable æ¥å£ã€‚  </li></ol><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š<br>    ä¸é€šè¿‡å¯¹ä¸€ä¸ªç±»è¿›è¡Œå®ä¾‹åŒ–æ¥æ„é€ æ–°å¯¹è±¡ä¸åŒçš„æ˜¯ï¼ŒåŸå‹æ¨¡å¼æ˜¯é€šè¿‡æ‹·è´ä¸€ä¸ªç°æœ‰å¯¹è±¡ç”Ÿæˆæ–°å¯¹è±¡çš„ã€‚æµ…æ‹·è´å®ç° Cloneableï¼Œé‡å†™ï¼Œæ·±æ‹·è´æ˜¯é€šè¿‡å®ç° Serializable è¯»å–äºŒè¿›åˆ¶æµã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/*** --------------åŸå‹æ¨¡å¼  prototype---------------------  ***/</span><br><span class="line"></span><br><span class="line">class ProtoType</span><br><span class="line">&#123;</span><br><span class="line">    private $_name;</span><br><span class="line">    public function __construct($obj)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;_name = $obj;</span><br><span class="line">    &#125;</span><br><span class="line">    public function copy()</span><br><span class="line">    &#123;</span><br><span class="line">        return clone $this;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class TestProto&#123;&#125;</span><br><span class="line">$testProto = new ProtoType(new TestProto());</span><br><span class="line">print_r($testProto);</span><br><span class="line">$testProtoCopy = $testProto-&gt;copy();</span><br><span class="line">print_r($testProtoCopy);</span><br><span class="line"></span><br><span class="line">/*** -----------------------------------  ***/</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å·¥å‚æ¨¡å¼&quot;&gt;&lt;a href=&quot;#å·¥å‚æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;å·¥å‚æ¨¡å¼&quot;&gt;&lt;/a&gt;å·¥å‚æ¨¡å¼&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;å®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å…¶å­ç±»å†³å®šå»å®ä¾‹åŒ–å“ªä¸€ä¸ªå·¥å‚ç±»&lt;br&gt;åˆ›å»ºçš„è¿‡ç¨‹æ˜¯åœ¨å­ç±»ä¸­æ‰§è¡Œ&lt;br&gt;&lt;
      
    
    </summary>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://zhipenwang.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://zhipenwang.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
</feed>
