---
title: PHP错误及异常处理
date: 2019-05-10
tags: PHP
categories: PHP
---
### set_error_handler()
> 捕获错误，只能捕获系统产生的一些Warning、Notice级别错误
```
代码：
set_error_handler('func_error');
function func_error($type, $message, $file, $line) {
	var_dump("<b>set_error_handler: " . $type . ":" . $message . " in " . $file . " on " . $line . " line .</b><br />");
}
echo $name;

执行结果：string(108) "set_error_handler: 8:Undefined variable: name in /data/code/www/test/exception.php on 10 line ."
```

### register_shutdown_function()
> PHP执行结束前最后一个调用的函数  
> 只在parse-time出错时是不会调用本函数的。只有在run-time出错的时候，才会调用本函数  
> error_get_last() 可以拿到本次执行产生的所有错误

```
代码：
register_shutdown_function('func_shutdown');
function func_shutdown() {
	if ($error = error_get_last()) {
		var_dump("<b>register_shutdown_function: Type:" . $error['type'] . " Msg:" . $error['message'] . " in " . $error['file'] . "on line " . $error['line'] . "</b><br />");
	}
}
require_once("error.php");

error.php: 
echo 23++--;

执行结果：
Parse error: syntax error, unexpected '++' (T_INC), expecting ',' or ';' in /data/code/www/test/error.php on line 2
string(153) "register_shutdown_function: Type:4 Msg:syntax error, unexpected '++' (T_INC), expecting ',' or ';' in /data/code/www/test/error.phpon line 2"
```

### set_exception_handler()
> 没有用try/catch块来捕获的异常或没有被捕获的异常就会进入此方法，回调函数执行后异常会中止


```
代码
set_exception_handler('func_exception');
function func_exception(Exception $e) {
	var_dump("<b>set_exception_handler: Exception: " . $e->getMessage() . "</b><br />");
}

throw new Exception("Error Processing Request", 1);

执行结果：
string(71) "set_exception_handler: Exception: Error Processing Request"
```