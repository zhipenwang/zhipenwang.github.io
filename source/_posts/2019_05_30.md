---
title: nginx支持多域名
date: 2019-05-30
tags: Nginx
categories: Nginx
---

### 场景
> 某个域名支持http和https访问  
某个域名只支持https访问  
这种情况无法支持，因为加载的配置文件中，包含了listen 80支持http  
所以另外一个域名也一样支持http  
建议：  
将80的重定向到https，这样所有的http访问都会重定向的定义的重定向https域名

```
如：所有的http，不管什么域名,访问80端口都会重定向到https://www.test.com
server {
	listen		 80;
	server_name  www.test.com;
	rewrite ^(.*)$ https://${server_name}$1 permanent;
}

test1.conf
server {
    listen 80;
    listen 443 ssl;
    server_name www.test1.com
    
    #ssl on; 这里要注释掉
    ssl_certificate /usr/local/nginx/conf/ssl/www_test1_com.crt;
    ssl_certificate_key /usr/local/nginx/conf/ssl/www_test1_com.key;

    #以下配置省略...
}

test2.conf
server {
    listen 80;
    listen 443 ssl;
    server_name www.test2.com
    
    #ssl on; 这里要注释掉
    ssl_certificate /usr/local/nginx/conf/ssl/www_test2_com.crt;
    ssl_certificate_key /usr/local/nginx/conf/ssl/www_test2_com.key;

    #以下配置省略...
}
```