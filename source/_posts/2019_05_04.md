---
title: URL在Nginx与Apache下的重写规则
date: 2019-05-04
tags: [PHP,Nginx]
categories: 服务器
---
### nginx下的url重写

修改nginx的配置文件，nginx.conf  
修改某个站点目录下的url重写规则
```
server {
    location /zhipeng/ {
        if (!-e $request_filename){
            rewrite  ^/zhipeng/(.*)$  /zhipeng/index.php?s=$1  last;
        }
    }
}
```

修改整站的url重写规则
```
server {
    rewrite  ^/zhipeng/(.*)$  /zhipeng/index.php?s=$1  last;
    //rewrite 规则 定向路径 重写类型
}
```

>规则：可以是字符串或者正则来表示想匹配的目标url  
>定向路径：表示匹配到规则后要定向的路径，如果规则里有正则，则可以使用$index来表示正则里的捕获分组  
>重写类型：  
>>last ：相当于Apache里德(L)标记，表示完成rewrite，浏览器地址栏URL地址不变  
    break；本条规则匹配完成后，终止匹配，不再匹配后面的规则，浏览器地址栏URL地址不变  
    redirect：返回302临时重定向，浏览器地址会显示跳转后的URL地址  
    permanent：返回301永久重定向，浏览器地址栏会显示跳转后的URL地址  


### apache下的url重写

修改apache的配置文件http.conf  
开启 rewrite模块：
```
LoadModule rewrite_module modules/mod_rewrite.so
```

自定义站点目录的重写规则
```
在要支持url rewrite的目录启用：
 Options FollowSymLinks 和 AllowOverride All
```

站点目录下添加 .htaccess文件,添加内容：
```
<IfModule mod_rewrite.c>
  Options +FollowSymlinks
  RewriteEngine On

  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteRule ^(.*)$ index.php/$1 [QSA,PT,L]
</IfModule>
```

>%{REQUEST_FILENAME}获得一个服务器变量的值  
!-f是正则，其中感叹号表否定，-f用来检测当前值所代表的路径是否是一个常规文件  
$1代表引用RewriteRule中的第一个正则(.*)代表的字符  